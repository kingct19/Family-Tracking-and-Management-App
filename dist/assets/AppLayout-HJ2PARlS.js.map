{"version":3,"file":"AppLayout-HJ2PARlS.js","sources":["../../src/components/layout/Sidebar.tsx","../../src/lib/store/ui-store.ts","../../src/components/layout/TopBar.tsx","../../src/components/AppLayout.tsx"],"sourcesContent":["import { NavLink, useNavigate } from 'react-router-dom';\nimport type { ReactNode } from 'react';\nimport { useHubStore } from '@/lib/store/hub-store';\nimport { useAuth } from '@/features/auth/hooks/useAuth';\nimport {\n    FiHome,\n    FiMapPin,\n    FiCheckSquare,\n    FiMessageCircle,\n    FiLock,\n    FiSettings,\n    FiLogOut,\n} from 'react-icons/fi';\nimport { cn } from '@/lib/utils/cn';\nimport toast from 'react-hot-toast';\n\ninterface NavItem {\n    to: string;\n    icon: ReactNode;\n    label: string;\n    feature?: keyof import('@/types').FeatureToggles;\n}\n\nexport const Sidebar = () => {\n    const { isFeatureEnabled } = useHubStore();\n    const { logout, isLoggingOut } = useAuth();\n    const navigate = useNavigate();\n\n    const handleLogout = async () => {\n        try {\n            await logout();\n            toast.success('Logged out successfully');\n            navigate('/login');\n        } catch (error) {\n            toast.error('Failed to logout');\n        }\n    };\n\n    // Nav items - Map first (Life360 style)\n    const navItems: NavItem[] = [\n        {\n            to: '/map',\n            icon: <FiMapPin size={20} />,\n            label: 'Map',\n            feature: 'location',\n        },\n        {\n            to: '/tasks',\n            icon: <FiCheckSquare size={20} />,\n            label: 'Tasks',\n            feature: 'tasks',\n        },\n        {\n            to: '/messages',\n            icon: <FiMessageCircle size={20} />,\n            label: 'Messages',\n            feature: 'chat',\n        },\n        {\n            to: '/vault',\n            icon: <FiLock size={20} />,\n            label: 'Vault',\n            feature: 'vault',\n        },\n        {\n            to: '/dashboard',\n            icon: <FiHome size={20} />,\n            label: 'Dashboard',\n        },\n        {\n            to: '/settings',\n            icon: <FiSettings size={20} />,\n            label: 'Settings',\n        },\n    ];\n\n    // Filter nav items based on feature toggles\n    const visibleNavItems = navItems.filter((item) => {\n        if (!item.feature) return true;\n        return isFeatureEnabled(item.feature);\n    });\n\n    return (\n        <nav className=\"h-full flex flex-col py-4\">\n            <div className=\"flex-1 space-y-1 px-2\">\n                {visibleNavItems.map((item) => (\n                    <NavLink\n                        key={item.to}\n                        to={item.to}\n                        className={({ isActive }) =>\n                            cn(\n                                'flex items-center gap-3 px-4 py-3 rounded-lg transition-colors duration-fast',\n                                'text-body-md font-medium',\n                                'focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2',\n                                {\n                                    'bg-secondary-container text-on-secondary-container': isActive,\n                                    'text-on-surface hover:bg-surface-variant': !isActive,\n                                }\n                            )\n                        }\n                    >\n                        {item.icon}\n                        <span>{item.label}</span>\n                    </NavLink>\n                ))}\n            </div>\n\n            {/* Logout Button */}\n            <div className=\"px-2 pt-4 border-t border-outline-variant\">\n                <button\n                    onClick={handleLogout}\n                    disabled={isLoggingOut}\n                    className={cn(\n                        'w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors duration-fast',\n                        'text-body-md font-medium',\n                        'text-error hover:bg-error-container focus:outline-none focus:ring-2 focus:ring-error focus:ring-offset-2',\n                        {\n                            'opacity-50 cursor-not-allowed': isLoggingOut,\n                        }\n                    )}\n                >\n                    <FiLogOut size={20} />\n                    <span>{isLoggingOut ? 'Logging out...' : 'Logout'}</span>\n                </button>\n            </div>\n        </nav>\n    );\n};\n\n","import { create } from 'zustand';\nimport type { ComponentType } from 'react';\n\ninterface Modal {\n    id: string;\n    component: ComponentType<any>;\n    props?: Record<string, any>;\n}\n\ninterface UIState {\n    // Modal state\n    modals: Modal[];\n\n    // Sidebar state\n    isSidebarOpen: boolean;\n\n    // Loading states\n    globalLoading: boolean;\n\n    // Actions\n    openModal: (id: string, component: ComponentType<any>, props?: Record<string, any>) => void;\n    closeModal: (id: string) => void;\n    closeAllModals: () => void;\n    toggleSidebar: () => void;\n    setSidebarOpen: (isOpen: boolean) => void;\n    setGlobalLoading: (isLoading: boolean) => void;\n}\n\nexport const useUIStore = create<UIState>((set) => ({\n    modals: [],\n    isSidebarOpen: false,\n    globalLoading: false,\n\n    openModal: (id, component, props) =>\n        set((state) => ({\n            modals: [...state.modals, { id, component, props }],\n        })),\n\n    closeModal: (id) =>\n        set((state) => ({\n            modals: state.modals.filter((modal) => modal.id !== id),\n        })),\n\n    closeAllModals: () =>\n        set({ modals: [] }),\n\n    toggleSidebar: () =>\n        set((state) => ({\n            isSidebarOpen: !state.isSidebarOpen,\n        })),\n\n    setSidebarOpen: (isOpen) =>\n        set({ isSidebarOpen: isOpen }),\n\n    setGlobalLoading: (isLoading) =>\n        set({ globalLoading: isLoading }),\n}));\n\n","import { useNavigate } from 'react-router-dom';\nimport { useUIStore } from '@/lib/store/ui-store';\nimport { useHubStore } from '@/lib/store/hub-store';\nimport { useAuth } from '@/features/auth/hooks/useAuth';\nimport { useUserProfile } from '@/features/auth/hooks/useAuth';\nimport { HubSelector } from '@/features/location/components/HubSelector';\nimport { FiMenu, FiSettings, FiShield, FiUser, FiEye } from 'react-icons/fi';\n\nexport const TopBar = () => {\n    const navigate = useNavigate();\n    const { toggleSidebar } = useUIStore();\n    const { currentRole } = useHubStore();\n    const { user } = useAuth();\n    const { data: profile } = useUserProfile(user?.id);\n\n    // Helper to get initials from name\n    const getInitials = (name: string) => {\n        return name\n            .split(' ')\n            .map(n => n[0])\n            .join('')\n            .toUpperCase()\n            .slice(0, 2);\n    };\n\n    return (\n        <header className=\"bg-white/95 backdrop-blur-md shadow-sm border-b border-gray-200 relative\">\n            <div className=\"flex items-center justify-between p-4 safe-top\">\n                {/* Left: Menu & Hub Selector */}\n                <div className=\"flex items-center gap-3\">\n                    {/* Hamburger Menu Button */}\n                    <button\n                        onClick={toggleSidebar}\n                        className=\"w-10 h-10 bg-white rounded-full shadow-md hover:shadow-lg transition-all duration-200 hover:scale-105 active:scale-95 flex items-center justify-center\"\n                        aria-label=\"Open menu\"\n                    >\n                        <FiMenu size={20} className=\"text-gray-700\" />\n                    </button>\n\n                    {/* Hub Selector */}\n                    <HubSelector />\n\n                    {/* Role Badge */}\n                    {currentRole && (\n                        <div className={`hidden sm:flex items-center gap-1.5 px-2.5 py-1.5 rounded-full text-xs font-semibold ${\n                            currentRole === 'admin' \n                                ? 'bg-purple-100 text-purple-700' \n                                : currentRole === 'member'\n                                ? 'bg-blue-100 text-blue-700'\n                                : 'bg-gray-100 text-gray-700'\n                        }`}>\n                            {currentRole === 'admin' && <FiShield size={12} />}\n                            {currentRole === 'member' && <FiUser size={12} />}\n                            {currentRole === 'observer' && <FiEye size={12} />}\n                            <span className=\"capitalize\">{currentRole}</span>\n                        </div>\n                    )}\n                </div>\n\n                {/* Right: Action Buttons */}\n                <div className=\"flex items-center gap-2\">\n                    {/* Profile Button */}\n                    <button\n                        onClick={() => navigate('/profile')}\n                        className=\"w-10 h-10 bg-white rounded-full shadow-md hover:shadow-lg transition-all duration-200 hover:scale-105 active:scale-95 flex items-center justify-center overflow-hidden\"\n                        aria-label=\"Profile\"\n                    >\n                        {profile?.photoURL ? (\n                            <img\n                                src={profile.photoURL}\n                                alt={profile.displayName || 'Profile'}\n                                className=\"w-full h-full object-cover\"\n                            />\n                        ) : (\n                            <div className=\"w-full h-full bg-primary flex items-center justify-center\">\n                                <span className=\"text-xs font-semibold text-on-primary\">\n                                    {getInitials(profile?.displayName || user?.email || 'U')}\n                                </span>\n                            </div>\n                        )}\n                    </button>\n\n                    {/* Settings Button */}\n                    <button\n                        onClick={() => navigate('/settings')}\n                        className=\"w-10 h-10 bg-white rounded-full shadow-md hover:shadow-lg transition-all duration-200 hover:scale-105 active:scale-95 flex items-center justify-center\"\n                        aria-label=\"Settings\"\n                    >\n                        <FiSettings size={20} className=\"text-gray-700\" />\n                    </button>\n                </div>\n            </div>\n        </header>\n    );\n};\n\n\n\n","import { Outlet, useLocation } from 'react-router-dom';\nimport { useEffect, Suspense } from 'react';\nimport { Sidebar } from './layout/Sidebar';\nimport { TopBar } from './layout/TopBar';\nimport { LoadingSpinner } from './LoadingSpinner';\nimport { useUIStore } from '@/lib/store/ui-store';\nimport { cn } from '@/lib/utils/cn';\nimport { FiX } from 'react-icons/fi';\n\nconst AppLayout = () => {\n    const { isSidebarOpen, setSidebarOpen } = useUIStore();\n    const location = useLocation();\n\n    // Check if we're on full-screen pages (Life360 style)\n    const isMapPage = location.pathname === '/map' || location.pathname === '/';\n    const isMessagesPage = location.pathname === '/messages';\n    const isFullScreenPage = isMapPage || isMessagesPage;\n\n    // Close sidebar when navigating to a different page\n    useEffect(() => {\n        setSidebarOpen(false);\n    }, [location.pathname, setSidebarOpen]);\n\n    return (\n        <div className={cn('min-h-screen bg-background flex flex-col', isFullScreenPage && 'relative')}>\n            {/* Top Bar - All pages (absolute for full-screen, relative for normal) */}\n            <div className={cn(isFullScreenPage && 'absolute top-0 left-0 right-0 z-50')}>\n                <TopBar />\n            </div>\n\n            {/* Mobile Sidebar Drawer (for full-screen pages) */}\n            {isFullScreenPage && isSidebarOpen && (\n                <>\n                    {/* Backdrop */}\n                    <div\n                        className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60]\"\n                        onClick={() => setSidebarOpen(false)}\n                    />\n                    \n                    {/* Drawer */}\n                    <aside className=\"fixed top-0 left-0 bottom-0 w-80 max-w-[85vw] bg-white shadow-2xl z-[70] transform transition-transform duration-300 animate-in slide-in-from-left\">\n                        {/* Header */}\n                        <div className=\"flex items-center justify-between p-4 border-b border-gray-200\">\n                            <h2 className=\"text-lg font-bold text-gray-900\">Menu</h2>\n                            <button\n                                onClick={() => setSidebarOpen(false)}\n                                className=\"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors\"\n                                aria-label=\"Close menu\"\n                            >\n                                <FiX size={20} />\n                            </button>\n                        </div>\n                        \n                        {/* Sidebar Content */}\n                        <div className=\"overflow-y-auto h-[calc(100%-64px)]\">\n                            <Sidebar />\n                        </div>\n                    </aside>\n                </>\n            )}\n\n            <div className=\"flex flex-1 overflow-hidden relative\">\n                {/* Sidebar - Desktop (only on non-full-screen pages) */}\n                {!isFullScreenPage && (\n                    <aside\n                        className={cn(\n                            'hidden md:block w-64 bg-surface border-r border-outline-variant transition-transform duration-normal',\n                            isSidebarOpen\n                                ? 'relative z-10'\n                                : 'absolute left-0 top-0 bottom-0 -translate-x-full z-0'\n                        )}\n                    >\n                        <Sidebar />\n                    </aside>\n                )}\n\n                {/* Main Content */}\n                <main\n                    className={cn(\n                        'flex-1 overflow-y-auto',\n                        isFullScreenPage ? 'relative' : 'pb-16 md:pb-0'\n                    )}\n                >\n                    <Suspense fallback={\n                        <div className=\"min-h-screen flex items-center justify-center bg-background\">\n                            <LoadingSpinner size=\"large\" text=\"Loading page...\" />\n                        </div>\n                    }>\n                        {isFullScreenPage ? (\n                            // Full-screen for map/messages (no padding, no container)\n                            <Outlet />\n                        ) : (\n                            // Normal layout for other pages (centered content with padding)\n                            <div className=\"w-full min-h-full\">\n                                <div className=\"w-full max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-4 md:py-6 lg:py-8\">\n                                    <Outlet />\n                                </div>\n                            </div>\n                        )}\n                    </Suspense>\n                </main>\n            </div>\n\n            {/* Bottom Navigation - Removed on mobile since we have hamburger menu */}\n            {/* Bottom nav is redundant when hamburger menu is available */}\n        </div>\n    );\n};\n\nexport default AppLayout;\n"],"names":["Sidebar","isFeatureEnabled","useHubStore","logout","isLoggingOut","useAuth","navigate","useNavigate","visibleNavItems","to","icon","jsx","FiMapPin","size","label","feature","FiCheckSquare","FiMessageCircle","FiLock","FiHome","FiSettings","filter","item","jsxs","className","children","map","NavLink","isActive","cn","onClick","async","toast","success","error","disabled","FiLogOut","useUIStore","create","set","modals","isSidebarOpen","globalLoading","openModal","id","component","props","state","closeModal","modal","closeAllModals","toggleSidebar","setSidebarOpen","isOpen","setGlobalLoading","isLoading","TopBar","currentRole","user","data","profile","useUserProfile","FiMenu","HubSelector","FiShield","FiUser","FiEye","photoURL","src","alt","displayName","name","email","split","n","join","toUpperCase","slice","AppLayout","location","useLocation","isMapPage","pathname","isMessagesPage","isFullScreenPage","useEffect","Fragment","FiX","Suspense","fallback","LoadingSpinner","text","Outlet"],"mappings":"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"}