import{r as e,j as s,ah as t,ab as r,a0 as a,aj as l,ak as n,al as i,a4 as o,am as d,F as c,U as x,an as m,S as u,z as g,p,y as h,ao as b}from"./vendor-Yz3niDpg.js";import{M as f}from"./Skeleton-CKTxZ5fm.js";import{b as y,a as j,c as w,u as v,d as N,e as k,f as C}from"./useBroadcasts-DUfu8DbO.js";import{i as S,d as z,u as A,b as T}from"./index-XwJoYhXH.js";import{p as $,y as D,f as M,j as E,T as L,A as B}from"./firebase-BB8Fp3FL.js";import"./query-C1EzXcVj.js";import"./state-CPa13AEy.js";const F=({message:l,isOwnMessage:n,onDelete:i,showAvatar:o=!0})=>{const[d,c]=e.useState(!1),x=l.readBy.length>1;return s.jsxs("div",{className:`flex gap-3 ${n?"flex-row-reverse":"flex-row"} group`,children:[o?s.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white text-sm font-semibold shadow-md ring-2 ring-white",children:l.senderName.charAt(0).toUpperCase()}):s.jsx("div",{className:"flex-shrink-0 w-10"}),s.jsxs("div",{className:`flex flex-col ${n?"items-end":"items-start"} max-w-[75%] md:max-w-[65%]`,children:[!n&&o&&s.jsx("span",{className:"text-xs font-medium text-gray-600 mb-1.5 px-1",children:l.senderName}),s.jsxs("div",{className:"relative px-4 py-2.5 rounded-2xl "+(n?"bg-gradient-to-br from-purple-600 to-purple-700 text-white rounded-br-sm shadow-md":"bg-white text-gray-900 rounded-bl-sm shadow-sm border border-gray-200/50"),children:[s.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:l.text}),l.mediaURL&&s.jsx("div",{className:"mt-2 rounded-lg overflow-hidden",children:s.jsx("img",{src:l.mediaURL,alt:"Message attachment",className:"max-w-full h-auto rounded-lg"})}),s.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 "+(n?"justify-end":"justify-start"),children:[s.jsx("span",{className:"text-xs "+(n?"text-purple-100/90":"text-gray-500"),children:(e=>{const s=(new Date).getTime()-e.getTime(),t=Math.floor(s/6e4);return t<1?"Just now":t<60?`${t}m ago`:s<864e5?e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):e.toLocaleDateString("en-US",{month:"short",day:"numeric"})})(l.timestamp)}),n&&s.jsx(t,{size:14,className:x?"text-blue-200":"text-purple-200/70"})]})]}),n&&i&&s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:()=>c(!d),className:"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-gray-600 transition-opacity","aria-label":"Message options",children:s.jsx(r,{size:14})}),d&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),s.jsx("div",{className:"absolute right-0 top-6 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20 min-w-[120px]",children:s.jsxs("button",{onClick:()=>{i(l.id),c(!1)},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[s.jsx(a,{size:14}),"Delete"]})})]})]})]})]})},U=({messages:t,currentUserId:r,isLoading:a=!1,onDeleteMessage:l})=>{const n=e.useRef(null),i=e.useRef(null);e.useEffect(()=>{n.current&&n.current.scrollIntoView({behavior:"smooth"})},[t]);const o=[];return t.forEach((e,s)=>{const r=s>0?t[s-1]:null,a=!r||r.senderId!==e.senderId||e.timestamp.getTime()-r.timestamp.getTime()>3e5;o.push({message:e,showAvatar:a})}),a&&0===t.length?s.jsxs("div",{className:"flex-1 overflow-y-auto px-4 md:px-6 py-6 space-y-4",children:[s.jsx(f,{isOwn:!1}),s.jsx(f,{isOwn:!0}),s.jsx(f,{isOwn:!1}),s.jsx(f,{isOwn:!0}),s.jsx(f,{isOwn:!1})]}):0===t.length?s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center px-6 min-h-0",children:[s.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-full flex items-center justify-center mb-6 shadow-lg",children:s.jsx("svg",{className:"w-12 h-12 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),s.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"No messages yet"}),s.jsx("p",{className:"text-sm text-gray-600 max-w-sm",children:"Start the conversation by sending a message to your family"})]}):s.jsxs("div",{ref:i,className:"flex-1 overflow-y-auto px-4 md:px-6 py-6 space-y-3",children:[o.map(({message:e,showAvatar:t})=>s.jsx(F,{message:e,isOwnMessage:e.senderId===r,onDelete:l,showAvatar:t},e.id)),s.jsx("div",{ref:n})]})},I=({onSend:t,isSending:r=!1,placeholder:a="Type a message...",disabled:o=!1,onTyping:d,onStopTyping:c})=>{const[x,m]=e.useState(""),u=e.useRef(null),g=e.useRef();e.useEffect(()=>{u.current&&(u.current.style.height="auto",u.current.style.height=`${u.current.scrollHeight}px`)},[x]);const p=e=>{e.preventDefault();const s=x.trim();!s||r||o||(t(s),m(""),c&&c(),u.current&&(u.current.style.height="auto"))};e.useEffect(()=>()=>{g.current&&clearTimeout(g.current),c&&c()},[c]);return s.jsx("form",{onSubmit:p,className:"border-t border-gray-200/50 bg-white/95 backdrop-blur-md p-4 md:px-6 shadow-lg",children:s.jsxs("div",{className:"flex items-end gap-3",children:[s.jsx("button",{type:"button",disabled:o,className:"flex-shrink-0 w-10 h-10 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-all disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Attach file",children:s.jsx(l,{size:20})}),s.jsxs("div",{className:"flex-1 relative",children:[s.jsx("textarea",{ref:u,value:x,onChange:e=>{m(e.target.value),d&&e.target.value.trim()&&d(),g.current&&clearTimeout(g.current),c&&(g.current=setTimeout(()=>{c()},2e3))},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),p(e))},placeholder:a,disabled:o||r,rows:1,className:"w-full px-4 py-3 pr-12 bg-gray-50 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent focus:bg-white resize-none overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm",style:{minHeight:"48px",maxHeight:"120px"}}),s.jsx("button",{type:"button",disabled:o,className:"absolute right-12 bottom-3 p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-all disabled:opacity-50","aria-label":"Add emoji",children:s.jsx(n,{size:18})})]}),s.jsx("button",{type:"submit",disabled:!x.trim()||r||o,className:"flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full transition-all shadow-md "+(!x.trim()||r||o?"bg-gray-200 text-gray-400 cursor-not-allowed shadow-none":"bg-gradient-to-br from-purple-600 to-purple-700 text-white hover:from-purple-700 hover:to-purple-800 active:scale-95 shadow-purple-200"),"aria-label":"Send message",children:r?s.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):s.jsx(i,{size:20})})]})})},R=({onClose:t})=>{const[r,a]=e.useState(""),[l,n]=e.useState(""),[i,m]=e.useState("normal"),[u,g]=e.useState("announcement"),[p,h]=e.useState(!1),[b,f]=e.useState(24),j=y(),w=[{value:"announcement",label:"Announcement",icon:d},{value:"alert",label:"Alert",icon:c},{value:"reminder",label:"Reminder",icon:x},{value:"emergency",label:"Emergency",icon:c}];return s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"sticky top-0 bg-gradient-to-br from-purple-600 to-purple-700 text-white px-6 py-4 rounded-t-3xl flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Send Broadcast Alert"}),s.jsx("p",{className:"text-purple-100 text-sm mt-1",children:"Send a notification to all family members"})]}),s.jsx("button",{onClick:t,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center transition-colors","aria-label":"Close",children:s.jsx(o,{size:20})})]}),s.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!r.trim()||!l.trim())return;const s=p?new Date(Date.now()+60*b*60*1e3):void 0;j.mutate({title:r.trim(),message:l.trim(),priority:i,type:u,expiresAt:s},{onSuccess:()=>{t()}})},className:"p-6 space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Alert Type"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:w.map(e=>{const t=e.icon;return s.jsxs("button",{type:"button",onClick:()=>g(e.value),className:"p-3 rounded-xl border-2 transition-all "+(u===e.value?"border-purple-600 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300 text-gray-700"),children:[s.jsx(t,{size:18,className:"mx-auto mb-1"}),s.jsx("span",{className:"text-xs font-medium block",children:e.label})]},e.value)})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Priority Level"}),s.jsx("div",{className:"flex gap-2",children:[{value:"low",label:"Low",color:"text-gray-600"},{value:"normal",label:"Normal",color:"text-blue-600"},{value:"high",label:"High",color:"text-orange-600"},{value:"urgent",label:"Urgent",color:"text-red-600"}].map(e=>s.jsx("button",{type:"button",onClick:()=>m(e.value),className:"flex-1 px-4 py-2 rounded-xl border-2 transition-all text-sm font-medium "+(i===e.value?"border-purple-600 bg-purple-50 text-purple-700":`border-gray-200 hover:border-gray-300 ${e.color}`),children:e.label},e.value))})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"broadcast-title",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Title"}),s.jsx("input",{id:"broadcast-title",type:"text",value:r,onChange:e=>a(e.target.value),placeholder:"e.g., Family Meeting Tonight",maxLength:100,required:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[r.length,"/100 characters"]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"broadcast-message",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Message"}),s.jsx("textarea",{id:"broadcast-message",value:l,onChange:e=>n(e.target.value),placeholder:"Enter your broadcast message...",rows:5,maxLength:500,required:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.length,"/500 characters"]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:p,onChange:e=>h(e.target.checked),className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Set expiration time"})]}),p&&s.jsxs("div",{className:"mt-3",children:[s.jsx("label",{htmlFor:"expiry-hours",className:"block text-xs text-gray-600 mb-1",children:"Expires after (hours)"}),s.jsx("input",{id:"expiry-hours",type:"number",value:b,onChange:e=>f(Math.max(1,parseInt(e.target.value)||1)),min:"1",max:"168",className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),s.jsxs("div",{className:"flex gap-3 pt-4",children:[s.jsx("button",{type:"button",onClick:t,className:"flex-1 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-semibold transition-colors",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:!r.trim()||!l.trim()||j.isPending,className:"flex-1 px-6 py-3 bg-gradient-to-br from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-xl font-semibold shadow-lg shadow-purple-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:j.isPending?"Sending...":"Send Broadcast"})]})]})]})})},H=({onClose:e})=>{const{data:r=[],isLoading:a}=j(),l=w(),{user:n}=S(),i=e=>{switch(e.type){case"emergency":case"alert":return s.jsx(c,{size:20});case"reminder":return s.jsx(x,{size:20});default:return s.jsx(d,{size:20})}},u=e=>{switch(e){case"urgent":return"border-red-500 bg-red-50";case"high":return"border-orange-500 bg-orange-50";case"normal":return"border-blue-500 bg-blue-50";default:return"border-gray-500 bg-gray-50"}},g=e=>{switch(e){case"urgent":return"text-red-700";case"high":return"text-orange-700";case"normal":return"text-blue-700";default:return"text-gray-700"}};return s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"sticky top-0 bg-gradient-to-br from-purple-600 to-purple-700 text-white px-6 py-4 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Broadcast History"}),s.jsx("p",{className:"text-purple-100 text-sm mt-1",children:"View all family broadcast alerts"})]}),s.jsx("button",{onClick:e,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center transition-colors","aria-label":"Close",children:s.jsx(o,{size:20})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:a?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"w-8 h-8 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin"})}):0===r.length?s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-full flex items-center justify-center mb-4",children:s.jsx(d,{size:32,className:"text-purple-600"})}),s.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"No broadcasts yet"}),s.jsx("p",{className:"text-sm text-gray-600 max-w-sm",children:"Broadcast alerts sent by admins will appear here"})]}):s.jsx("div",{className:"space-y-4",children:r.map(e=>{const r=(e=>n&&e.readBy.includes(n.id))(e);return s.jsxs("div",{className:`border-l-4 rounded-xl p-4 ${u(e.priority)} transition-all ${r?"opacity-75":"shadow-md"}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[s.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[s.jsx("div",{className:`flex-shrink-0 ${g(e.priority)}`,children:i(e)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:`font-bold text-lg ${g(e.priority)}`,children:e.title}),s.jsxs("p",{className:"text-sm text-gray-600 mt-0.5",children:["From ",e.senderName," â€¢"," ",m(e.timestamp,{addSuffix:!0})]})]})]}),r?s.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-semibold",children:[s.jsx(t,{size:14}),"Read"]}):s.jsx("div",{className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-semibold",children:"New"})]}),s.jsx("p",{className:"text-gray-800 text-sm leading-relaxed mb-3 ml-8",children:e.message}),s.jsxs("div",{className:"flex items-center justify-between ml-8",children:[s.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[s.jsx("span",{className:"px-2 py-1 bg-white rounded-full capitalize",children:e.type}),s.jsxs("span",{className:"px-2 py-1 bg-white rounded-full capitalize",children:[e.priority," priority"]}),e.expiresAt&&s.jsxs("span",{className:"px-2 py-1 bg-white rounded-full flex items-center gap-1",children:[s.jsx(x,{size:12}),"Expires"," ",m(e.expiresAt,{addSuffix:!0})]})]}),!r&&s.jsx("button",{onClick:()=>{return s=e.id,void l.mutate(s);var s},disabled:l.isPending,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm font-semibold transition-colors disabled:opacity-50 shadow-md",children:"Acknowledge"})]})]},e.id)})})})]})})},O=({broadcast:e,onDismiss:r})=>{const{user:a}=S(),l=w(),n=!!a&&(e.acknowledgedBy||e.readBy||[]).includes(a.id),i={emergency:{icon:c,bgColor:"bg-red-50",borderColor:"border-red-300",textColor:"text-red-900",iconColor:"text-red-600",buttonColor:"bg-red-600 hover:bg-red-700"},urgent:{icon:u,bgColor:"bg-orange-50",borderColor:"border-orange-300",textColor:"text-orange-900",iconColor:"text-orange-600",buttonColor:"bg-orange-600 hover:bg-orange-700"},info:{icon:d,bgColor:"bg-blue-50",borderColor:"border-blue-300",textColor:"text-blue-900",iconColor:"text-blue-600",buttonColor:"bg-blue-600 hover:bg-blue-700"}},x=i[e.type]||i.info,g=x.icon;return s.jsx("div",{className:`${x.bgColor} ${x.borderColor} ${x.textColor} border-2 rounded-2xl p-4 shadow-lg`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:`flex-shrink-0 w-10 h-10 ${x.iconColor} flex items-center justify-center rounded-full bg-white shadow-sm`,children:s.jsx(g,{size:24})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-bold text-lg leading-tight",children:e.title}),s.jsxs("p",{className:"text-xs opacity-75 mt-0.5",children:[m(e.timestamp,{addSuffix:!0})," by ",e.senderName]})]}),r&&s.jsx("button",{onClick:r,className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full hover:bg-white/50 transition-colors","aria-label":"Dismiss",children:s.jsx(o,{size:16})})]}),s.jsx("p",{className:"text-sm leading-relaxed mb-4",children:e.message}),s.jsxs("div",{className:"flex items-center gap-3",children:[n?s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[s.jsx("div",{className:"w-6 h-6 bg-green-600 rounded-full flex items-center justify-center",children:s.jsx(t,{size:16,className:"text-white"})}),s.jsx("span",{children:"Acknowledged"})]}):s.jsx("button",{onClick:()=>{l.mutate(e.id)},disabled:l.isPending,className:`px-4 py-2 ${x.buttonColor} text-white font-semibold rounded-lg transition-colors disabled:opacity-50 text-sm shadow-md`,children:l.isPending?"Acknowledging...":"Acknowledge"}),s.jsxs("div",{className:"text-xs opacity-75",children:[(e.acknowledgedBy||e.readBy||[]).length," acknowledged"]})]})]})]})})},P=({typingUsers:e})=>{if(0===e.length)return null;return s.jsxs("div",{className:"px-4 md:px-6 py-2 flex items-center gap-2",children:[s.jsxs("div",{className:"flex gap-1",children:[s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),s.jsx("span",{className:"text-sm text-gray-600 italic",children:1===e.length?`${e[0].userName} is typing...`:2===e.length?`${e[0].userName} and ${e[1].userName} are typing...`:`${e[0].userName} and ${e.length-1} others are typing...`})]})},q=async(e,s)=>{try{const t=M(z,`hubs/${e}/typing/${s}`);await B(t)}catch(t){console.error("Clear typing status error:",t)}},K=s=>{const{user:t}=S(),[r,a]=e.useState([]),l=e.useRef();e.useEffect(()=>{if(!s)return;const e=((e,s)=>{const t=$(z,`hubs/${e}/typing`);return D(t,e=>{const t=[];e.forEach(e=>{const s=e.data();t.push({userId:s.userId,userName:s.userName,timestamp:s.timestamp?.toDate()||new Date})}),s(t)},e=>{console.error("Subscribe to typing status error:",e),s([])})})(s,e=>{const s=Date.now(),r=e.filter(e=>{const r=s-e.timestamp.getTime();return e.userId!==t?.id&&r<5e3});a(r)});return e},[s,t?.id]);const n=e.useCallback(async()=>{s&&t&&(l.current&&clearTimeout(l.current),await(async(e,s,t)=>{try{const r=M(z,`hubs/${e}/typing/${s}`);await E(r,{userId:s,userName:t,timestamp:L.now()})}catch(r){console.error("Set typing status error:",r)}})(s,t.id,t.displayName||"Unknown"),l.current=setTimeout(async()=>{await q(s,t.id)},3e3))},[s,t]),i=e.useCallback(async()=>{s&&t&&(l.current&&clearTimeout(l.current),await q(s,t.id))},[s,t]);return e.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]),{typingUsers:r,setTyping:n,clearTyping:i}},V=()=>{const{user:t}=A(),{currentHub:r}=T(),{messages:a,isLoading:l}=v(r?.id),{data:n=[]}=j(),{typingUsers:i,setTyping:o,clearTyping:d}=K(r?.id),{sendMessageAsync:c,isSending:x,error:m}=N(),{deleteMessageAsync:u}=k(),{markAsReadAsync:f}=C(),[y,w]=e.useState(!1),[S,z]=e.useState(!1),[$,D]=e.useState([]);e.useEffect(()=>{t&&a.length&&a.forEach(async e=>{if(e.senderId!==t.id&&!e.readBy.includes(t.id))try{await f(e.id)}catch(s){}})},[a,t,f]),e.useEffect(()=>{m&&g.error(m.message||"Failed to send message")},[m]);return r?s.jsxs(s.Fragment,{children:[s.jsxs(p,{children:[s.jsxs("title",{children:["Messages - ",r.name," - Family Safety App"]}),s.jsx("meta",{name:"description",content:"Chat with your family"})]}),s.jsxs("div",{className:"fixed inset-0 flex flex-col bg-gradient-to-br from-gray-50 to-gray-100 pt-20 z-10",children:[s.jsx("div",{className:"flex-shrink-0 px-4 md:px-6 py-4 border-b border-gray-200/50 bg-white/80 backdrop-blur-md shadow-sm",children:s.jsxs("div",{className:"flex items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 truncate",children:r.name}),s.jsxs("p",{className:"text-sm text-gray-600 mt-0.5",children:[a.length," ",1===a.length?"message":"messages"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:()=>z(!0),className:"flex-shrink-0 px-4 py-2 bg-white border border-gray-200 text-gray-700 rounded-xl hover:bg-gray-50 transition-all shadow-sm flex items-center gap-2 font-semibold text-sm",children:[s.jsx(b,{size:18}),s.jsx("span",{className:"hidden md:inline",children:"History"})]}),s.jsxs("button",{onClick:()=>w(!0),className:"flex-shrink-0 px-4 py-2 bg-gradient-to-br from-purple-600 to-purple-700 text-white rounded-xl hover:from-purple-700 hover:to-purple-800 transition-all shadow-md flex items-center gap-2 font-semibold text-sm",children:[s.jsx(b,{size:18}),s.jsx("span",{className:"hidden sm:inline",children:"Broadcast"})]})]})]})}),n.length>0&&s.jsx("div",{className:"flex-shrink-0 px-4 md:px-6 py-3 space-y-3 bg-white/50 border-b border-gray-200/50",children:n.filter(e=>!$.includes(e.id)).slice(0,3).map(e=>s.jsx(O,{broadcast:e,onDismiss:()=>D(s=>[...s,e.id])},e.id))}),s.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:s.jsx(U,{messages:a,currentUserId:t?.id||"",isLoading:l,onDeleteMessage:async e=>{if(window.confirm("Are you sure you want to delete this message?"))try{await u(e),g.success("Message deleted")}catch(s){g.error(s instanceof Error?s.message:"Failed to delete message")}}})}),s.jsx(P,{typingUsers:i}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx(I,{onSend:async e=>{try{await c(e)}catch(s){g.error(s instanceof Error?s.message:"Failed to send message")}},isSending:x,placeholder:`Message ${r.name}...`,disabled:!t,onTyping:o,onStopTyping:d})})]}),y&&s.jsx(R,{onClose:()=>w(!1)}),S&&s.jsx(H,{onClose:()=>z(!1)})]}):s.jsxs(s.Fragment,{children:[s.jsx(p,{children:s.jsx("title",{children:"Messages - Family Safety App"})}),s.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6",children:[s.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:s.jsx(h,{size:36,className:"text-gray-400"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No hub selected"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Please select a hub to start messaging"})]})]})};export{V as default};
//# sourceMappingURL=MessagesPage-5551etvH.js.map
