import{e,r as s,f as t,z as a,j as r,a4 as i,ar as n,g as l,y as o,aB as d,X as c,ah as u}from"./vendor-Yz3niDpg.js";import{u as m,b as x,l as h,m as b,o as p,L as f}from"./index-XwJoYhXH.js";import{c as g}from"./hub-schemas-CrELoLa9.js";import{T as j}from"./TextField-wgpo0Y90.js";import{B as y}from"./Button-D6lpmbx7.js";const v=({isOpen:n,onClose:l})=>{const{user:o}=m(),{setCurrentHub:d}=x(),c=e(),[u,p]=s.useState({name:"",description:"",featureToggles:{location:!0,tasks:!0,chat:!0,vault:!1,xp:!0,leaderboard:!0,geofencing:!1,deviceMonitoring:!0}}),[f,v]=s.useState({}),N=t({mutationFn:async e=>{if(!o)throw new Error("User not authenticated");return b(e,o.id)},onSuccess:async e=>{if(e.success&&e.data&&o){c.invalidateQueries({queryKey:["hubs",o.id]});const s=await h(e.data.id,o.id);s.success&&s.data&&d(e.data,s.data.role),a.success("Hub created successfully!"),l(),p({name:"",description:"",featureToggles:{location:!0,tasks:!0,chat:!0,vault:!1,xp:!0,leaderboard:!0,geofencing:!1,deviceMonitoring:!0}})}else a.error(e.error||"Failed to create hub")},onError:e=>{a.error(e.message||"Failed to create hub")}});return n?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Create Hub"}),r.jsx("button",{onClick:l,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close",children:r.jsx(i,{size:20})})]}),r.jsxs("form",{onSubmit:async e=>{e.preventDefault(),v({});const s=g.safeParse(u);if(!s.success){const e={};return s.error.errors.forEach(s=>{s.path[0]&&(e[s.path[0]]=s.message)}),void v(e)}N.mutate(u)},className:"p-6 space-y-4",children:[r.jsx(j,{label:"Hub Name",value:u.name,onChange:e=>p({...u,name:e.target.value}),error:f.name,required:!0,fullWidth:!0,placeholder:"e.g., My Family, School Group"}),r.jsxs("div",{className:"w-full",children:[r.jsx("label",{className:"block text-label-md text-on-surface mb-2",children:"Description (Optional)"}),r.jsx("textarea",{value:u.description||"",onChange:e=>p({...u,description:e.target.value}),className:"w-full px-4 py-3 text-body-md text-on-surface bg-surface border-2 rounded-xl border-outline focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",placeholder:"Brief description of your hub",rows:3}),f.description&&r.jsx("p",{className:"text-label-sm text-error mt-2",children:f.description})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx(y,{type:"button",variant:"outlined",onClick:l,fullWidth:!0,disabled:N.isPending,children:"Cancel"}),r.jsx(y,{type:"submit",variant:"filled",fullWidth:!0,loading:N.isPending,disabled:N.isPending,children:"Create Hub"})]})]})]})}):null},N=({isOpen:l,onClose:o})=>{const{user:d,joinHub:c}=m(),{setCurrentHub:u}=x(),h=e(),[b,f]=s.useState(""),[g,v]=s.useState(""),N=t({mutationFn:async e=>{if(!d)throw new Error("User not authenticated");return c(e)},onSuccess:async e=>{if(e.success&&e.data&&d){h.invalidateQueries({queryKey:["hubs",d.id]});const{hubId:s,role:t}=e.data,r=await p(d.id);if(r.success&&r.data){const e=r.data.find(e=>e.id===s);e&&u(e,t)}a.success("Successfully joined hub!"),o(),f(""),v("")}else{const s=e.error||"Failed to join hub";v(s),a.error(s)}},onError:e=>{const s=e.message||"Failed to join hub";v(s),a.error(s)}});return l?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Join Hub"}),r.jsx("button",{onClick:o,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close",children:r.jsx(i,{size:20})})]}),r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),v(""),!b.trim())return void v("Please enter an invite code");const s=b.trim().replace(/\s+/g,"").toUpperCase();N.mutate(s)},className:"p-6 space-y-4",children:[r.jsxs("div",{children:[r.jsx(j,{label:"Invite Code",value:b,onChange:e=>{f(e.target.value),v("")},error:g,required:!0,fullWidth:!0,placeholder:"XXXX-XXXX",startAdornment:r.jsx(n,{size:20})}),r.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Enter the invite code provided by the hub administrator"})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx(y,{type:"button",variant:"outlined",onClick:o,fullWidth:!0,disabled:N.isPending,children:"Cancel"}),r.jsx(y,{type:"submit",variant:"filled",fullWidth:!0,loading:N.isPending,disabled:N.isPending||!b.trim(),children:"Join Hub"})]})]})]})}):null},w=()=>{const{user:e}=m(),{currentHub:t,setCurrentHub:i}=x(),[b,g]=s.useState(!1),[j,y]=s.useState(!1),[w,C]=s.useState(!1),H=s.useRef(null),{data:S,isLoading:k}=l({queryKey:["hubs",e?.id],queryFn:async()=>{if(!e)throw new Error("User not authenticated");const s=await p(e.id);if(!s.success)throw new Error(s.error);return s.data||[]},enabled:!!e});s.useEffect(()=>{const e=e=>{H.current&&!H.current.contains(e.target)&&g(!1)};return b&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[b]);return e?r.jsxs("div",{className:"relative",ref:H,children:[r.jsxs("button",{onClick:()=>g(!b),className:"flex items-center gap-2 px-4 py-2 bg-white rounded-full shadow-md hover:shadow-lg transition-all duration-200 hover:scale-105 active:scale-95","aria-label":"Select hub","aria-expanded":b,children:[r.jsx(o,{size:18,className:"text-purple-600"}),r.jsx("span",{className:"font-semibold text-gray-900 text-sm hidden sm:inline",children:t?.name||"Select Hub"}),r.jsx("span",{className:"font-semibold text-gray-900 text-sm sm:hidden",children:"Hub"}),r.jsx(d,{size:16,className:"text-gray-500 transition-transform "+(b?"rotate-180":"")})]}),b&&r.jsx("div",{className:"absolute top-full left-0 mt-2 w-64 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 max-h-96 overflow-hidden",children:r.jsxs("div",{className:"p-2",children:[r.jsxs("div",{className:"space-y-1 mb-2 pb-2 border-b border-gray-200",children:[r.jsxs("button",{onClick:()=>{g(!1),y(!0)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-purple-50 transition-colors",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center",children:r.jsx(c,{size:18,className:"text-purple-600"})}),r.jsx("span",{className:"font-medium",children:"Create Hub"})]}),r.jsxs("button",{onClick:()=>{g(!1),C(!0)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-indigo-50 transition-colors",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center",children:r.jsx(n,{size:18,className:"text-indigo-600"})}),r.jsx("span",{className:"font-medium",children:"Join Hub"})]})]}),k?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx(f,{})}):S&&S.length>0?r.jsx("div",{className:"space-y-1",children:S.map(s=>r.jsxs("button",{onClick:()=>(async s=>{if(e&&s!==t?.id){try{const t=await h(s,e.id);if(t.success&&t.data){const e=S?.find(e=>e.id===s);e&&(i(e,t.data.role),a.success(`Switched to ${e.name}`,{icon:"ðŸ”„",duration:2e3}))}}catch(r){console.error("Failed to switch hub:",r),a.error("Failed to switch hub")}g(!1)}else g(!1)})(s.id),className:"w-full flex items-center justify-between px-4 py-3 rounded-lg transition-colors "+(s.id===t?.id?"bg-purple-100 text-purple-700 font-semibold":"text-gray-700 hover:bg-gray-100"),children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white text-sm font-semibold",children:s.name.charAt(0).toUpperCase()}),r.jsxs("div",{className:"text-left",children:[r.jsx("div",{className:"font-medium",children:s.name}),s.description&&r.jsx("div",{className:"text-xs text-gray-500 truncate",children:s.description})]})]}),s.id===t?.id&&r.jsx(u,{size:18,className:"text-purple-600"})]},s.id))}):r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx("p",{className:"text-sm",children:"No hubs found"}),r.jsx("p",{className:"text-xs mt-1",children:"Create or join a hub to get started"})]})]})}),r.jsx(v,{isOpen:j,onClose:()=>y(!1)}),r.jsx(N,{isOpen:w,onClose:()=>C(!1)})]}):null};export{w as H};
//# sourceMappingURL=HubSelector-DYcCpDOf.js.map
