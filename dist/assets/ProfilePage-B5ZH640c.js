import{e,r as s,f as a,j as t,p as i,af as r,E as l,az as n,a4 as o,z as d}from"./vendor-Yz3niDpg.js";import{C as c,a as m,b as u,c as x}from"./Card-D91uPdLB.js";import{B as h}from"./Button-D6lpmbx7.js";import{T as p}from"./TextField-wgpo0Y90.js";import{u as f,e as j,L as v,k as b}from"./index-XwJoYhXH.js";import{a as y}from"./storage-service-DKyMHPFN.js";import"./query-C1EzXcVj.js";import"./firebase-BB8Fp3FL.js";import"./state-CPa13AEy.js";const g=()=>{const{user:g}=f(),{data:N,isLoading:P}=j(g?.id),w=e(),C=s.useRef(null),[S,L]=s.useState(""),[U,E]=s.useState(""),[F,R]=s.useState(""),[T,z]=s.useState(void 0),[D,k]=s.useState(!1),[q,I]=s.useState(!1),A=N||(g?{id:g.id,email:g.email,displayName:g.displayName,photoURL:g.photoURL,xpTotal:g.xpTotal||0,hubs:[],createdAt:new Date,updatedAt:new Date}:null);s.useEffect(()=>{A&&(L(A.displayName||""),E(A.phone||""),R(A.bio||""),z(A.photoURL))},[A]),s.useEffect(()=>{if(!A)return;const e=S!==(A.displayName||"")||U!==(A.phone||"")||F!==(A.bio||"")||T!==A.photoURL;I(e)},[S,U,F,T,A]);const B=a({mutationFn:async e=>{if(!g)throw new Error("User not authenticated");const s=await b(g.id,e);if(!s.success)throw new Error(s.error||"Failed to update profile");return s},onSuccess:()=>{w.invalidateQueries({queryKey:["user","profile",g?.id]}),w.invalidateQueries({queryKey:["user"]}),d.success("Profile updated successfully"),I(!1)},onError:e=>{d.error(e.message||"Failed to update profile")}});return P?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(v,{size:"large",text:"Loading profile..."})}):A&&g?t.jsxs(t.Fragment,{children:[t.jsxs(i,{children:[t.jsx("title",{children:"Profile - Family Safety App"}),t.jsx("meta",{name:"description",content:"Edit your profile"})]}),t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-headline-lg md:text-display-sm font-normal text-on-surface mb-2",children:"Profile"}),t.jsx("p",{className:"text-body-lg text-on-variant",children:"Manage your profile information"})]}),t.jsxs(c,{elevation:1,children:[t.jsx(m,{title:"Profile Photo"}),t.jsx(u,{children:t.jsxs("div",{className:"flex items-center gap-6",children:[t.jsxs("div",{className:"relative",children:[T?t.jsx("img",{src:T,alt:S||"Profile",className:"w-24 h-24 rounded-full object-cover border-2 border-outline-variant"}):t.jsx("div",{className:"w-24 h-24 rounded-full bg-primary flex items-center justify-center border-2 border-outline-variant",children:t.jsx("span",{className:"text-headline-md text-on-primary",children:(M=S||A?.displayName||g?.email||"U",M.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2))})}),D&&t.jsx("div",{className:"absolute inset-0 rounded-full bg-black/50 flex items-center justify-center",children:t.jsx(v,{size:"small"})})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx(h,{variant:"outlined",onClick:()=>C.current?.click(),disabled:D,startIcon:t.jsx(r,{}),children:T?"Change Photo":"Upload Photo"}),t.jsx("input",{ref:C,type:"file",accept:"image/*",onChange:async e=>{const s=e.target.files?.[0];if(s)if(s.type.startsWith("image/"))if(s.size>5242880)d.error("Image must be less than 5MB");else{k(!0);try{const e=`profiles/${g?.id}/${Date.now()}_${s.name}`,a=await y(s,e);if(z(a),g){(await b(g.id,{photoURL:a})).success?(w.invalidateQueries({queryKey:["user","profile",g.id]}),w.invalidateQueries({queryKey:["user"]}),d.success("Photo uploaded and saved successfully")):d.error("Photo uploaded but failed to save")}}catch(a){d.error("Failed to upload photo"),console.error("Photo upload error:",a)}finally{k(!1),C.current&&(C.current.value="")}}else d.error("Please select an image file")},className:"hidden"}),t.jsx("p",{className:"text-label-sm text-on-variant mt-2",children:"JPG, PNG or GIF. Max size 5MB."})]})]})})]}),t.jsxs(c,{elevation:1,children:[t.jsx(m,{title:"Profile Information"}),t.jsx(u,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(p,{label:"Display Name",value:S,onChange:e=>{L(e.target.value)},placeholder:"Enter your display name",required:!0,startAdornment:t.jsx(l,{})}),t.jsx(p,{label:"Email",value:g?.email||"",disabled:!0,helperText:"Email cannot be changed"}),t.jsx(p,{label:"Phone Number",value:U,onChange:e=>{E(e.target.value)},placeholder:"+1 (555) 123-4567",type:"tel"}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{htmlFor:"bio",className:"text-label-md text-on-surface mb-2",children:"Bio"}),t.jsx("textarea",{id:"bio",value:F,onChange:e=>{R(e.target.value)},placeholder:"Tell us about yourself...",rows:4,className:"w-full px-4 py-3 text-body-md text-on-surface bg-surface border-2 border-outline-variant rounded-xl transition-all duration-fast focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary placeholder:text-on-variant resize-none"})]})]})}),t.jsx(x,{children:t.jsxs("div",{className:"flex gap-3 w-full",children:[t.jsx(h,{variant:"filled",onClick:async()=>{if(!g)return;const e={displayName:S.trim()};U.trim()&&(e.phone=U.trim()),F.trim()&&(e.bio=F.trim()),T&&T!==A?.photoURL&&(e.photoURL=T),B.mutate(e)},disabled:!q||B.isPending,startIcon:t.jsx(n,{}),className:"flex-1",children:B.isPending?"Saving...":"Save Changes"}),t.jsx(h,{variant:"outlined",onClick:()=>{A&&(L(A.displayName||""),E(A.phone||""),R(A.bio||""),z(A.photoURL),I(!1))},disabled:!q||B.isPending,startIcon:t.jsx(o,{}),children:"Cancel"})]})})]}),t.jsxs(c,{elevation:1,children:[t.jsx(m,{title:"Statistics"}),t.jsx(u,{children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-label-sm text-on-variant mb-1",children:"Total XP"}),t.jsx("p",{className:"text-headline-md text-on-surface font-semibold",children:A.xpTotal||0})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-label-sm text-on-variant mb-1",children:"Hubs"}),t.jsx("p",{className:"text-headline-md text-on-surface font-semibold",children:A.hubs?.length||0})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-label-sm text-on-variant mb-1",children:"Member Since"}),t.jsx("p",{className:"text-body-md text-on-surface",children:new Date(A.createdAt).toLocaleDateString()})]})]})})]})]})]}):t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-body-lg text-on-variant",children:"Please log in to view your profile"})})});var M};export{g as default};
//# sourceMappingURL=ProfilePage-B5ZH640c.js.map
