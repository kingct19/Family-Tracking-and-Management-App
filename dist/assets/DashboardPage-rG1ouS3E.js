import{n as e,r as s,j as t,G as a,E as i,s as r,v as l,S as n,p as o,x as d,T as c,y as m,U as x,q as p}from"./vendor-Yz3niDpg.js";import{u as h,b as g,c as b,L as u}from"./index-XwJoYhXH.js";import{u as j}from"./useTasks-CcRx-I0r.js";import{u as v,a as f}from"./useBroadcasts-DUfu8DbO.js";import{D as N}from"./Skeleton-CKTxZ5fm.js";import"./query-C1EzXcVj.js";import"./firebase-BB8Fp3FL.js";import"./state-CPa13AEy.js";import"./task-api-CifnuJS5.js";import"./xp-api-Dlw9aMIE.js";const y=()=>{const{user:y}=h(),{currentHub:k}=g(),z=b(),A=e(),{data:T=[],isLoading:C}=j(),{messages:$=[],isLoading:M}=v(k?.id),{data:L=[]}=f(),S=C||M,F=s.useMemo(()=>({active:T.filter(e=>"pending"===e.status||"assigned"===e.status).length,completed:T.filter(e=>"done"===e.status||"approved"===e.status).length,pendingApprovals:T.filter(e=>"pending"===e.proofStatus).length,assignedToMe:T.filter(e=>e.assignedTo===y?.id&&("pending"===e.status||"assigned"===e.status)).length,total:T.length}),[T,y?.id]),H=s.useMemo(()=>{const e=[];return T.slice(0,5).forEach(s=>{"done"===s.status||"approved"===s.status?e.push({id:`task-${s.id}`,type:"task",title:"Task completed",description:`${s.title} was completed`,timestamp:s.completedAt||s.updatedAt,icon:t.jsx(a,{size:16}),color:"text-green-600"}):s.assignedTo&&"assigned"===s.status?e.push({id:`task-assigned-${s.id}`,type:"task",title:"Task assigned",description:`${s.title} was assigned`,timestamp:s.updatedAt,icon:t.jsx(i,{size:16}),color:"text-blue-600"}):"pending"===s.status&&e.push({id:`task-created-${s.id}`,type:"task",title:"New task",description:`${s.title} was created`,timestamp:s.createdAt,icon:t.jsx(r,{size:16}),color:"text-purple-600"})}),$.slice(-5).forEach(s=>{e.push({id:`message-${s.id}`,type:"message",title:"New message",description:`${s.senderName}: ${s.text.substring(0,50)}${s.text.length>50?"...":""}`,timestamp:s.timestamp,icon:t.jsx(l,{size:16}),color:"text-purple-600"})}),L.slice(0,3).forEach(s=>{e.push({id:`broadcast-${s.id}`,type:"broadcast",title:s.title,description:s.message,timestamp:s.timestamp,icon:t.jsx(n,{size:16}),color:"high"===s.priority?"text-red-600":"text-orange-600"})}),e.sort((e,s)=>s.timestamp.getTime()-e.timestamp.getTime()).slice(0,10)},[T,$,L]),D=[{icon:t.jsx(r,{size:28}),title:"Tasks",description:"View and manage tasks",action:()=>A("/tasks"),color:"from-blue-500 to-blue-600",bgColor:"bg-blue-50",textColor:"text-blue-600"},{icon:t.jsx(p,{size:28}),title:"Location",description:"Track family members",action:()=>A("/location"),color:"from-green-500 to-green-600",bgColor:"bg-green-50",textColor:"text-green-600"},{icon:t.jsx(l,{size:28}),title:"Messages",description:"Chat with your team",action:()=>A("/messages"),color:"from-purple-500 to-purple-600",bgColor:"bg-purple-50",textColor:"text-purple-600"},{icon:t.jsx(m,{size:28}),title:"Members",description:"Manage hub members",action:()=>A("/settings"),color:"from-indigo-500 to-indigo-600",bgColor:"bg-indigo-50",textColor:"text-indigo-600"}];return t.jsxs(t.Fragment,{children:[t.jsxs(o,{children:[t.jsx("title",{children:"Dashboard - Family Safety App"}),t.jsx("meta",{name:"description",content:"Your family safety dashboard"})]}),t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"bg-gradient-to-br from-primary via-purple-600 to-indigo-600 rounded-3xl p-8 md:p-12 text-on-primary shadow-elevation-3 overflow-hidden relative",children:[t.jsxs("div",{className:"absolute inset-0 opacity-10",children:[t.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full blur-3xl"}),t.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-white rounded-full blur-3xl"})]}),t.jsx("div",{className:"relative z-10",children:t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-headline-lg md:text-display-sm font-normal mb-3 text-balance",children:["Welcome back, ",y?.displayName||"User","!"]}),t.jsx("p",{className:"text-body-lg text-on-primary/90",children:k?`Current hub: ${k.name}`:"No hub selected"})]}),t.jsx("div",{className:"flex items-center gap-3",children:t.jsx("div",{className:"bg-white/15 backdrop-blur-md rounded-2xl px-6 py-4 border border-white/20 shadow-elevation-2",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:t.jsx(d,{size:24,className:"text-white"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-label-sm text-on-primary/80 mb-1",children:"Total XP"}),t.jsx("div",{className:"text-headline-sm font-semibold text-white",children:y?.xpTotal||0})]})]})})})]})})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-headline-md font-normal text-on-surface mb-6",children:"Quick actions"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:D.map((e,s)=>t.jsxs("button",{onClick:e.action,disabled:!k,className:"group card-interactive p-6 text-left "+(k?"":"opacity-50 cursor-not-allowed"),children:[t.jsx("div",{className:`w-14 h-14 bg-gradient-to-br ${e.color} rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-normal shadow-elevation-2`,children:t.jsx("div",{className:"text-white",children:e.icon})}),t.jsx("h3",{className:"text-title-md text-on-surface mb-2",children:e.title}),t.jsx("p",{className:"text-body-md text-on-variant",children:e.description})]},s))})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-headline-md font-normal text-on-surface mb-6",children:"Overview"}),S?t.jsx(N,{}):t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsxs("div",{className:"card p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center border border-blue-100",children:t.jsx(r,{size:24,className:"text-blue-600"})}),F.active>0&&t.jsx(c,{className:"text-green-600",size:20})]}),C?t.jsx(u,{size:"small"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-display-sm font-normal text-on-surface mb-1",children:F.active}),t.jsx("div",{className:"text-body-md text-on-variant",children:"Active Tasks"}),F.assignedToMe>0&&t.jsxs("div",{className:"text-label-sm text-blue-600 mt-2",children:[F.assignedToMe," assigned to you"]})]})]}),t.jsxs("div",{className:"card p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("div",{className:"w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center border border-purple-100",children:t.jsx(m,{size:24,className:"text-purple-600"})}),t.jsx(c,{className:"text-green-600",size:20})]}),t.jsx("div",{className:"text-display-sm font-normal text-on-surface mb-1",children:k?.members.length||0}),t.jsx("div",{className:"text-body-md text-on-variant",children:"Hub Members"})]}),t.jsxs("div",{className:"card p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center border border-green-100",children:t.jsx(a,{size:24,className:"text-green-600"})}),F.completed>0&&t.jsx(c,{className:"text-green-600",size:20})]}),C?t.jsx(u,{size:"small"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-display-sm font-normal text-on-surface mb-1",children:F.completed}),t.jsx("div",{className:"text-body-md text-on-variant",children:"Completed Tasks"})]})]}),t.jsxs("div",{className:"card p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("div",{className:"w-12 h-12 bg-orange-50 rounded-xl flex items-center justify-center border border-orange-100",children:t.jsx(x,{size:24,className:"text-orange-600"})}),H.length>0&&t.jsx(c,{className:"text-green-600",size:20})]}),t.jsx("div",{className:"text-display-sm font-normal text-on-surface mb-1",children:H.length}),t.jsx("div",{className:"text-body-md text-on-variant",children:"Recent Activity"}),z&&F.pendingApprovals>0&&t.jsxs("div",{className:"text-label-sm text-orange-600 mt-2",children:[F.pendingApprovals," pending approvals"]})]})]})]}),z&&k&&t.jsxs("div",{children:[t.jsx("h2",{className:"text-headline-md font-normal text-on-surface mb-6",children:"Admin Actions"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[t.jsxs("button",{onClick:()=>A("/tasks/pending-approvals"),className:"group card-interactive p-6 text-left relative",children:[F.pendingApprovals>0&&t.jsx("div",{className:"absolute top-4 right-4 bg-orange-500 text-white text-label-sm font-semibold rounded-full w-7 h-7 flex items-center justify-center shadow-elevation-2",children:F.pendingApprovals}),t.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-normal shadow-elevation-2",children:t.jsx(a,{size:28,className:"text-white"})}),t.jsx("h3",{className:"text-title-md text-on-surface mb-2",children:"Pending Approvals"}),t.jsx("p",{className:"text-body-md text-on-variant",children:"Review task completion proof"}),F.pendingApprovals>0&&t.jsxs("p",{className:"text-label-sm text-orange-600 mt-3",children:[F.pendingApprovals," ",1===F.pendingApprovals?"task":"tasks"," awaiting review"]})]}),t.jsxs("button",{onClick:()=>A("/leaderboard"),className:"group card-interactive p-6 text-left",children:[t.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-normal shadow-elevation-2",children:t.jsx(d,{size:28,className:"text-white"})}),t.jsx("h3",{className:"text-title-md text-on-surface mb-2",children:"Leaderboard"}),t.jsx("p",{className:"text-body-md text-on-variant",children:"View XP rankings"})]})]})]}),!k&&t.jsx("div",{className:"bg-gradient-to-br from-primary-container to-purple-50 rounded-3xl p-8 md:p-12 border-2 border-primary/20 shadow-elevation-2",children:t.jsxs("div",{className:"max-w-2xl",children:[t.jsx("h2",{className:"text-headline-md font-normal text-on-container mb-4",children:"Get Started with Your First Hub"}),t.jsx("p",{className:"text-body-lg text-on-container/80 mb-8",children:"You're not part of any hub yet. Create a new hub for your group or join an existing one with an invite code."}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("button",{className:"btn-base bg-primary text-on-primary hover:bg-primary/90 shadow-elevation-2",children:"Create Hub"}),t.jsx("button",{className:"btn-base bg-surface border-2 border-primary text-primary hover:bg-primary-container transition-colors",children:"Join Hub"})]})]})}),k&&t.jsxs("div",{children:[t.jsx("h2",{className:"text-headline-md font-normal text-on-surface mb-6",children:"Recent Activity"}),t.jsx("div",{className:"card p-6",children:C||M?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(u,{size:"medium"})}):0===H.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-16 h-16 bg-surface-variant rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(x,{size:32,className:"text-on-variant"})}),t.jsx("h3",{className:"text-title-lg text-on-surface mb-2",children:"No recent activity"}),t.jsx("p",{className:"text-body-md text-on-variant",children:"Activity from your hub will appear here"})]}):t.jsx("div",{className:"space-y-3",children:H.map(e=>t.jsxs("div",{className:"flex items-start gap-4 p-4 rounded-xl hover:bg-surface-variant/50 transition-colors duration-fast group",children:[t.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center border-2 transition-colors duration-fast "+("text-green-600"===e.color?"bg-green-50 border-green-100":"text-blue-600"===e.color?"bg-blue-50 border-blue-100":"text-purple-600"===e.color?"bg-purple-50 border-purple-100":"text-red-600"===e.color?"bg-red-50 border-red-100":"bg-surface-variant border-outline-variant"),children:t.jsx("div",{className:e.color,children:e.icon})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"text-title-sm text-on-surface mb-1",children:e.title}),t.jsx("p",{className:"text-body-sm text-on-variant mb-2 line-clamp-2",children:e.description}),t.jsx("p",{className:"text-label-sm text-on-variant/70",children:w(e.timestamp)})]})]},e.id))})})]})]})]})},w=e=>{const s=new Date,t=Math.floor((s.getTime()-e.getTime())/1e3);return t<60?"Just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:t<604800?`${Math.floor(t/86400)}d ago`:e.toLocaleDateString()};export{y as default};
//# sourceMappingURL=DashboardPage-rG1ouS3E.js.map
