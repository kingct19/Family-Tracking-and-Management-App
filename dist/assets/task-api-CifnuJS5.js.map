{"version":3,"file":"task-api-CifnuJS5.js","sources":["../../src/features/tasks/api/task-api.ts"],"sourcesContent":["import {\n    doc,\n    getDoc,\n    setDoc,\n    updateDoc,\n    deleteDoc,\n    collection,\n    query,\n    where,\n    orderBy,\n    getDocs,\n    serverTimestamp,\n} from 'firebase/firestore';\nimport { db } from '@/config/firebase';\nimport type { Task, ApiResponse } from '@/types';\nimport type { CreateTaskFormData } from '@/lib/validation/task-schemas';\n\n/**\n * Create a new task\n */\nexport const createTask = async (\n    hubId: string,\n    data: CreateTaskFormData,\n    createdBy: string\n): Promise<ApiResponse<Task>> => {\n    try {\n        const taskRef = doc(collection(db, 'hubs', hubId, 'tasks'));\n\n        const task: Omit<Task, 'id' | 'createdAt' | 'updatedAt'> = {\n            hubId,\n            title: data.title,\n            description: data.description,\n            createdBy,\n            assignedTo: data.assignedTo,\n            status: data.assignedTo ? 'assigned' : 'pending',\n            weight: data.weight,\n            deadline: data.deadline,\n        };\n\n        await setDoc(taskRef, {\n            ...task,\n            createdAt: serverTimestamp(),\n            updatedAt: serverTimestamp(),\n        });\n\n        return {\n            success: true,\n            data: {\n                id: taskRef.id,\n                ...task,\n                createdAt: new Date(),\n                updatedAt: new Date(),\n            },\n        };\n    } catch (error: any) {\n        console.error('Create task error:', error);\n        return {\n            success: false,\n            error: 'Failed to create task',\n        };\n    }\n};\n\n/**\n * Get task by ID\n */\nexport const getTaskById = async (\n    hubId: string,\n    taskId: string\n): Promise<ApiResponse<Task>> => {\n    try {\n        const taskDoc = await getDoc(doc(db, 'hubs', hubId, 'tasks', taskId));\n\n        if (!taskDoc.exists()) {\n            return {\n                success: false,\n                error: 'Task not found',\n            };\n        }\n\n        const data = taskDoc.data();\n        const task: Task = {\n            id: taskDoc.id,\n            hubId: data.hubId,\n            title: data.title,\n            description: data.description,\n            createdBy: data.createdBy,\n            assignedTo: data.assignedTo,\n            status: data.status,\n            weight: data.weight,\n            deadline: data.deadline?.toDate(),\n            proofURL: data.proofURL,\n            proofStatus: data.proofStatus,\n            proofSubmittedAt: data.proofSubmittedAt?.toDate(),\n            proofReviewedBy: data.proofReviewedBy,\n            proofReviewedAt: data.proofReviewedAt?.toDate(),\n            completedAt: data.completedAt?.toDate(),\n            createdAt: data.createdAt?.toDate() || new Date(),\n            updatedAt: data.updatedAt?.toDate() || new Date(),\n        };\n\n        return {\n            success: true,\n            data: task,\n        };\n    } catch (error: any) {\n        console.error('Get task error:', error);\n        return {\n            success: false,\n            error: 'Failed to fetch task',\n        };\n    }\n};\n\n/**\n * Get all tasks for a hub\n */\nexport const getHubTasks = async (hubId: string): Promise<ApiResponse<Task[]>> => {\n    try {\n        const tasksQuery = query(\n            collection(db, 'hubs', hubId, 'tasks'),\n            orderBy('createdAt', 'desc')\n        );\n        const snapshot = await getDocs(tasksQuery);\n\n        const tasks: Task[] = [];\n        snapshot.forEach((doc) => {\n            const data = doc.data();\n            tasks.push({\n                id: doc.id,\n                hubId: data.hubId,\n                title: data.title,\n                description: data.description,\n                createdBy: data.createdBy,\n                assignedTo: data.assignedTo,\n                status: data.status,\n                weight: data.weight,\n                deadline: data.deadline?.toDate(),\n                proofURL: data.proofURL,\n                proofStatus: data.proofStatus,\n                proofSubmittedAt: data.proofSubmittedAt?.toDate(),\n                proofReviewedBy: data.proofReviewedBy,\n                proofReviewedAt: data.proofReviewedAt?.toDate(),\n                completedAt: data.completedAt?.toDate(),\n                createdAt: data.createdAt?.toDate() || new Date(),\n                updatedAt: data.updatedAt?.toDate() || new Date(),\n            });\n        });\n\n        return {\n            success: true,\n            data: tasks,\n        };\n    } catch (error: any) {\n        console.error('Get hub tasks error:', error);\n        return {\n            success: false,\n            error: 'Failed to fetch tasks',\n        };\n    }\n};\n\n/**\n * Get tasks assigned to a specific user\n */\nexport const getUserTasks = async (\n    hubId: string,\n    userId: string\n): Promise<ApiResponse<Task[]>> => {\n    try {\n        const tasksQuery = query(\n            collection(db, 'hubs', hubId, 'tasks'),\n            where('assignedTo', '==', userId),\n            orderBy('deadline', 'asc')\n        );\n        const snapshot = await getDocs(tasksQuery);\n\n        const tasks: Task[] = [];\n        snapshot.forEach((doc) => {\n            const data = doc.data();\n            tasks.push({\n                id: doc.id,\n                hubId: data.hubId,\n                title: data.title,\n                description: data.description,\n                createdBy: data.createdBy,\n                assignedTo: data.assignedTo,\n                status: data.status,\n                weight: data.weight,\n                deadline: data.deadline?.toDate(),\n                proofURL: data.proofURL,\n                proofStatus: data.proofStatus,\n                proofSubmittedAt: data.proofSubmittedAt?.toDate(),\n                proofReviewedBy: data.proofReviewedBy,\n                proofReviewedAt: data.proofReviewedAt?.toDate(),\n                completedAt: data.completedAt?.toDate(),\n                createdAt: data.createdAt?.toDate() || new Date(),\n                updatedAt: data.updatedAt?.toDate() || new Date(),\n            });\n        });\n\n        return {\n            success: true,\n            data: tasks,\n        };\n    } catch (error: any) {\n        console.error('Get user tasks error:', error);\n        return {\n            success: false,\n            error: 'Failed to fetch user tasks',\n        };\n    }\n};\n\n/**\n * Update task\n */\nexport const updateTask = async (\n    hubId: string,\n    taskId: string,\n    updates: Partial<Task>\n): Promise<ApiResponse<void>> => {\n    try {\n        await updateDoc(doc(db, 'hubs', hubId, 'tasks', taskId), {\n            ...updates,\n            updatedAt: serverTimestamp(),\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error('Update task error:', error);\n        return {\n            success: false,\n            error: 'Failed to update task',\n        };\n    }\n};\n\n/**\n * Delete task\n */\nexport const deleteTask = async (\n    hubId: string,\n    taskId: string\n): Promise<ApiResponse<void>> => {\n    try {\n        await deleteDoc(doc(db, 'hubs', hubId, 'tasks', taskId));\n        return { success: true };\n    } catch (error: any) {\n        console.error('Delete task error:', error);\n        return {\n            success: false,\n            error: 'Failed to delete task',\n        };\n    }\n};\n\n/**\n * Assign task to a user\n */\nexport const assignTask = async (\n    hubId: string,\n    taskId: string,\n    userId: string\n): Promise<ApiResponse<void>> => {\n    try {\n        await updateDoc(doc(db, 'hubs', hubId, 'tasks', taskId), {\n            assignedTo: userId,\n            status: 'assigned',\n            updatedAt: serverTimestamp(),\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error('Assign task error:', error);\n        return {\n            success: false,\n            error: 'Failed to assign task',\n        };\n    }\n};\n\n/**\n * Mark task as done (without proof)\n */\nexport const completeTask = async (\n    hubId: string,\n    taskId: string\n): Promise<ApiResponse<void>> => {\n    try {\n        await updateDoc(doc(db, 'hubs', hubId, 'tasks', taskId), {\n            status: 'done',\n            completedAt: serverTimestamp(),\n            updatedAt: serverTimestamp(),\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error('Complete task error:', error);\n        return {\n            success: false,\n            error: 'Failed to complete task',\n        };\n    }\n};\n\n/**\n * Submit task proof with photo\n */\nexport const submitTaskProof = async (\n    hubId: string,\n    taskId: string,\n    proofURL: string,\n    notes?: string\n): Promise<ApiResponse<void>> => {\n    try {\n        await updateDoc(doc(db, 'hubs', hubId, 'tasks', taskId), {\n            proofURL,\n            proofStatus: 'pending',\n            proofSubmittedAt: serverTimestamp(),\n            status: 'submitted',\n            updatedAt: serverTimestamp(),\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error('Submit task proof error:', error);\n        return {\n            success: false,\n            error: 'Failed to submit task proof',\n        };\n    }\n};\n\n\n\n"],"names":["createTask","async","hubId","data","createdBy","taskRef","doc","collection","db","task","title","description","assignedTo","status","weight","deadline","setDoc","createdAt","serverTimestamp","updatedAt","success","id","Date","error","console","getHubTasks","tasksQuery","query","orderBy","snapshot","getDocs","tasks","forEach","push","toDate","proofURL","proofStatus","proofSubmittedAt","proofReviewedBy","proofReviewedAt","completedAt","updateTask","taskId","updates","updateDoc","deleteTask","deleteDoc","completeTask","submitTaskProof","notes"],"mappings":"sIAoBO,MAAMA,EAAaC,MACtBC,EACAC,EACAC,KAEA,IACI,MAAMC,EAAUC,EAAIC,EAAWC,EAAI,OAAQN,EAAO,UAE5CO,EAAqD,CACvDP,QACAQ,MAAOP,EAAKO,MACZC,YAAaR,EAAKQ,YAClBP,YACAQ,WAAYT,EAAKS,WACjBC,OAAQV,EAAKS,WAAa,WAAa,UACvCE,OAAQX,EAAKW,OACbC,SAAUZ,EAAKY,UASnB,aANMC,EAAOX,EAAS,IACfI,EACHQ,UAAWC,IACXC,UAAWD,MAGR,CACHE,SAAS,EACTjB,KAAM,CACFkB,GAAIhB,EAAQgB,MACTZ,EACHQ,cAAeK,KACfH,cAAeG,MAG3B,OAASC,GAEL,OADAC,QAAQD,MAAM,qBAAsBA,GAC7B,CACHH,SAAS,EACTG,MAAO,wBAEf,GAyDSE,EAAcxB,MAAOC,IAC9B,IACI,MAAMwB,EAAaC,EACfpB,EAAWC,EAAI,OAAQN,EAAO,SAC9B0B,EAAQ,YAAa,SAEnBC,QAAiBC,EAAQJ,GAEzBK,EAAgB,GAwBtB,OAvBAF,EAASG,QAAS1B,IACd,MAAMH,EAAOG,EAAIH,OACjB4B,EAAME,KAAK,CACPZ,GAAIf,EAAIe,GACRnB,MAAOC,EAAKD,MACZQ,MAAOP,EAAKO,MACZC,YAAaR,EAAKQ,YAClBP,UAAWD,EAAKC,UAChBQ,WAAYT,EAAKS,WACjBC,OAAQV,EAAKU,OACbC,OAAQX,EAAKW,OACbC,SAAUZ,EAAKY,UAAUmB,SACzBC,SAAUhC,EAAKgC,SACfC,YAAajC,EAAKiC,YAClBC,iBAAkBlC,EAAKkC,kBAAkBH,SACzCI,gBAAiBnC,EAAKmC,gBACtBC,gBAAiBpC,EAAKoC,iBAAiBL,SACvCM,YAAarC,EAAKqC,aAAaN,SAC/BjB,UAAWd,EAAKc,WAAWiB,cAAgBZ,KAC3CH,UAAWhB,EAAKgB,WAAWe,cAAgBZ,SAI5C,CACHF,SAAS,EACTjB,KAAM4B,EAEd,OAASR,GAEL,OADAC,QAAQD,MAAM,uBAAwBA,GAC/B,CACHH,SAAS,EACTG,MAAO,wBAEf,GA0DSkB,EAAaxC,MACtBC,EACAwC,EACAC,KAEA,IAMI,aALMC,EAAUtC,EAAIE,EAAI,OAAQN,EAAO,QAASwC,GAAS,IAClDC,EACHxB,UAAWD,MAGR,CAAEE,SAAS,EACtB,OAASG,GAEL,OADAC,QAAQD,MAAM,qBAAsBA,GAC7B,CACHH,SAAS,EACTG,MAAO,wBAEf,GAMSsB,EAAa5C,MACtBC,EACAwC,KAEA,IAEI,aADMI,EAAUxC,EAAIE,EAAI,OAAQN,EAAO,QAASwC,IACzC,CAAEtB,SAAS,EACtB,OAASG,GAEL,OADAC,QAAQD,MAAM,qBAAsBA,GAC7B,CACHH,SAAS,EACTG,MAAO,wBAEf,GA+BSwB,EAAe9C,MACxBC,EACAwC,KAEA,IAOI,aANME,EAAUtC,EAAIE,EAAI,OAAQN,EAAO,QAASwC,GAAS,CACrD7B,OAAQ,OACR2B,YAAatB,IACbC,UAAWD,MAGR,CAAEE,SAAS,EACtB,OAASG,GAEL,OADAC,QAAQD,MAAM,uBAAwBA,GAC/B,CACHH,SAAS,EACTG,MAAO,0BAEf,GAMSyB,EAAkB/C,MAC3BC,EACAwC,EACAP,EACAc,KAEA,IASI,aARML,EAAUtC,EAAIE,EAAI,OAAQN,EAAO,QAASwC,GAAS,CACrDP,WACAC,YAAa,UACbC,iBAAkBnB,IAClBL,OAAQ,YACRM,UAAWD,MAGR,CAAEE,SAAS,EACtB,OAASG,GAEL,OADAC,QAAQD,MAAM,2BAA4BA,GACnC,CACHH,SAAS,EACTG,MAAO,8BAEf"}