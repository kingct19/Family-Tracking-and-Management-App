import{e,r as s,f as a,z as t,j as r,aw as i,D as n,x as l,w as o,v as c,s as d,q as x,S as m,a6 as p,G as u,ax as h,ay as g,n as j,p as b,$ as f,E as N,aq as y}from"./vendor-Yz3niDpg.js";import{C as v,a as k,b as w}from"./Card-D91uPdLB.js";import{B as S}from"./Button-D6lpmbx7.js";import{b as z,u as P,j as E,n as C}from"./index-XwJoYhXH.js";import{f as T}from"./hub-schemas-CrELoLa9.js";import"./query-C1EzXcVj.js";import"./firebase-BB8Fp3FL.js";import"./state-CPa13AEy.js";const q={location:{label:"Location Tracking",description:"Track and share member locations",icon:r.jsx(x,{size:20})},tasks:{label:"Tasks",description:"Assign and manage tasks",icon:r.jsx(d,{size:20})},chat:{label:"Messages",description:"Group messaging and communication",icon:r.jsx(c,{size:20})},vault:{label:"Vault",description:"Secure storage for sensitive information",icon:r.jsx(o,{size:20})},xp:{label:"XP System",description:"Earn points for completing tasks",icon:r.jsx(l,{size:20})},leaderboard:{label:"Leaderboard",description:"Rank members by XP (requires XP enabled)",icon:r.jsx(l,{size:20})},geofencing:{label:"Geofencing",description:"Location-based alerts (requires location enabled)",icon:r.jsx(n,{size:20})},deviceMonitoring:{label:"Device Monitoring",description:"Monitor battery and device status",icon:r.jsx(i,{size:20})}},F=()=>{const{currentHub:i,currentRole:n,featureToggles:l,updateFeatureToggles:o}=z(),{user:c}=P(),d=e(),[x,m]=s.useState(l||{location:!0,tasks:!0,chat:!0,vault:!1,xp:!0,leaderboard:!0,geofencing:!1,deviceMonitoring:!0}),p=a({mutationFn:async e=>{if(!i)throw new Error("No hub selected");return E(i.id,e)},onSuccess:()=>{o(x),d.invalidateQueries({queryKey:["hubs",c?.id]}),t.success("Feature toggles updated successfully")},onError:e=>{t.error(e.message||"Failed to update feature toggles")}}),u=JSON.stringify(x)!==JSON.stringify(l);return i&&"admin"===n?r.jsxs(v,{elevation:1,children:[r.jsx(k,{title:"Feature Toggles"}),r.jsxs(w,{children:[r.jsx("p",{className:"text-body-sm text-on-variant mb-6",children:"Enable or disable features for this hub. Some features depend on others."}),r.jsx("div",{className:"space-y-4",children:Object.keys(q).map(e=>{const{label:s,description:a,icon:i}=q[e],n=x[e],l="leaderboard"===e&&!x.xp||"geofencing"===e&&!x.location;return r.jsxs("div",{className:"flex items-start justify-between p-4 rounded-lg border transition-colors "+(l&&!n?"bg-gray-50 border-gray-200 opacity-60":"bg-white border-gray-200 hover:border-purple-300"),children:[r.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[r.jsx("div",{className:"mt-1 "+(l&&!n?"text-gray-400":"text-purple-600"),children:i}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:s}),l&&!n&&r.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded",children:"Requires dependency"})]}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a})]})]}),r.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-4",children:[r.jsx("input",{type:"checkbox",checked:n,onChange:()=>(e=>{const s={...x,[e]:!x[e]},a=T.safeParse(s);if(!a.success){const e=a.error.errors[0];return void t.error(e.message)}m(s)})(e),disabled:l&&!n,className:"sr-only peer"}),r.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed"})]})]},e)})}),u&&r.jsxs("div",{className:"flex gap-3 mt-6 pt-6 border-t border-gray-200",children:[r.jsx(S,{variant:"outlined",onClick:()=>m(l||x),disabled:p.isPending,children:"Cancel"}),r.jsx(S,{variant:"filled",onClick:()=>{T.safeParse(x).success?p.mutate(x):t.error("Invalid feature toggle configuration")},loading:p.isPending,disabled:p.isPending,children:"Save Changes"})]})]})]}):null},M=()=>{const{isSupported:e,permissionStatus:a,isEnabled:t,isLoading:i,requestPermission:n,disableNotifications:l}=(()=>{const{isAuthenticated:e}=P(),[a,t]=s.useState(!1),[r,i]=s.useState("default"),[n,l]=s.useState(!1),[o,c]=s.useState(!1);return s.useEffect(()=>{t(C.isSupported()),i(C.getPermissionStatus()),l("granted"===r)},[r]),s.useEffect(()=>{e&&a&&"granted"===r&&(C.setupForegroundListener(),C.getToken().catch(console.error))},[e,a,r]),{isSupported:a,permissionStatus:r,isEnabled:n,isLoading:o,requestPermission:async()=>{c(!0);try{const e=await C.requestPermission();return e?(i("granted"),l(!0)):(i(C.getPermissionStatus()),l(!1)),e}catch(e){return console.error("Error requesting notification permission:",e),i(C.getPermissionStatus()),l(!1),!1}finally{c(!1)}},disableNotifications:async()=>{c(!0);try{await C.deleteToken(),i(C.getPermissionStatus()),l(!1)}catch(e){console.error("Error disabling notifications:",e)}finally{c(!1)}}}})(),[o,c]=s.useState(!1);return e?r.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-1 flex items-center gap-2",children:[r.jsx(p,{size:20,className:"text-purple-600"}),"Push Notifications"]}),r.jsx("p",{className:"text-sm text-gray-600",children:"Receive real-time alerts for tasks, messages, and location updates"})]}),t?r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-green-50 rounded-full",children:[r.jsx(u,{size:16,className:"text-green-600"}),r.jsx("span",{className:"text-xs font-semibold text-green-700",children:"Enabled"})]}):r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-gray-50 rounded-full",children:[r.jsx(h,{size:16,className:"text-gray-400"}),r.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Disabled"})]})]}),"denied"===a&&r.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(m,{className:"text-red-600 flex-shrink-0 mt-0.5",size:16}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-red-900 mb-1",children:"Notifications Blocked"}),r.jsx("p",{className:"text-xs text-red-700",children:"Notifications are blocked in your browser settings. To enable them:"}),r.jsxs("ol",{className:"text-xs text-red-700 mt-1 ml-4 list-decimal",children:[r.jsx("li",{children:"Click the lock icon in your browser's address bar"}),r.jsx("li",{children:'Find "Notifications" and change it to "Allow"'}),r.jsx("li",{children:"Refresh this page"})]})]})]})}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[!t&&"denied"!==a&&r.jsx(S,{variant:"filled",onClick:n,disabled:i,loading:i,startIcon:r.jsx(p,{size:18}),className:"flex-1",children:"Enable Notifications"}),t&&r.jsx(S,{variant:"outlined",onClick:l,disabled:i,startIcon:r.jsx(g,{size:18}),className:"flex-1",children:"Disable Notifications"}),r.jsxs("button",{onClick:()=>c(!o),className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-colors",children:[o?"Hide":"Show"," Info"]})]}),o&&r.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"What notifications will you receive?"}),r.jsxs("ul",{className:"space-y-2 text-sm text-gray-600",children:[r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-purple-600 mt-0.5",children:"•"}),r.jsxs("span",{children:[r.jsx("strong",{children:"Task assignments:"})," When a task is assigned to you"]})]}),r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-purple-600 mt-0.5",children:"•"}),r.jsxs("span",{children:[r.jsx("strong",{children:"Task approvals:"})," When someone submits proof for your review"]})]}),r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-purple-600 mt-0.5",children:"•"}),r.jsxs("span",{children:[r.jsx("strong",{children:"New messages:"})," When someone sends a message in your hub"]})]}),r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-purple-600 mt-0.5",children:"•"}),r.jsxs("span",{children:[r.jsx("strong",{children:"Geofence alerts:"})," When family members enter or leave geofenced areas"]})]}),r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-purple-600 mt-0.5",children:"•"}),r.jsxs("span",{children:[r.jsx("strong",{children:"XP updates:"})," When you earn XP or level up"]})]})]})]})]}):r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(m,{className:"text-yellow-600 flex-shrink-0 mt-0.5",size:20}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-yellow-900 mb-1",children:"Notifications Not Supported"}),r.jsx("p",{className:"text-sm text-yellow-700",children:"Your browser does not support push notifications. Please use a modern browser like Chrome, Firefox, or Edge."})]})]})})},R=()=>{const{user:e}=P(),{currentHub:s,currentRole:a}=z(),t=j();return r.jsxs(r.Fragment,{children:[r.jsxs(b,{children:[r.jsx("title",{children:"Settings - Family Safety App"}),r.jsx("meta",{name:"description",content:"Manage your app settings"})]}),r.jsxs("div",{className:"space-y-8",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-headline-lg md:text-display-sm font-normal text-on-surface mb-2",children:"Settings"}),r.jsx("p",{className:"text-body-lg text-on-variant",children:"Manage your profile and preferences"})]}),r.jsxs(v,{elevation:1,children:[r.jsx(k,{title:"Profile"}),r.jsx(w,{children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-label-sm text-on-variant",children:"Name"}),r.jsx("p",{className:"text-body-md text-on-surface",children:e?.displayName})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-label-sm text-on-variant",children:"Email"}),r.jsx("p",{className:"text-body-md text-on-surface",children:e?.email})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-label-sm text-on-variant",children:"Total XP"}),r.jsx("p",{className:"text-body-md text-on-surface",children:e?.xpTotal||0})]})]}),r.jsx("div",{className:"pt-2 border-t border-outline-variant",children:r.jsx(S,{variant:"outlined",onClick:()=>t("/profile"),startIcon:r.jsx(f,{}),children:"Edit Profile"})})]})})]}),s&&r.jsxs(r.Fragment,{children:[r.jsxs(v,{elevation:1,children:[r.jsx(k,{title:"Current Hub"}),r.jsx(w,{children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-label-sm text-on-variant",children:"Hub Name"}),r.jsx("p",{className:"text-body-md text-on-surface font-semibold",children:s.name})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-label-sm text-on-variant mb-2",children:"Your Role"}),r.jsxs("div",{className:"flex items-center gap-2",children:["admin"===a&&r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-purple-100 text-purple-700 rounded-full",children:[r.jsx(n,{size:16}),r.jsx("span",{className:"text-sm font-semibold capitalize",children:"Admin"})]}),"member"===a&&r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-100 text-blue-700 rounded-full",children:[r.jsx(N,{size:16}),r.jsx("span",{className:"text-sm font-semibold capitalize",children:"Member"})]}),"observer"===a&&r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-full",children:[r.jsx(y,{size:16}),r.jsx("span",{className:"text-sm font-semibold capitalize",children:"Observer"})]})]}),r.jsxs("p",{className:"text-xs text-on-variant mt-2",children:["admin"===a&&"You can manage hub settings and members","member"===a&&"You can participate in hub activities","observer"===a&&"You have read-only access to hub content"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-label-sm text-on-variant",children:"Members"}),r.jsx("p",{className:"text-body-md text-on-surface",children:s.members.length})]})]})})]}),"admin"===a&&r.jsx(F,{})]}),r.jsx(M,{})]})]})};export{R as default};
//# sourceMappingURL=SettingsPage-BBeieAsu.js.map
