{"version":3,"mappings":"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","names":["queryClient","QueryClient","defaultOptions","queries","staleTime","gcTime","retry","refetchOnWindowFocus","refetchOnReconnect","mutations","ErrorBoundary","Component","constructor","props","super","this","state","hasError","getDerivedStateFromError","error","componentDidCatch","errorInfo","setState","console","handleRetry","render","fallback","className","children","jsx","jsxs","FiAlertTriangle","onClick","FiRefreshCw","cn","inputs","twMerge","clsx","sizeClasses","small","medium","large","LoadingSpinner","size","text","FiLoader","missingVars","filter","varName","__vite_import_meta_env__","length","Error","join","app","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","auth","getAuth","db","getFirestore","storage","getStorage","getFunctions","window","getAnalytics","messaging","navigator","getMessaging","useAuthStore","create","persist","set","user","isLoading","isAuthenticated","setUser","setLoading","updateCustomClaims","claims","customClaims","logout","name","partialize","defaultFeatureToggles","location","tasks","chat","vault","xp","leaderboard","geofencing","deviceMonitoring","useHubStore","get","currentHub","currentRole","featureToggles","setCurrentHub","hub","role","updateFeatureToggles","toggles","clearCurrentHub","isFeatureEnabled","feature","mapFirebaseUser","async","firebaseUser","tokenResult","getIdTokenResult","id","uid","email","displayName","split","photoURL","emailVerified","xpTotal","hubs","getUserProfile","userId","userDoc","getDoc","doc","exists","success","data","createdAt","toDate","Date","updatedAt","updateUserProfile","updates","userRef","allowedUpdates","phone","bio","finalUpdates","serverTimestamp","log","docExists","updateDoc","setDoc","currentUser","updateProfile","joinHubWithInvite","inviteCode","inviteResponse","code","inviteDoc","invite","hubId","createdBy","expiresAt","maxUses","usedBy","getInviteByCode","membership","status","invitedBy","joinedAt","members","arrayUnion","createHub","hubRef","collection","description","currentHubs","getHubById","hubDoc","getUserHubs","hubIds","hubResponse","push","getUserMembership","membershipDoc","getHubMembers","membershipsQuery","query","snapshot","getDocs","memberships","forEach","docSnap","useAuth","useQueryClient","clearAuth","useEffect","isMounted","onAuthStateChanged","authUser","hubsResponse","firstHub","membershipResponse","hubError","setupAuthListener","registerMutation","useMutation","mutationFn","userCredential","createUserWithEmailAndPassword","password","defaultPreferences","theme","notifications","locationSharing","lowBatteryAlerts","errorMessage","registerUser","onSuccess","response","invalidateQueries","queryKey","loginMutation","signInWithEmailAndPassword","loginUser","logoutMutation","signOut","logoutUser","clear","joinHubMutation","newHub","find","h","register","mutateAsync","login","joinHub","isRegistering","isPending","isLoggingIn","isLoggingOut","isJoiningHub","useUserProfile","useQuery","queryFn","enabled","useHasRole","requiredRole","notificationService","token","isInitialized","firebaseMessaging","warn","isSupported","getPermissionStatus","Notification","permission","requestPermission","toast","getToken","saveTokenToFirestore","tokenRef","platform","getPlatform","userAgent","merge","ua","test","setupForegroundListener","onMessage","payload","notification","title","duration","showBrowserNotification","body","icon","badge","tag","type","requireInteraction","onclick","focus","close","href","deleteToken","deletedAt","getCurrentToken","NotificationInitializer","catch","PageLoaderBar","useLocation","progress","setProgress","useState","isVisible","setIsVisible","prevPathnameRef","useRef","pathname","current","interval","setInterval","prev","clearInterval","Math","random","completeTimer","setTimeout","clearTimeout","style","width","HomePage","lazy","__vitePreload","import","__VITE_PRELOAD__","TestPage","TestStylingPage","SimpleTestPage","LoginPage","RegisterPage","ForgotPasswordPage","DashboardPage","DebugDashboardPage","LocationPage","TasksPage","PendingApprovalsPage","LeaderboardPage","MessagesPage","VaultPage","SettingsPage","ProfilePage","NotFoundPage","AppLayout","ProtectedRoute","App","QueryClientProvider","client","HelmetProvider","Suspense","Routes","Route","path","element","Toaster","position","toastOptions","background","color","iconTheme","primary","secondary","registration","serviceWorker","scope","registerFirebaseMessagingSW","ReactDOM","createRoot","document","getElementById","React","StrictMode","BrowserRouter"],"ignoreList":[],"sources":["../../src/lib/query-client.ts","../../src/components/ErrorBoundary.tsx","../../src/lib/utils/cn.ts","../../src/components/LoadingSpinner.tsx","../../src/config/firebase.ts","../../src/lib/store/auth-store.ts","../../src/lib/store/hub-store.ts","../../src/features/auth/api/auth-api.ts","../../src/features/auth/api/invite-api.ts","../../src/lib/api/hub-api.ts","../../src/features/auth/hooks/useAuth.ts","../../src/lib/services/notification-service.ts","../../src/components/NotificationInitializer.tsx","../../src/components/PageLoader.tsx","../../src/App.tsx","../../src/main.tsx","../../src/lib/utils/register-service-worker.ts"],"sourcesContent":["import { QueryClient } from '@tanstack/react-query';\n\nexport const queryClient = new QueryClient({\n    defaultOptions: {\n        queries: {\n            // Cache for 5 minutes by default\n            staleTime: 5 * 60 * 1000,\n            // Keep in cache for 10 minutes\n            gcTime: 10 * 60 * 1000,\n            // Retry failed requests 3 times\n            retry: 3,\n            // Don't refetch on window focus by default\n            refetchOnWindowFocus: false,\n            // Don't refetch on reconnect by default\n            refetchOnReconnect: false\n        },\n        mutations: {\n            // Retry failed mutations once\n            retry: 1\n        }\n    }\n});\n\n// Query keys factory for consistent key management\nexport const queryKeys = {\n    // Auth\n    auth: {\n        user: ['auth', 'user'] as const,\n        profile: (userId: string) => ['auth', 'profile', userId] as const\n    },\n\n    // Family/Hubs\n    hubs: {\n        all: ['hubs'] as const,\n        list: ['hubs', 'list'] as const,\n        detail: (hubId: string) => ['hubs', 'detail', hubId] as const,\n        members: (hubId: string) => ['hubs', 'members', hubId] as const\n    },\n\n    // Location\n    location: {\n        current: (userId: string) => ['location', 'current', userId] as const,\n        family: (hubId: string) => ['location', 'family', hubId] as const,\n        geofences: (hubId: string) => ['location', 'geofences', hubId] as const\n    },\n\n    // Tasks\n    tasks: {\n        all: ['tasks'] as const,\n        list: (hubId: string) => ['tasks', 'list', hubId] as const,\n        detail: (taskId: string) => ['tasks', 'detail', taskId] as const,\n        assigned: (userId: string) => ['tasks', 'assigned', userId] as const,\n        leaderboard: (hubId: string) => ['tasks', 'leaderboard', hubId] as const\n    },\n\n    // Messages\n    messages: {\n        conversations: ['messages', 'conversations'] as const,\n        conversation: (conversationId: string) => ['messages', 'conversation', conversationId] as const,\n        unread: ['messages', 'unread'] as const\n    },\n\n    // Vault\n    vault: {\n        items: ['vault', 'items'] as const,\n        categories: ['vault', 'categories'] as const,\n        access: ['vault', 'access'] as const\n    },\n\n    // Settings\n    settings: {\n        user: ['settings', 'user'] as const,\n        notifications: ['settings', 'notifications'] as const,\n        privacy: ['settings', 'privacy'] as const\n    }\n} as const;\n","import { Component, ErrorInfo, ReactNode } from 'react';\nimport { FiAlertTriangle, FiRefreshCw } from 'react-icons/fi';\n\ninterface Props {\n    children: ReactNode;\n    fallback?: ReactNode;\n}\n\ninterface State {\n    hasError: boolean;\n    error?: Error;\n    errorInfo?: ErrorInfo;\n}\n\nexport class ErrorBoundary extends Component<Props, State> {\n    constructor(props: Props) {\n        super(props);\n        this.state = { hasError: false };\n    }\n\n    static getDerivedStateFromError(error: Error): State {\n        return { hasError: true, error };\n    }\n\n    componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n        this.setState({ error, errorInfo });\n\n        // Log error to monitoring service in production\n        if (import.meta.env.PROD) {\n            console.error('Error caught by boundary:', error, errorInfo);\n            // TODO: Send to Sentry or similar service\n        }\n    }\n\n    handleRetry = () => {\n        this.setState({ hasError: false, error: undefined, errorInfo: undefined });\n    };\n\n    render() {\n        if (this.state.hasError) {\n            if (this.props.fallback) {\n                return this.props.fallback;\n            }\n\n            return (\n                <div className=\"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8\">\n                    <div className=\"sm:mx-auto sm:w-full sm:max-w-md\">\n                        <div className=\"text-center\">\n                            <FiAlertTriangle className=\"mx-auto h-12 w-12 text-red-500\" />\n                            <h1 className=\"mt-6 text-2xl font-bold text-gray-900\">Something went wrong</h1>\n                            <p className=\"mt-2 text-sm text-gray-600\">\n                                We&apos;re sorry, but something unexpected happened. Please try again.\n                            </p>\n\n                            {import.meta.env.DEV && this.state.error && (\n                                <details className=\"mt-4 text-left\">\n                                    <summary className=\"cursor-pointer text-sm font-medium text-gray-700\">\n                                        Error Details (Development Only)\n                                    </summary>\n                                    <div className=\"mt-2 p-4 bg-gray-100 rounded-md text-xs font-mono text-gray-800\">\n                                        <div className=\"mb-2\">\n                                            <strong>Error:</strong> {this.state.error.message}\n                                        </div>\n                                        <div className=\"mb-2\">\n                                            <strong>Stack:</strong>\n                                            <pre className=\"whitespace-pre-wrap mt-1\">\n                                                {this.state.error.stack}\n                                            </pre>\n                                        </div>\n                                        {this.state.errorInfo && (\n                                            <div>\n                                                <strong>Component Stack:</strong>\n                                                <pre className=\"whitespace-pre-wrap mt-1\">\n                                                    {this.state.errorInfo.componentStack}\n                                                </pre>\n                                            </div>\n                                        )}\n                                    </div>\n                                </details>\n                            )}\n\n                            <div className=\"mt-6\">\n                                <button\n                                    onClick={this.handleRetry}\n                                    className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n                                >\n                                    <FiRefreshCw className=\"w-4 h-4 mr-2\" />\n                                    Try Again\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            );\n        }\n\n        return this.props.children;\n    }\n}\n","import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\n/**\n * Utility function to merge Tailwind classes\n */\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\n\n\n","import { FiLoader } from 'react-icons/fi';\nimport { cn } from '@/lib/utils/cn';\n\ninterface LoadingSpinnerProps {\n    size?: 'small' | 'medium' | 'large';\n    className?: string;\n    text?: string;\n}\n\nconst sizeClasses = {\n    small: 'w-4 h-4',\n    medium: 'w-6 h-6',\n    large: 'w-8 h-8',\n};\n\nexport const LoadingSpinner = ({\n    size = 'medium',\n    className = '',\n    text,\n}: LoadingSpinnerProps) => {\n    return (\n        <div className={cn('flex flex-col items-center justify-center', className)}>\n            <FiLoader className={cn('animate-spin text-primary', sizeClasses[size])} />\n            {text && (\n                <p className=\"mt-2 text-body-sm text-on-variant\">{text}</p>\n            )}\n        </div>\n    );\n};\n\nexport default LoadingSpinner;\n","import { initializeApp } from 'firebase/app';\nimport { getAuth, connectAuthEmulator } from 'firebase/auth';\nimport { getFirestore, connectFirestoreEmulator } from 'firebase/firestore';\nimport { getStorage, connectStorageEmulator } from 'firebase/storage';\nimport { getFunctions, connectFunctionsEmulator } from 'firebase/functions';\nimport { getAnalytics } from 'firebase/analytics';\nimport { getMessaging, isSupported as isMessagingSupported } from 'firebase/messaging';\n\n// Firebase configuration\nconst firebaseConfig = {\n    apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\n    authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,\n    projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\n    storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,\n    messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,\n    appId: import.meta.env.VITE_FIREBASE_APP_ID,\n    measurementId: import.meta.env.VITE_FIREBASE_MEASUREMENT_ID\n};\n\n// Validate required environment variables\nconst requiredEnvVars = [\n    'VITE_FIREBASE_API_KEY',\n    'VITE_FIREBASE_AUTH_DOMAIN',\n    'VITE_FIREBASE_PROJECT_ID',\n    'VITE_FIREBASE_STORAGE_BUCKET',\n    'VITE_FIREBASE_MESSAGING_SENDER_ID',\n    'VITE_FIREBASE_APP_ID'\n];\n\nconst missingVars = requiredEnvVars.filter(varName => !import.meta.env[varName]);\nif (missingVars.length > 0) {\n    throw new Error(`Missing required environment variables: ${missingVars.join(', ')}`);\n}\n\n// Initialize Firebase\nexport const app = initializeApp(firebaseConfig);\n\n// Initialize Firebase services\nexport const auth = getAuth(app);\nexport const db = getFirestore(app);\nexport const storage = getStorage(app);\nexport const functions = getFunctions(app);\n\n// Initialize Analytics (only in production)\nexport const analytics = typeof window !== 'undefined' && !import.meta.env.DEV\n    ? getAnalytics(app)\n    : null;\n\n// Initialize Messaging (only in browser, and only if supported)\n// Note: isMessagingSupported() returns a Promise, so we check synchronously\nconst canUseMessaging = typeof window !== 'undefined' && 'Notification' in window && 'serviceWorker' in navigator;\nexport const messaging = canUseMessaging ? getMessaging(app) : null;\n\n// Connect to emulators in development\nif (import.meta.env.DEV && import.meta.env.VITE_USE_EMULATORS === 'true') {\n    try {\n        // Auth emulator\n        if (!auth.emulatorConfig) {\n            connectAuthEmulator(auth, 'http://localhost:9099');\n        }\n\n        // Firestore emulator\n        if (!(db as any)._delegate?._databaseId?.projectId?.includes('demo-')) {\n            connectFirestoreEmulator(db, 'localhost', 8080);\n        }\n\n        // Storage emulator\n        if (!storage.app.options.storageBucket?.includes('demo-')) {\n            connectStorageEmulator(storage, 'localhost', 9199);\n        }\n\n        // Functions emulator\n        if (!functions.customDomain) {\n            connectFunctionsEmulator(functions, 'localhost', 5001);\n        }\n\n        // eslint-disable-next-line no-console\n        console.log('ðŸ”§ Connected to Firebase emulators');\n    } catch (error) {\n        console.warn('âš ï¸ Failed to connect to Firebase emulators:', error);\n    }\n}\n\nexport default app;","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type { AuthUser, CustomClaims } from '@/types';\n\ninterface AuthState {\n  user: AuthUser | null;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n  \n  // Actions\n  setUser: (user: AuthUser | null) => void;\n  setLoading: (isLoading: boolean) => void;\n  updateCustomClaims: (claims: CustomClaims) => void;\n  logout: () => void;\n}\n\nexport const useAuthStore = create<AuthState>()(\n  persist(\n    (set) => ({\n      user: null,\n      isLoading: true,\n      isAuthenticated: false,\n\n      setUser: (user) =>\n        set({\n          user,\n          isAuthenticated: !!user,\n          isLoading: false,\n        }),\n\n      setLoading: (isLoading) =>\n        set({ isLoading }),\n\n      updateCustomClaims: (claims) =>\n        set((state) => ({\n          user: state.user\n            ? {\n                ...state.user,\n                customClaims: claims,\n              }\n            : null,\n        })),\n\n      logout: () =>\n        set({\n          user: null,\n          isAuthenticated: false,\n          isLoading: false,\n        }),\n    }),\n    {\n      name: 'auth-storage',\n      partialize: (state) => ({\n        user: state.user,\n        isAuthenticated: state.isAuthenticated,\n      }),\n    }\n  )\n);\n\n\n\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type { Hub, UserRole, FeatureToggles } from '@/types';\n\ninterface HubState {\n  currentHub: Hub | null;\n  currentRole: UserRole | null;\n  featureToggles: FeatureToggles | null;\n  \n  // Actions\n  setCurrentHub: (hub: Hub, role: UserRole) => void;\n  updateFeatureToggles: (toggles: FeatureToggles) => void;\n  clearCurrentHub: () => void;\n  isFeatureEnabled: (feature: keyof FeatureToggles) => boolean;\n}\n\nconst defaultFeatureToggles: FeatureToggles = {\n  location: true,\n  tasks: true,\n  chat: true,\n  vault: false,\n  xp: true,\n  leaderboard: true,\n  geofencing: false,\n  deviceMonitoring: true,\n};\n\nexport const useHubStore = create<HubState>()(\n  persist(\n    (set, get) => ({\n      currentHub: null,\n      currentRole: null,\n      featureToggles: null,\n\n      setCurrentHub: (hub, role) =>\n        set({\n          currentHub: hub,\n          currentRole: role,\n          featureToggles: hub.featureToggles || defaultFeatureToggles,\n        }),\n\n      updateFeatureToggles: (toggles) =>\n        set((state) => ({\n          featureToggles: toggles,\n          currentHub: state.currentHub\n            ? {\n                ...state.currentHub,\n                featureToggles: toggles,\n              }\n            : null,\n        })),\n\n      clearCurrentHub: () =>\n        set({\n          currentHub: null,\n          currentRole: null,\n          featureToggles: null,\n        }),\n\n      isFeatureEnabled: (feature) => {\n        const toggles = get().featureToggles;\n        // If no hub selected, use default toggles (show all features)\n        if (!toggles) {\n          return defaultFeatureToggles[feature] ?? true;\n        }\n        return toggles[feature] ?? false;\n      },\n    }),\n    {\n      name: 'hub-storage',\n      partialize: (state) => ({\n        currentHub: state.currentHub,\n        currentRole: state.currentRole,\n        featureToggles: state.featureToggles,\n      }),\n    }\n  )\n);\n\n\n\n","import {\n    createUserWithEmailAndPassword,\n    signInWithEmailAndPassword,\n    signOut,\n    sendPasswordResetEmail,\n    updateProfile,\n    updatePassword,\n    EmailAuthProvider,\n    reauthenticateWithCredential,\n    type User as FirebaseUser,\n} from 'firebase/auth';\nimport { doc, setDoc, getDoc, updateDoc, serverTimestamp } from 'firebase/firestore';\nimport { auth, db } from '@/config/firebase';\nimport type { AuthUser, User, UserPreferences, ApiResponse, UserRole } from '@/types';\nimport type { RegisterFormData, LoginFormData } from '@/lib/validation/auth-schemas';\n\n/**\n * Convert Firebase user to our AuthUser type\n */\nexport const mapFirebaseUser = async (firebaseUser: FirebaseUser): Promise<AuthUser> => {\n    const tokenResult = await firebaseUser.getIdTokenResult();\n\n    return {\n        id: firebaseUser.uid,\n        email: firebaseUser.email!,\n        displayName: firebaseUser.displayName || firebaseUser.email!.split('@')[0],\n        photoURL: firebaseUser.photoURL || undefined,\n        emailVerified: firebaseUser.emailVerified,\n        xpTotal: tokenResult.claims.xpTotal as number | undefined,\n        customClaims: tokenResult.claims.hubs ? {\n            hubs: tokenResult.claims.hubs as Record<string, UserRole>,\n            currentHub: tokenResult.claims.currentHub as string | undefined,\n        } : undefined,\n    };\n};\n\n/**\n * Register a new user\n */\nexport const registerUser = async (\n    data: RegisterFormData\n): Promise<ApiResponse<AuthUser>> => {\n    try {\n        // Create Firebase Auth user\n        const userCredential = await createUserWithEmailAndPassword(\n            auth,\n            data.email,\n            data.password\n        );\n\n        // Update display name\n        await updateProfile(userCredential.user, {\n            displayName: data.displayName,\n        });\n\n        // Create user document in Firestore\n        const userDoc: Omit<User, 'id'> = {\n            email: data.email,\n            displayName: data.displayName,\n            xpTotal: 0,\n            hubs: [],\n            createdAt: new Date(),\n            updatedAt: new Date(),\n        };\n\n        await setDoc(doc(db, 'users', userCredential.user.uid), {\n            ...userDoc,\n            createdAt: serverTimestamp(),\n            updatedAt: serverTimestamp(),\n        });\n\n        // Create default preferences\n        const defaultPreferences: UserPreferences = {\n            theme: 'system',\n            notifications: true,\n            locationSharing: true,\n            lowBatteryAlerts: true,\n        };\n\n        await setDoc(doc(db, 'users', userCredential.user.uid, 'private', 'preferences'), defaultPreferences);\n\n        const authUser = await mapFirebaseUser(userCredential.user);\n\n        return {\n            success: true,\n            data: authUser,\n        };\n    } catch (error: any) {\n        console.error('Registration error:', error);\n\n        let errorMessage = 'Failed to create account';\n        if (error.code === 'auth/email-already-in-use') {\n            errorMessage = 'Email is already registered';\n        } else if (error.code === 'auth/weak-password') {\n            errorMessage = 'Password is too weak';\n        } else if (error.code === 'auth/invalid-email') {\n            errorMessage = 'Invalid email address';\n        }\n\n        return {\n            success: false,\n            error: errorMessage,\n        };\n    }\n};\n\n/**\n * Login user\n */\nexport const loginUser = async (\n    data: LoginFormData\n): Promise<ApiResponse<AuthUser>> => {\n    try {\n        const userCredential = await signInWithEmailAndPassword(\n            auth,\n            data.email,\n            data.password\n        );\n\n        const authUser = await mapFirebaseUser(userCredential.user);\n\n        return {\n            success: true,\n            data: authUser,\n        };\n    } catch (error: any) {\n        console.error('Login error:', error);\n\n        let errorMessage = 'Failed to login';\n        if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {\n            errorMessage = 'Invalid email or password';\n        } else if (error.code === 'auth/too-many-requests') {\n            errorMessage = 'Too many failed attempts. Please try again later';\n        } else if (error.code === 'auth/user-disabled') {\n            errorMessage = 'This account has been disabled';\n        }\n\n        return {\n            success: false,\n            error: errorMessage,\n        };\n    }\n};\n\n/**\n * Logout user\n */\nexport const logoutUser = async (): Promise<ApiResponse<void>> => {\n    try {\n        await signOut(auth);\n        return { success: true };\n    } catch (error: any) {\n        console.error('Logout error:', error);\n        return {\n            success: false,\n            error: 'Failed to logout',\n        };\n    }\n};\n\n/**\n * Send password reset email\n */\nexport const sendPasswordReset = async (email: string): Promise<ApiResponse<void>> => {\n    try {\n        await sendPasswordResetEmail(auth, email);\n        return { success: true };\n    } catch (error: any) {\n        console.error('Password reset error:', error);\n\n        let errorMessage = 'Failed to send reset email';\n        if (error.code === 'auth/user-not-found') {\n            errorMessage = 'No account found with this email';\n        }\n\n        return {\n            success: false,\n            error: errorMessage,\n        };\n    }\n};\n\n/**\n * Change user password\n */\nexport const changeUserPassword = async (\n    currentPassword: string,\n    newPassword: string\n): Promise<ApiResponse<void>> => {\n    try {\n        const user = auth.currentUser;\n        if (!user || !user.email) {\n            throw new Error('No user logged in');\n        }\n\n        // Reauthenticate user\n        const credential = EmailAuthProvider.credential(user.email, currentPassword);\n        await reauthenticateWithCredential(user, credential);\n\n        // Update password\n        await updatePassword(user, newPassword);\n\n        return { success: true };\n    } catch (error: any) {\n        console.error('Password change error:', error);\n\n        let errorMessage = 'Failed to change password';\n        if (error.code === 'auth/wrong-password') {\n            errorMessage = 'Current password is incorrect';\n        } else if (error.code === 'auth/weak-password') {\n            errorMessage = 'New password is too weak';\n        }\n\n        return {\n            success: false,\n            error: errorMessage,\n        };\n    }\n};\n\n/**\n * Get user profile from Firestore\n */\nexport const getUserProfile = async (userId: string): Promise<ApiResponse<User>> => {\n    try {\n        const userDoc = await getDoc(doc(db, 'users', userId));\n\n        if (!userDoc.exists()) {\n            return {\n                success: false,\n                error: 'User not found',\n            };\n        }\n\n        const data = userDoc.data();\n        const user: User = {\n            id: userDoc.id,\n            email: data.email,\n            displayName: data.displayName,\n            photoURL: data.photoURL,\n            xpTotal: data.xpTotal || 0,\n            hubs: data.hubs || [],\n            createdAt: data.createdAt?.toDate() || new Date(),\n            updatedAt: data.updatedAt?.toDate() || new Date(),\n        };\n\n        return {\n            success: true,\n            data: user,\n        };\n    } catch (error: any) {\n        console.error('Get user profile error:', error);\n        return {\n            success: false,\n            error: 'Failed to fetch user profile',\n        };\n    }\n};\n\n/**\n * Update user profile in Firestore\n */\nexport const updateUserProfile = async (\n    userId: string,\n    updates: Partial<User> & { phone?: string; bio?: string }\n): Promise<ApiResponse<void>> => {\n    try {\n        // Check if document exists first\n        const userRef = doc(db, 'users', userId);\n        const userDoc = await getDoc(userRef);\n        \n        // Only update allowed fields (exclude hubs, id, createdAt, email)\n        const allowedUpdates: any = {};\n        if (updates.displayName !== undefined) allowedUpdates.displayName = updates.displayName;\n        if (updates.photoURL !== undefined) allowedUpdates.photoURL = updates.photoURL;\n        if (updates.xpTotal !== undefined) allowedUpdates.xpTotal = updates.xpTotal;\n        if ((updates as any).phone !== undefined) allowedUpdates.phone = (updates as any).phone;\n        if ((updates as any).bio !== undefined) allowedUpdates.bio = (updates as any).bio;\n        \n        // Ensure we're not trying to update restricted fields\n        const finalUpdates = {\n            ...allowedUpdates,\n            updatedAt: serverTimestamp(),\n        };\n        \n        console.log('Updating user profile:', { userId, updates: finalUpdates, docExists: userDoc.exists() });\n        \n        // Use setDoc with merge if document doesn't exist, otherwise use updateDoc\n        if (!userDoc.exists()) {\n            // Document doesn't exist, create it with the updates\n            await setDoc(userRef, {\n                id: userId,\n                email: auth.currentUser?.email || '',\n                displayName: updates.displayName || '',\n                photoURL: updates.photoURL,\n                xpTotal: updates.xpTotal || 0,\n                hubs: [],\n                createdAt: serverTimestamp(),\n                updatedAt: serverTimestamp(),\n                ...allowedUpdates,\n            });\n        } else {\n            // Document exists, update it\n            await updateDoc(userRef, finalUpdates);\n        }\n\n        // Update Firebase Auth display name if provided\n        if (updates.displayName && auth.currentUser) {\n            await updateProfile(auth.currentUser, {\n                displayName: updates.displayName,\n            });\n        }\n\n        return { success: true };\n    } catch (error: any) {\n        console.error('Update profile error:', error);\n        return {\n            success: false,\n            error: 'Failed to update profile',\n        };\n    }\n};\n\n","import {\n  doc,\n  getDoc,\n  setDoc,\n  updateDoc,\n  arrayUnion,\n  serverTimestamp,\n  collection,\n  query,\n  where,\n  getDocs,\n} from 'firebase/firestore';\nimport { db } from '@/config/firebase';\nimport type { Invite, Membership, ApiResponse, UserRole } from '@/types';\n\n/**\n * Generate a random invite code\n */\nconst generateInviteCode = (): string => {\n  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Exclude similar looking characters\n  let code = '';\n  for (let i = 0; i < 8; i++) {\n    code += chars.charAt(Math.floor(Math.random() * chars.length));\n    if (i === 3) code += '-'; // Add hyphen for readability\n  }\n  return code;\n};\n\n/**\n * Create a new invite code for a hub\n */\nexport const createInviteCode = async (\n  hubId: string,\n  createdBy: string,\n  role: UserRole = 'member',\n  expiresInDays: number = 7,\n  maxUses?: number\n): Promise<ApiResponse<Invite>> => {\n  try {\n    const code = generateInviteCode();\n    const expiresAt = new Date();\n    expiresAt.setDate(expiresAt.getDate() + expiresInDays);\n\n    const invite: Omit<Invite, 'createdAt'> = {\n      code,\n      hubId,\n      createdBy,\n      role,\n      expiresAt,\n      maxUses,\n      usedBy: [],\n    };\n\n    await setDoc(doc(db, 'invites', code), {\n      ...invite,\n      expiresAt: expiresAt,\n      createdAt: serverTimestamp(),\n    });\n\n    return {\n      success: true,\n      data: { ...invite, createdAt: new Date() },\n    };\n  } catch (error: any) {\n    console.error('Create invite error:', error);\n    return {\n      success: false,\n      error: 'Failed to create invite code',\n    };\n  }\n};\n\n/**\n * Validate and retrieve an invite code\n */\nexport const getInviteByCode = async (code: string): Promise<ApiResponse<Invite>> => {\n  try {\n    const inviteDoc = await getDoc(doc(db, 'invites', code));\n\n    if (!inviteDoc.exists()) {\n      return {\n        success: false,\n        error: 'Invalid invite code',\n      };\n    }\n\n    const data = inviteDoc.data();\n    const invite: Invite = {\n      code: inviteDoc.id,\n      hubId: data.hubId,\n      createdBy: data.createdBy,\n      role: data.role,\n      expiresAt: data.expiresAt.toDate(),\n      maxUses: data.maxUses,\n      usedBy: data.usedBy || [],\n      createdAt: data.createdAt.toDate(),\n    };\n\n    // Check if invite is expired\n    if (invite.expiresAt < new Date()) {\n      return {\n        success: false,\n        error: 'This invite code has expired',\n      };\n    }\n\n    // Check if invite has reached max uses\n    if (invite.maxUses && invite.usedBy.length >= invite.maxUses) {\n      return {\n        success: false,\n        error: 'This invite code has reached its usage limit',\n      };\n    }\n\n    return {\n      success: true,\n      data: invite,\n    };\n  } catch (error: any) {\n    console.error('Get invite error:', error);\n    return {\n      success: false,\n      error: 'Failed to validate invite code',\n    };\n  }\n};\n\n/**\n * Join a hub using an invite code\n */\nexport const joinHubWithInvite = async (\n  userId: string,\n  inviteCode: string\n): Promise<ApiResponse<{ hubId: string; role: UserRole }>> => {\n  try {\n    // Get and validate invite\n    const inviteResponse = await getInviteByCode(inviteCode);\n    if (!inviteResponse.success || !inviteResponse.data) {\n      return {\n        success: false,\n        error: inviteResponse.error,\n      };\n    }\n\n    const invite = inviteResponse.data;\n\n    // Check if user is already a member\n    const membershipDoc = await getDoc(\n      doc(db, 'hubs', invite.hubId, 'memberships', userId)\n    );\n\n    if (membershipDoc.exists()) {\n      return {\n        success: false,\n        error: 'You are already a member of this hub',\n      };\n    }\n\n    // Create membership\n    const membership: Omit<Membership, 'joinedAt'> = {\n      userId,\n      hubId: invite.hubId,\n      role: invite.role,\n      status: 'active', // Auto-approve with invite code\n      invitedBy: invite.createdBy,\n    };\n\n    await setDoc(doc(db, 'hubs', invite.hubId, 'memberships', userId), {\n      ...membership,\n      joinedAt: serverTimestamp(),\n    });\n\n    // Update hub members array\n    await updateDoc(doc(db, 'hubs', invite.hubId), {\n      members: arrayUnion(userId),\n    });\n\n    // Update user's hubs array\n    await updateDoc(doc(db, 'users', userId), {\n      hubs: arrayUnion(invite.hubId),\n    });\n\n    // Mark invite as used\n    await updateDoc(doc(db, 'invites', inviteCode), {\n      usedBy: arrayUnion(userId),\n    });\n\n    return {\n      success: true,\n      data: {\n        hubId: invite.hubId,\n        role: invite.role,\n      },\n    };\n  } catch (error: any) {\n    console.error('Join hub error:', error);\n    return {\n      success: false,\n      error: 'Failed to join hub',\n    };\n  }\n};\n\n/**\n * Get all active invites for a hub\n */\nexport const getHubInvites = async (hubId: string): Promise<ApiResponse<Invite[]>> => {\n  try {\n    const invitesQuery = query(\n      collection(db, 'invites'),\n      where('hubId', '==', hubId),\n      where('expiresAt', '>', new Date())\n    );\n\n    const snapshot = await getDocs(invitesQuery);\n    const invites: Invite[] = [];\n\n    snapshot.forEach((doc) => {\n      const data = doc.data();\n      invites.push({\n        code: doc.id,\n        hubId: data.hubId,\n        createdBy: data.createdBy,\n        role: data.role,\n        expiresAt: data.expiresAt.toDate(),\n        maxUses: data.maxUses,\n        usedBy: data.usedBy || [],\n        createdAt: data.createdAt.toDate(),\n      });\n    });\n\n    // Filter out invites that reached max uses\n    const activeInvites = invites.filter(\n      (invite) => !invite.maxUses || invite.usedBy.length < invite.maxUses\n    );\n\n    return {\n      success: true,\n      data: activeInvites,\n    };\n  } catch (error: any) {\n    console.error('Get hub invites error:', error);\n    return {\n      success: false,\n      error: 'Failed to fetch invites',\n    };\n  }\n};\n\n/**\n * Delete an invite code\n */\nexport const deleteInviteCode = async (inviteCode: string): Promise<ApiResponse<void>> => {\n  try {\n    await updateDoc(doc(db, 'invites', inviteCode), {\n      expiresAt: new Date(0), // Set to past date to invalidate\n    });\n\n    return { success: true };\n  } catch (error: any) {\n    console.error('Delete invite error:', error);\n    return {\n      success: false,\n      error: 'Failed to delete invite code',\n    };\n  }\n};\n\n\n\n","import {\n    doc,\n    getDoc,\n    setDoc,\n    updateDoc,\n    collection,\n    query,\n    getDocs,\n    serverTimestamp,\n    arrayRemove,\n    deleteDoc,\n} from 'firebase/firestore';\nimport { db } from '@/config/firebase';\nimport type {\n    Hub,\n    Membership,\n    FeatureToggles,\n    UserRole,\n    MembershipStatus,\n    ApiResponse,\n} from '@/types';\nimport type { CreateHubFormData } from '@/lib/validation/hub-schemas';\n\n/**\n * Create a new hub\n */\nexport const createHub = async (\n    data: CreateHubFormData,\n    createdBy: string\n): Promise<ApiResponse<Hub>> => {\n    try {\n        const hubRef = doc(collection(db, 'hubs'));\n\n        const hub: Omit<Hub, 'id' | 'createdAt' | 'updatedAt'> = {\n            name: data.name,\n            description: data.description,\n            createdBy,\n            featureToggles: data.featureToggles,\n            members: [createdBy],\n        };\n\n        await setDoc(hubRef, {\n            ...hub,\n            createdAt: serverTimestamp(),\n            updatedAt: serverTimestamp(),\n        });\n\n        // Create creator's membership as admin\n        const membership: Omit<Membership, 'joinedAt'> = {\n            userId: createdBy,\n            hubId: hubRef.id,\n            role: 'admin',\n            status: 'active',\n        };\n\n        await setDoc(doc(db, 'hubs', hubRef.id, 'memberships', createdBy), {\n            ...membership,\n            joinedAt: serverTimestamp(),\n        });\n\n        // Update user's hubs array\n        const userRef = doc(db, 'users', createdBy);\n        const userDoc = await getDoc(userRef);\n\n        if (userDoc.exists()) {\n            const currentHubs = userDoc.data().hubs || [];\n            await updateDoc(userRef, {\n                hubs: [...currentHubs, hubRef.id],\n            });\n        }\n\n        return {\n            success: true,\n            data: {\n                id: hubRef.id,\n                ...hub,\n                createdAt: new Date(),\n                updatedAt: new Date(),\n            },\n        };\n    } catch (error: any) {\n        console.error('Create hub error:', error);\n        return {\n            success: false,\n            error: 'Failed to create hub',\n        };\n    }\n};\n\n/**\n * Get hub by ID\n */\nexport const getHubById = async (hubId: string): Promise<ApiResponse<Hub>> => {\n    try {\n        const hubDoc = await getDoc(doc(db, 'hubs', hubId));\n\n        if (!hubDoc.exists()) {\n            return {\n                success: false,\n                error: 'Hub not found',\n            };\n        }\n\n        const data = hubDoc.data();\n        const hub: Hub = {\n            id: hubDoc.id,\n            name: data.name,\n            description: data.description,\n            createdBy: data.createdBy,\n            featureToggles: data.featureToggles,\n            members: data.members || [],\n            inviteCode: data.inviteCode,\n            createdAt: data.createdAt?.toDate() || new Date(),\n            updatedAt: data.updatedAt?.toDate() || new Date(),\n        };\n\n        return {\n            success: true,\n            data: hub,\n        };\n    } catch (error: any) {\n        console.error('Get hub error:', error);\n        return {\n            success: false,\n            error: 'Failed to fetch hub',\n        };\n    }\n};\n\n/**\n * Get all hubs for a user\n */\nexport const getUserHubs = async (userId: string): Promise<ApiResponse<Hub[]>> => {\n    try {\n        // Get user document to find hub IDs\n        const userDoc = await getDoc(doc(db, 'users', userId));\n\n        if (!userDoc.exists()) {\n            return {\n                success: false,\n                error: 'User not found',\n            };\n        }\n\n        const hubIds = userDoc.data().hubs || [];\n\n        if (hubIds.length === 0) {\n            return {\n                success: true,\n                data: [],\n            };\n        }\n\n        // Fetch all hubs\n        const hubs: Hub[] = [];\n        for (const hubId of hubIds) {\n            const hubResponse = await getHubById(hubId);\n            if (hubResponse.success && hubResponse.data) {\n                hubs.push(hubResponse.data);\n            }\n        }\n\n        return {\n            success: true,\n            data: hubs,\n        };\n    } catch (error: any) {\n        console.error('Get user hubs error:', error);\n        return {\n            success: false,\n            error: 'Failed to fetch user hubs',\n        };\n    }\n};\n\n/**\n * Get user's membership in a hub\n */\nexport const getUserMembership = async (\n    hubId: string,\n    userId: string\n): Promise<ApiResponse<Membership>> => {\n    try {\n        const membershipDoc = await getDoc(\n            doc(db, 'hubs', hubId, 'memberships', userId)\n        );\n\n        if (!membershipDoc.exists()) {\n            return {\n                success: false,\n                error: 'Membership not found',\n            };\n        }\n\n        const data = membershipDoc.data();\n        const membership: Membership = {\n            userId: data.userId,\n            hubId: data.hubId,\n            role: data.role,\n            status: data.status,\n            joinedAt: data.joinedAt?.toDate() || new Date(),\n            invitedBy: data.invitedBy,\n        };\n\n        return {\n            success: true,\n            data: membership,\n        };\n    } catch (error: any) {\n        console.error('Get membership error:', error);\n        return {\n            success: false,\n            error: 'Failed to fetch membership',\n        };\n    }\n};\n\n/**\n * Get all members of a hub\n */\nexport const getHubMembers = async (hubId: string): Promise<ApiResponse<Membership[]>> => {\n    try {\n        const membershipsQuery = query(collection(db, 'hubs', hubId, 'memberships'));\n        const snapshot = await getDocs(membershipsQuery);\n\n        const memberships: Membership[] = [];\n        snapshot.forEach((docSnap) => {\n            const data = docSnap.data();\n            if (data) {\n                memberships.push({\n                    userId: data.userId as string,\n                    hubId: data.hubId as string,\n                    role: data.role as UserRole,\n                    status: data.status as MembershipStatus,\n                    joinedAt: data.joinedAt?.toDate() || new Date(),\n                    invitedBy: data.invitedBy as string | undefined,\n                });\n            }\n        });\n\n        return {\n            success: true,\n            data: memberships,\n        };\n    } catch (error: any) {\n        console.error('Get hub members error:', error);\n        return {\n            success: false,\n            error: 'Failed to fetch hub members',\n        };\n    }\n};\n\n/**\n * Update hub details\n */\nexport const updateHub = async (\n    hubId: string,\n    updates: Partial<Hub>\n): Promise<ApiResponse<void>> => {\n    try {\n        await updateDoc(doc(db, 'hubs', hubId), {\n            ...updates,\n            updatedAt: serverTimestamp(),\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error('Update hub error:', error);\n        return {\n            success: false,\n            error: 'Failed to update hub',\n        };\n    }\n};\n\n/**\n * Update hub feature toggles\n */\nexport const updateFeatureToggles = async (\n    hubId: string,\n    toggles: FeatureToggles\n): Promise<ApiResponse<void>> => {\n    try {\n        await updateDoc(doc(db, 'hubs', hubId), {\n            featureToggles: toggles,\n            updatedAt: serverTimestamp(),\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error('Update feature toggles error:', error);\n        return {\n            success: false,\n            error: 'Failed to update feature toggles',\n        };\n    }\n};\n\n/**\n * Update member role\n */\nexport const updateMemberRole = async (\n    hubId: string,\n    userId: string,\n    newRole: UserRole\n): Promise<ApiResponse<void>> => {\n    try {\n        await updateDoc(doc(db, 'hubs', hubId, 'memberships', userId), {\n            role: newRole,\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error('Update member role error:', error);\n        return {\n            success: false,\n            error: 'Failed to update member role',\n        };\n    }\n};\n\n/**\n * Remove member from hub\n */\nexport const removeMemberFromHub = async (\n    hubId: string,\n    userId: string\n): Promise<ApiResponse<void>> => {\n    try {\n        // Delete membership\n        await deleteDoc(doc(db, 'hubs', hubId, 'memberships', userId));\n\n        // Remove from hub members array\n        await updateDoc(doc(db, 'hubs', hubId), {\n            members: arrayRemove(userId),\n        });\n\n        // Remove hub from user's hubs array\n        await updateDoc(doc(db, 'users', userId), {\n            hubs: arrayRemove(hubId),\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error('Remove member error:', error);\n        return {\n            success: false,\n            error: 'Failed to remove member from hub',\n        };\n    }\n};\n\n/**\n * Leave hub (user removing themselves)\n */\nexport const leaveHub = async (\n    hubId: string,\n    userId: string\n): Promise<ApiResponse<void>> => {\n    try {\n        // Check if user is the only admin\n        const membersResponse = await getHubMembers(hubId);\n        if (!membersResponse.success || !membersResponse.data) {\n            throw new Error('Failed to check members');\n        }\n\n        const admins = membersResponse.data.filter((m) => m.role === 'admin');\n        const isOnlyAdmin = admins.length === 1 && admins[0].userId === userId;\n\n        if (isOnlyAdmin) {\n            return {\n                success: false,\n                error: 'Cannot leave hub as the only admin. Please assign another admin first.',\n            };\n        }\n\n        return await removeMemberFromHub(hubId, userId);\n    } catch (error: any) {\n        console.error('Leave hub error:', error);\n        return {\n            success: false,\n            error: 'Failed to leave hub',\n        };\n    }\n};\n\n","import { useEffect } from 'react';\nimport { onAuthStateChanged } from 'firebase/auth';\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\nimport { auth } from '@/config/firebase';\nimport { useAuthStore } from '@/lib/store/auth-store';\nimport { useHubStore } from '@/lib/store/hub-store';\nimport {\n  registerUser,\n  loginUser,\n  logoutUser,\n  mapFirebaseUser,\n  getUserProfile,\n} from '../api/auth-api';\nimport { joinHubWithInvite } from '../api/invite-api';\nimport { getUserHubs, getUserMembership } from '@/lib/api/hub-api';\nimport type { RegisterFormData, LoginFormData } from '@/lib/validation/auth-schemas';\n\n/**\n * Main authentication hook\n */\nexport const useAuth = () => {\n  const queryClient = useQueryClient();\n  const { user, isLoading, isAuthenticated, setUser, setLoading, logout: clearAuth } = useAuthStore();\n  const { setCurrentHub, clearCurrentHub } = useHubStore();\n\n  // Listen to Firebase auth state changes\n  useEffect(() => {\n    let isMounted = true;\n    \n    const setupAuthListener = async () => {\n      if (!isMounted) return;\n      \n      setLoading(true);\n\n      const unsubscribe = onAuthStateChanged(auth, async (firebaseUser) => {\n        if (!isMounted) return;\n\n        if (firebaseUser) {\n          try {\n            const authUser = await mapFirebaseUser(firebaseUser);\n            if (isMounted) {\n              setUser(authUser);\n            }\n\n            // Try to load user's hubs (optional - don't fail if no hubs exist)\n            try {\n              const hubsResponse = await getUserHubs(firebaseUser.uid);\n              if (isMounted && hubsResponse.success && hubsResponse.data && hubsResponse.data.length > 0) {\n                // Set first hub as current if none selected\n                const firstHub = hubsResponse.data[0];\n                const membershipResponse = await getUserMembership(firstHub.id, firebaseUser.uid);\n\n                if (isMounted && membershipResponse.success && membershipResponse.data) {\n                  setCurrentHub(firstHub, membershipResponse.data.role);\n                }\n              }\n            } catch (hubError) {\n              // Hub loading failed - this is OK for new users\n              console.log('No hubs found for user or hub loading failed:', hubError);\n            }\n          } catch (error) {\n            console.error('Error mapping Firebase user:', error);\n            if (isMounted) {\n              setUser(null);\n            }\n          }\n        } else {\n          if (isMounted) {\n            setUser(null);\n            clearCurrentHub();\n          }\n        }\n\n        if (isMounted) {\n          setLoading(false);\n        }\n      });\n\n      return unsubscribe;\n    };\n\n    setupAuthListener();\n\n    return () => {\n      isMounted = false;\n    };\n  }, []);\n\n  // Register mutation\n  const registerMutation = useMutation({\n    mutationFn: (data: RegisterFormData) => registerUser(data),\n    onSuccess: (response) => {\n      if (response.success && response.data) {\n        queryClient.invalidateQueries({ queryKey: ['auth'] });\n      }\n    },\n  });\n\n  // Login mutation\n  const loginMutation = useMutation({\n    mutationFn: (data: LoginFormData) => loginUser(data),\n    onSuccess: (response) => {\n      if (response.success && response.data) {\n        queryClient.invalidateQueries({ queryKey: ['auth'] });\n      }\n    },\n  });\n\n  // Logout mutation\n  const logoutMutation = useMutation({\n    mutationFn: () => logoutUser(),\n    onSuccess: () => {\n      clearAuth();\n      clearCurrentHub();\n      queryClient.clear();\n    },\n  });\n\n  // Join hub with invite mutation\n  const joinHubMutation = useMutation({\n    mutationFn: (inviteCode: string) => {\n      if (!user) throw new Error('User not authenticated');\n      return joinHubWithInvite(user.id, inviteCode);\n    },\n    onSuccess: async (response) => {\n      if (response.success && response.data && user) {\n        // Reload user's hubs\n        queryClient.invalidateQueries({ queryKey: ['hubs', user.id] });\n\n        // Switch to the new hub\n        const { hubId, role } = response.data;\n        const hubsResponse = await getUserHubs(user.id);\n        if (hubsResponse.success && hubsResponse.data) {\n          const newHub = hubsResponse.data.find(h => h.id === hubId);\n          if (newHub) {\n            setCurrentHub(newHub, role);\n          }\n        }\n      }\n    },\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated,\n    register: registerMutation.mutateAsync,\n    login: loginMutation.mutateAsync,\n    logout: logoutMutation.mutateAsync,\n    joinHub: joinHubMutation.mutateAsync,\n    isRegistering: registerMutation.isPending,\n    isLoggingIn: loginMutation.isPending,\n    isLoggingOut: logoutMutation.isPending,\n    isJoiningHub: joinHubMutation.isPending,\n  };\n};\n\n/**\n * Hook to fetch user profile\n */\nexport const useUserProfile = (userId: string | undefined) => {\n  return useQuery({\n    queryKey: ['user', 'profile', userId],\n    queryFn: async () => {\n      if (!userId) throw new Error('User ID is required');\n      const response = await getUserProfile(userId);\n      if (!response.success) throw new Error(response.error);\n      return response.data;\n    },\n    enabled: !!userId,\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n};\n\n/**\n * Hook to check if user has a specific role in current hub\n */\nexport const useHasRole = (requiredRole: 'admin' | 'member' | 'observer') => {\n  const { currentRole } = useHubStore();\n\n  if (!currentRole) return false;\n\n  // Admin has all permissions\n  if (currentRole === 'admin') return true;\n\n  // Member has member and observer permissions\n  if (currentRole === 'member' && (requiredRole === 'member' || requiredRole === 'observer')) {\n    return true;\n  }\n\n  // Observer only has observer permissions\n  if (currentRole === 'observer' && requiredRole === 'observer') {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * Hook to check if a feature is enabled in current hub\n */\nexport const useFeatureEnabled = (feature: keyof import('@/types').FeatureToggles) => {\n  const { isFeatureEnabled } = useHubStore();\n  return isFeatureEnabled(feature);\n};\n","/**\n * Notification Service\n * \n * Handles push notifications using Firebase Cloud Messaging (FCM)\n * - Request notification permission\n * - Get FCM token\n * - Store token in Firestore\n * - Handle foreground notifications\n */\n\nimport { getMessaging, getToken, onMessage, Messaging } from 'firebase/messaging';\nimport { getAuth } from 'firebase/auth';\nimport { doc, setDoc, getDoc } from 'firebase/firestore';\nimport { db, app, messaging as firebaseMessaging } from '@/config/firebase';\nimport toast from 'react-hot-toast';\n\n// VAPID key - should be in environment variables\n// In production, get this from Firebase Console > Project Settings > Cloud Messaging\nconst VAPID_KEY = import.meta.env.VITE_FCM_VAPID_KEY || '';\n\nclass NotificationService {\n    private messaging: Messaging | null = null;\n    private token: string | null = null;\n    private isInitialized = false;\n\n    constructor() {\n        // Use the messaging instance from firebase.ts if available\n        if (firebaseMessaging) {\n            this.messaging = firebaseMessaging;\n            this.isInitialized = true;\n        } else if (typeof window !== 'undefined' && 'Notification' in window && 'serviceWorker' in navigator) {\n            // Fallback: try to initialize if not already done\n            try {\n                this.messaging = getMessaging(app);\n                this.isInitialized = true;\n            } catch (error) {\n                console.warn('Firebase Messaging not available:', error);\n            }\n        }\n    }\n\n    /**\n     * Check if notifications are supported\n     */\n    isSupported(): boolean {\n        return (\n            typeof window !== 'undefined' &&\n            'Notification' in window &&\n            'serviceWorker' in navigator &&\n            this.isInitialized &&\n            !!this.messaging\n        );\n    }\n\n    /**\n     * Check current notification permission status\n     */\n    getPermissionStatus(): NotificationPermission {\n        if (!('Notification' in window)) {\n            return 'denied';\n        }\n        return Notification.permission;\n    }\n\n    /**\n     * Request notification permission\n     */\n    async requestPermission(): Promise<boolean> {\n        if (!this.isSupported()) {\n            console.warn('Notifications not supported');\n            return false;\n        }\n\n        if (!('Notification' in window)) {\n            toast.error('Your browser does not support notifications');\n            return false;\n        }\n\n        // Check if already granted\n        if (Notification.permission === 'granted') {\n            return await this.getToken();\n        }\n\n        // Check if denied\n        if (Notification.permission === 'denied') {\n            toast.error('Notification permission was denied. Please enable it in your browser settings.');\n            return false;\n        }\n\n        // Request permission\n        try {\n            const permission = await Notification.requestPermission();\n            if (permission === 'granted') {\n                toast.success('Notifications enabled!');\n                return await this.getToken();\n            } else {\n                toast.error('Notification permission denied');\n                return false;\n            }\n        } catch (error) {\n            console.error('Error requesting notification permission:', error);\n            toast.error('Failed to request notification permission');\n            return false;\n        }\n    }\n\n    /**\n     * Get FCM token\n     */\n    async getToken(): Promise<boolean> {\n        if (!this.isSupported() || !this.messaging || !VAPID_KEY) {\n            console.warn('FCM not configured - missing VAPID key');\n            return false;\n        }\n\n        try {\n            const auth = getAuth();\n            if (!auth.currentUser) {\n                console.warn('User not authenticated');\n                return false;\n            }\n\n            // Get token from FCM\n            const currentToken = await getToken(this.messaging, {\n                vapidKey: VAPID_KEY,\n            });\n\n            if (currentToken) {\n                this.token = currentToken;\n                console.log('FCM Token:', currentToken);\n\n                // Store token in Firestore\n                await this.saveTokenToFirestore(currentToken);\n                return true;\n            } else {\n                console.warn('No registration token available');\n                return false;\n            }\n        } catch (error: any) {\n            console.error('Error getting FCM token:', error);\n            if (error.code === 'messaging/permission-blocked') {\n                toast.error('Notification permission is blocked');\n            } else if (error.code === 'messaging/registration-token-not-registered') {\n                console.warn('Registration token not registered');\n            }\n            return false;\n        }\n    }\n\n    /**\n     * Save FCM token to Firestore\n     */\n    private async saveTokenToFirestore(token: string): Promise<void> {\n        try {\n            const auth = getAuth();\n            if (!auth.currentUser) {\n                return;\n            }\n\n            const userId = auth.currentUser.uid;\n            const tokenRef = doc(db, 'users', userId, 'tokens', 'fcm');\n\n            await setDoc(tokenRef, {\n                token,\n                updatedAt: new Date(),\n                platform: this.getPlatform(),\n                userAgent: navigator.userAgent,\n            }, { merge: true });\n\n            console.log('FCM token saved to Firestore');\n        } catch (error) {\n            console.error('Error saving FCM token:', error);\n        }\n    }\n\n    /**\n     * Get platform information\n     */\n    private getPlatform(): string {\n        const ua = navigator.userAgent;\n        if (/android/i.test(ua)) return 'android';\n        if (/iPad|iPhone|iPod/.test(ua)) return 'ios';\n        if (/Mac/.test(ua)) return 'macos';\n        if (/Win/.test(ua)) return 'windows';\n        if (/Linux/.test(ua)) return 'linux';\n        return 'unknown';\n    }\n\n    /**\n     * Set up foreground message listener\n     */\n    setupForegroundListener(): void {\n        if (!this.isSupported() || !this.messaging) {\n            return;\n        }\n\n        onMessage(this.messaging, (payload) => {\n            console.log('Foreground message received:', payload);\n\n            // Show toast notification\n            const notification = payload.notification;\n            if (notification) {\n                toast(notification.title || 'New notification', {\n                    // Note: react-hot-toast doesn't support description, using title with body\n                    duration: 5000,\n                });\n            }\n\n            // Show browser notification if permission granted\n            if (Notification.permission === 'granted') {\n                this.showBrowserNotification(\n                    notification?.title || 'FamilyTracker',\n                    notification?.body || 'You have a new notification',\n                    notification?.icon,\n                    payload.data\n                );\n            }\n        });\n    }\n\n    /**\n     * Show browser notification\n     */\n    private showBrowserNotification(\n        title: string,\n        body: string,\n        icon?: string,\n        data?: any\n    ): void {\n        if (Notification.permission !== 'granted') {\n            return;\n        }\n\n        const notification = new Notification(title, {\n            body,\n            icon: icon || '/logo192.png',\n            badge: '/favicon.ico',\n            tag: data?.type || 'default',\n            data,\n            requireInteraction: false,\n        });\n\n        notification.onclick = () => {\n            window.focus();\n            notification.close();\n\n            // Navigate based on notification type\n            if (data?.type === 'task') {\n                window.location.href = '/tasks';\n            } else if (data?.type === 'message') {\n                window.location.href = '/messages';\n            } else if (data?.type === 'geofence') {\n                window.location.href = '/map';\n            } else if (data?.type === 'approval') {\n                window.location.href = '/tasks/pending-approvals';\n            }\n        };\n    }\n\n    /**\n     * Delete FCM token from Firestore\n     */\n    async deleteToken(): Promise<void> {\n        try {\n            const auth = getAuth();\n            if (!auth.currentUser) {\n                return;\n            }\n\n            const userId = auth.currentUser.uid;\n            const tokenRef = doc(db, 'users', userId, 'tokens', 'fcm');\n            const tokenDoc = await getDoc(tokenRef);\n\n            if (tokenDoc.exists()) {\n                await setDoc(tokenRef, {\n                    token: null,\n                    deletedAt: new Date(),\n                }, { merge: true });\n            }\n\n            this.token = null;\n            console.log('FCM token deleted');\n        } catch (error) {\n            console.error('Error deleting FCM token:', error);\n        }\n    }\n\n    /**\n     * Get current token\n     */\n    getCurrentToken(): string | null {\n        return this.token;\n    }\n}\n\n// Export singleton instance\nexport const notificationService = new NotificationService();\n\n","/**\n * NotificationInitializer Component\n * \n * Initializes push notifications when user is authenticated\n */\n\nimport { useEffect } from 'react';\nimport { useAuth } from '@/features/auth/hooks/useAuth';\nimport { notificationService } from '@/lib/services/notification-service';\n\nexport const NotificationInitializer = () => {\n    const { isAuthenticated } = useAuth();\n\n    useEffect(() => {\n        if (isAuthenticated && notificationService.isSupported()) {\n            // Set up foreground message listener\n            notificationService.setupForegroundListener();\n\n            // If permission is already granted, get token\n            if (notificationService.getPermissionStatus() === 'granted') {\n                notificationService.getToken().catch(console.error);\n            }\n        }\n    }, [isAuthenticated]);\n\n    return null; // This component doesn't render anything\n};\n\n","import { useEffect, useState, useRef } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { FiLoader } from 'react-icons/fi';\nimport { cn } from '@/lib/utils/cn';\n\n/**\n * PageLoader Component\n * \n * Shows a full-screen loader during page navigation transitions.\n * Works with BrowserRouter by tracking location changes.\n */\nexport const PageLoader = () => {\n    const location = useLocation();\n    const [isNavigating, setIsNavigating] = useState(false);\n    const [progress, setProgress] = useState(0);\n    const prevPathnameRef = useRef(location.pathname);\n\n    // Show loader when pathname changes\n    useEffect(() => {\n        // Only show loader if pathname actually changed\n        if (prevPathnameRef.current !== location.pathname) {\n            setIsNavigating(true);\n            setProgress(0);\n            \n            // Simulate progress bar\n            const interval = setInterval(() => {\n                setProgress((prev) => {\n                    if (prev >= 90) {\n                        clearInterval(interval);\n                        return 90;\n                    }\n                    return prev + 10;\n                });\n            }, 100);\n\n            // Complete progress after a short delay (simulating page load)\n            const completeTimer = setTimeout(() => {\n                setProgress(100);\n                setTimeout(() => {\n                    setIsNavigating(false);\n                    setProgress(0);\n                }, 200);\n            }, 300);\n\n            prevPathnameRef.current = location.pathname;\n\n            return () => {\n                clearInterval(interval);\n                clearTimeout(completeTimer);\n            };\n        }\n    }, [location.pathname]);\n\n    if (!isNavigating) {\n        return null;\n    }\n\n    return (\n        <div\n            className={cn(\n                'fixed inset-0 z-[9999] flex flex-col items-center justify-center',\n                'bg-background/95 backdrop-blur-sm',\n                'transition-opacity duration-fast',\n                isNavigating ? 'opacity-100' : 'opacity-0 pointer-events-none'\n            )}\n            aria-live=\"polite\"\n            aria-busy={isNavigating}\n        >\n            {/* Animated Spinner */}\n            <div className=\"relative mb-8\">\n                {/* Outer ring */}\n                <div className=\"w-16 h-16 rounded-full border-4 border-primary-container animate-spin border-t-primary\"></div>\n                \n                {/* Inner icon */}\n                <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <FiLoader className=\"w-6 h-6 text-primary animate-spin\" />\n                </div>\n            </div>\n\n            {/* Progress Bar */}\n            <div className=\"w-64 max-w-[80vw]\">\n                <div className=\"h-1 bg-surface-variant rounded-full overflow-hidden\">\n                    <div\n                        className=\"h-full bg-gradient-to-r from-primary via-purple-600 to-indigo-600 rounded-full transition-all duration-fast ease-out\"\n                        style={{ width: `${progress}%` }}\n                    />\n                </div>\n            </div>\n\n            {/* Loading Text */}\n            <p className=\"mt-6 text-body-md text-on-variant animate-pulse\">\n                Loading page...\n            </p>\n        </div>\n    );\n};\n\n/**\n * PageLoaderBar Component\n * \n * A minimal top progress bar for page navigation.\n * Less intrusive than full-screen loader.\n * Works with BrowserRouter by tracking location changes.\n */\nexport const PageLoaderBar = () => {\n    const location = useLocation();\n    const [progress, setProgress] = useState(0);\n    const [isVisible, setIsVisible] = useState(false);\n    const prevPathnameRef = useRef(location.pathname);\n\n    useEffect(() => {\n        // Only show loader if pathname actually changed\n        if (prevPathnameRef.current !== location.pathname) {\n            setIsVisible(true);\n            setProgress(0);\n            \n            // Simulate progress\n            const interval = setInterval(() => {\n                setProgress((prev) => {\n                    if (prev >= 90) {\n                        clearInterval(interval);\n                        return 90;\n                    }\n                    return prev + Math.random() * 15;\n                });\n            }, 100);\n\n            // Complete progress after a short delay (wait for page to load)\n            const completeTimer = setTimeout(() => {\n                setProgress(100);\n                setTimeout(() => {\n                    setIsVisible(false);\n                    setProgress(0);\n                }, 300);\n            }, 500); // Increased delay to account for lazy loading\n\n            prevPathnameRef.current = location.pathname;\n\n            return () => {\n                clearInterval(interval);\n                clearTimeout(completeTimer);\n            };\n        }\n    }, [location.pathname]);\n\n    if (!isVisible) {\n        return null;\n    }\n\n    return (\n        <div\n            className={cn(\n                'fixed top-0 left-0 right-0 z-[9999] h-1',\n                'transition-opacity duration-fast',\n                isVisible ? 'opacity-100' : 'opacity-0'\n            )}\n            role=\"progressbar\"\n            aria-valuenow={progress}\n            aria-valuemin={0}\n            aria-valuemax={100}\n            aria-label=\"Page loading\"\n        >\n            <div\n                className=\"h-full bg-gradient-to-r from-primary via-purple-600 to-indigo-600 transition-all duration-fast ease-out shadow-lg\"\n                style={{ width: `${progress}%` }}\n            />\n        </div>\n    );\n};\n\nexport default PageLoader;\n\n","import { Suspense, lazy } from 'react';\nimport { Routes, Route } from 'react-router-dom';\nimport { QueryClientProvider } from '@tanstack/react-query';\nimport { ReactQueryDevtools } from '@tanstack/react-query-devtools';\nimport { HelmetProvider } from 'react-helmet-async';\nimport { Toaster } from 'react-hot-toast';\n\n// Core providers and utilities\nimport { queryClient } from '@/lib/query-client';\nimport { ErrorBoundary } from '@/components/ErrorBoundary';\nimport { LoadingSpinner } from '@/components/LoadingSpinner';\nimport { NotificationInitializer } from '@/components/NotificationInitializer';\nimport { PageLoaderBar } from '@/components/PageLoader';\n\n// Lazy load pages for code splitting\nconst HomePage = lazy(() => import('@/features/auth/pages/HomePage'));\nconst TestPage = lazy(() => import('@/features/auth/pages/TestPage'));\nconst TestStylingPage = lazy(() => import('@/features/auth/pages/TestStylingPage'));\nconst SimpleTestPage = lazy(() => import('@/features/auth/pages/SimpleTestPage'));\nconst LoginPage = lazy(() => import('@/features/auth/pages/LoginPage'));\nconst RegisterPage = lazy(() => import('@/features/auth/pages/RegisterPage'));\nconst ForgotPasswordPage = lazy(() => import('@/features/auth/pages/ForgotPasswordPage'));\nconst DashboardPage = lazy(() => import('@/features/dashboard/pages/DashboardPage'));\nconst DebugDashboardPage = lazy(() => import('@/features/dashboard/pages/DebugDashboardPage'));\nconst LocationPage = lazy(() => import('@/features/location/pages/LocationPage'));\nconst TasksPage = lazy(() => import('@/features/tasks/pages/TasksPage'));\nconst PendingApprovalsPage = lazy(() => import('@/features/tasks/pages/PendingApprovalsPage'));\nconst LeaderboardPage = lazy(() => import('@/features/xp/pages/LeaderboardPage'));\nconst MessagesPage = lazy(() => import('@/features/messages/pages/MessagesPage'));\nconst VaultPage = lazy(() => import('@/features/vault/pages/VaultPage'));\nconst SettingsPage = lazy(() => import('@/features/settings/pages/SettingsPage'));\nconst ProfilePage = lazy(() => import('@/features/profile/pages/ProfilePage'));\nconst NotFoundPage = lazy(() => import('@/features/auth/pages/NotFoundPage'));\n\n// Layout components\nconst AppLayout = lazy(() => import('@/components/AppLayout'));\nconst ProtectedRoute = lazy(() => import('@/components/ProtectedRoute'));\n\nfunction App() {\n  return (\n    <ErrorBoundary>\n      <QueryClientProvider client={queryClient}>\n        <HelmetProvider>\n          <NotificationInitializer />\n          <PageLoaderBar />\n          <div className=\"App\">\n            <Suspense fallback={\n              <div className=\"min-h-screen flex items-center justify-center bg-background\">\n                <LoadingSpinner size=\"large\" text=\"Loading page...\" />\n              </div>\n            }>\n              <Routes>\n                {/* Public Routes */}\n                <Route path=\"/\" element={<HomePage />} />\n                <Route path=\"/test\" element={<TestPage />} />\n                <Route path=\"/test-styling\" element={<TestStylingPage />} />\n                <Route path=\"/simple-test\" element={<SimpleTestPage />} />\n                <Route path=\"/debug-dashboard\" element={<DebugDashboardPage />} />\n                <Route path=\"/login\" element={<LoginPage />} />\n                <Route path=\"/register\" element={<RegisterPage />} />\n                <Route path=\"/forgot-password\" element={<ForgotPasswordPage />} />\n\n                {/* Protected Routes */}\n                <Route element={\n                  <ProtectedRoute>\n                    <AppLayout />\n                  </ProtectedRoute>\n                }>\n                  {/* Map is the main screen (Life360 style) */}\n                  <Route path=\"/map\" element={<LocationPage />} />\n                  <Route path=\"/dashboard\" element={<DashboardPage />} />\n                  <Route path=\"/tasks\" element={<TasksPage />} />\n                  <Route path=\"/tasks/pending-approvals\" element={<PendingApprovalsPage />} />\n                  <Route path=\"/leaderboard\" element={<LeaderboardPage />} />\n                  <Route path=\"/messages\" element={<MessagesPage />} />\n                  <Route path=\"/vault\" element={<VaultPage />} />\n                  <Route path=\"/settings\" element={<SettingsPage />} />\n                  <Route path=\"/profile\" element={<ProfilePage />} />\n                </Route>\n\n                {/* 404 Route */}\n                <Route path=\"*\" element={<NotFoundPage />} />\n              </Routes>\n            </Suspense>\n\n            {/* Toast notifications */}\n            <Toaster\n              position=\"top-right\"\n              toastOptions={{\n                duration: 4000,\n                style: {\n                  background: '#363636',\n                  color: '#fff',\n                },\n                success: {\n                  duration: 3000,\n                  iconTheme: {\n                    primary: '#4ade80',\n                    secondary: '#fff',\n                  },\n                },\n                error: {\n                  duration: 5000,\n                  iconTheme: {\n                    primary: '#ef4444',\n                    secondary: '#fff',\n                  },\n                },\n              }}\n            />\n          </div>\n        </HelmetProvider>\n\n        {/* React Query DevTools */}\n        {import.meta.env.DEV && <ReactQueryDevtools initialIsOpen={false} />}\n      </QueryClientProvider>\n    </ErrorBoundary>\n  );\n}\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport { BrowserRouter } from 'react-router-dom';\nimport App from './App';\nimport './styles/index.css';\nimport { registerFirebaseMessagingSW } from './lib/utils/register-service-worker';\n\n// Register Firebase Messaging service worker\nif ('serviceWorker' in navigator) {\n    registerFirebaseMessagingSW().catch(console.error);\n}\n\nconst root = ReactDOM.createRoot(document.getElementById('root') as HTMLElement);\nroot.render(\n  <React.StrictMode>\n    <BrowserRouter>\n      <App />\n    </BrowserRouter>\n  </React.StrictMode>\n);\n","/**\n * Service Worker Registration\n * \n * Registers the service worker for PWA and push notifications\n */\n\nexport const registerServiceWorker = async (): Promise<ServiceWorkerRegistration | null> => {\n    if ('serviceWorker' in navigator) {\n        try {\n            // Register the main service worker (handled by VitePWA)\n            // The firebase-messaging-sw.js will be registered separately by Firebase\n            \n            // Check if service worker is already registered\n            const registration = await navigator.serviceWorker.ready;\n            console.log('Service Worker already registered');\n            return registration;\n        } catch (error) {\n            console.warn('Service Worker registration failed:', error);\n            return null;\n        }\n    } else {\n        console.warn('Service Workers are not supported');\n        return null;\n    }\n};\n\n/**\n * Register Firebase Messaging Service Worker\n */\nexport const registerFirebaseMessagingSW = async (): Promise<ServiceWorkerRegistration | null> => {\n    if ('serviceWorker' in navigator) {\n        try {\n            // Register Firebase Messaging service worker\n            const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js', {\n                scope: '/',\n            });\n            \n            console.log('Firebase Messaging Service Worker registered:', registration);\n            return registration;\n        } catch (error) {\n            console.warn('Firebase Messaging Service Worker registration failed:', error);\n            return null;\n        }\n    }\n    return null;\n};\n\n"],"file":"assets/index-XwJoYhXH.js"}