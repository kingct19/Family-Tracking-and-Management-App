{"version":3,"file":"PendingApprovalsPage-DqwjWkqi.js","sources":["../../src/features/tasks/pages/PendingApprovalsPage.tsx"],"sourcesContent":["import { Helmet } from 'react-helmet-async';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent } from '@/components/ui/Card';\nimport { Button } from '@/components/ui/Button';\nimport { LoadingSpinner } from '@/components/LoadingSpinner';\nimport { PendingApprovalSkeleton } from '@/components/ui/Skeleton';\nimport { useHubStore } from '@/lib/store/hub-store';\nimport { useAuth } from '@/features/auth/hooks/useAuth';\nimport { getHubTasks } from '@/features/tasks/api/task-api';\nimport { updateTask } from '@/features/tasks/api/task-api';\nimport { awardXP } from '@/features/xp/api/xp-api';\nimport { FiCheck, FiX, FiImage, FiClock, FiUser } from 'react-icons/fi';\nimport toast from 'react-hot-toast';\nimport type { Task } from '@/types';\n\nconst PendingApprovalsPage = () => {\n    const { currentHub } = useHubStore();\n    const { user } = useAuth();\n    const queryClient = useQueryClient();\n\n    // Fetch tasks with pending proof\n    const { data: tasks, isLoading } = useQuery({\n        queryKey: ['tasks', 'hub', currentHub?.id, 'pending-proof'],\n        queryFn: async () => {\n            if (!currentHub) throw new Error('No hub selected');\n            const response = await getHubTasks(currentHub.id);\n            if (!response.success) throw new Error(response.error);\n            // Filter tasks with pending proof\n            return (response.data || []).filter(\n                (task) => task.proofStatus === 'pending' && task.proofURL\n            );\n        },\n        enabled: !!currentHub,\n    });\n\n    const approveMutation = useMutation({\n        mutationFn: async ({ task, userId }: { task: Task; userId: string }) => {\n            if (!currentHub) throw new Error('No hub selected');\n            if (!user) throw new Error('User not authenticated');\n\n            // Update task status\n            await updateTask(currentHub.id, task.id, {\n                status: 'done',\n                proofStatus: 'approved',\n                proofReviewedBy: user.id,\n                proofReviewedAt: new Date(),\n                completedAt: new Date(),\n            });\n\n            // Award XP (need to get user name - for now using placeholder)\n            await awardXP({\n                userId,\n                userName: `User ${userId.slice(0, 8)}`, // TODO: Get actual user name\n                amount: task.weight * 10, // 10 XP per weight point\n                source: 'task_completion',\n                sourceId: task.id,\n                description: `Completed task: ${task.title}`,\n                hubId: currentHub.id,\n            });\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['tasks', 'hub', currentHub?.id] });\n            queryClient.invalidateQueries({ queryKey: ['xp', 'leaderboard'] });\n            toast.success('Task approved and XP awarded!');\n        },\n        onError: (error: any) => {\n            toast.error(error.message || 'Failed to approve task');\n        },\n    });\n\n    const rejectMutation = useMutation({\n        mutationFn: async (task: Task) => {\n            if (!currentHub) throw new Error('No hub selected');\n            if (!user) throw new Error('User not authenticated');\n\n            await updateTask(currentHub.id, task.id, {\n                proofStatus: 'rejected',\n                proofReviewedBy: user.id,\n                proofReviewedAt: new Date(),\n                status: 'assigned', // Revert to assigned\n            });\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['tasks', 'hub', currentHub?.id] });\n            toast.success('Task proof rejected');\n        },\n        onError: (error: any) => {\n            toast.error(error.message || 'Failed to reject proof');\n        },\n    });\n\n    if (isLoading) {\n        return (\n            <>\n                <Helmet>\n                    <title>Pending Approvals - Family Safety App</title>\n                </Helmet>\n                <div className=\"flex items-center justify-center py-16\">\n                    <LoadingSpinner size=\"large\" />\n                </div>\n            </>\n        );\n    }\n\n    return (\n        <>\n            <Helmet>\n                <title>Pending Approvals - Family Safety App</title>\n                <meta name=\"description\" content=\"Review and approve task proof submissions\" />\n            </Helmet>\n\n            <div className=\"space-y-8\">\n                <div>\n                    <h1 className=\"text-headline-lg md:text-display-sm font-normal text-on-surface mb-2\">Pending Approvals</h1>\n                    <p className=\"text-body-lg text-on-variant\">\n                        Review and approve task completion proof\n                    </p>\n                </div>\n\n                {!tasks || tasks.length === 0 ? (\n                    <div className=\"card p-12 text-center\">\n                        <div className=\"w-20 h-20 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-6 shadow-elevation-2 border border-green-100\">\n                            <FiCheck size={40} className=\"text-green-600\" />\n                        </div>\n                        <h3 className=\"text-headline-md font-normal text-on-surface mb-3\">\n                            All caught up!\n                        </h3>\n                        <p className=\"text-body-lg text-on-variant max-w-md mx-auto\">\n                            There are no pending proof submissions to review.\n                        </p>\n                    </div>\n                ) : (\n                    <div className=\"space-y-4\">\n                        {tasks.map((task) => (\n                            <div key={task.id} className=\"card p-6\">\n                                <div className=\"flex flex-col md:flex-row gap-6\">\n                                    {/* Proof Image */}\n                                    <div className=\"flex-shrink-0\">\n                                        {task.proofURL ? (\n                                            <img\n                                                src={task.proofURL}\n                                                alt={`Proof for ${task.title}`}\n                                                className=\"w-full md:w-64 h-48 object-cover rounded-xl border-2 border-outline-variant shadow-elevation-1\"\n                                            />\n                                        ) : (\n                                            <div className=\"w-full md:w-64 h-48 bg-surface-variant rounded-xl flex items-center justify-center border-2 border-outline-variant\">\n                                                <FiImage size={48} className=\"text-on-variant\" />\n                                            </div>\n                                        )}\n                                    </div>\n\n                                    {/* Task Details */}\n                                    <div className=\"flex-1 space-y-4\">\n                                        <div>\n                                            <h3 className=\"text-title-lg text-on-surface mb-2\">\n                                                {task.title}\n                                            </h3>\n                                            {task.description && (\n                                                <p className=\"text-body-md text-on-variant\">{task.description}</p>\n                                            )}\n                                        </div>\n\n                                        <div className=\"flex flex-wrap gap-4\">\n                                            <div className=\"flex items-center gap-2 text-body-sm text-on-variant\">\n                                                <FiUser size={16} />\n                                                <span>\n                                                    Assigned to: User {task.assignedTo?.slice(0, 8)}\n                                                </span>\n                                            </div>\n                                            {task.proofSubmittedAt && (\n                                                <div className=\"flex items-center gap-2 text-body-sm text-on-variant\">\n                                                    <FiClock size={16} />\n                                                    <span>\n                                                        Submitted:{' '}\n                                                        {new Date(task.proofSubmittedAt).toLocaleDateString()}\n                                                    </span>\n                                                </div>\n                                            )}\n                                            <div className=\"px-3 py-1.5 bg-primary-container border border-primary/20 text-primary rounded-full text-label-sm font-semibold\">\n                                                {task.weight * 10} XP\n                                            </div>\n                                        </div>\n\n                                        {/* Action Buttons */}\n                                        <div className=\"flex gap-3 pt-4 border-t border-outline-variant\">\n                                            <Button\n                                                variant=\"filled\"\n                                                onClick={() =>\n                                                    approveMutation.mutate({\n                                                        task,\n                                                        userId: task.assignedTo || '',\n                                                    })\n                                                }\n                                                loading={approveMutation.isPending}\n                                                disabled={\n                                                    approveMutation.isPending || rejectMutation.isPending\n                                                }\n                                                startIcon={<FiCheck size={18} />}\n                                                className=\"btn-base bg-green-600 text-white hover:bg-green-700 shadow-elevation-2\"\n                                            >\n                                                Approve\n                                            </Button>\n                                            <Button\n                                                variant=\"outlined\"\n                                                onClick={() => rejectMutation.mutate(task)}\n                                                loading={rejectMutation.isPending}\n                                                disabled={\n                                                    approveMutation.isPending || rejectMutation.isPending\n                                                }\n                                                startIcon={<FiX size={18} />}\n                                                className=\"btn-base border-2 border-error text-error hover:bg-error-container\"\n                                            >\n                                                Reject\n                                            </Button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                )}\n            </div>\n        </>\n    );\n};\n\nexport default PendingApprovalsPage;\n\n"],"names":["PendingApprovalsPage","currentHub","useHubStore","user","useAuth","queryClient","useQueryClient","data","tasks","isLoading","useQuery","queryKey","id","queryFn","async","Error","response","getHubTasks","success","error","filter","task","proofStatus","proofURL","enabled","approveMutation","useMutation","mutationFn","userId","updateTask","status","proofReviewedBy","proofReviewedAt","Date","completedAt","awardXP","userName","slice","amount","weight","source","sourceId","description","title","hubId","onSuccess","invalidateQueries","toast","onError","message","rejectMutation","jsxs","Fragment","children","jsx","Helmet","className","LoadingSpinner","size","name","content","length","map","src","alt","FiImage","FiUser","assignedTo","proofSubmittedAt","FiClock","toLocaleDateString","Button","variant","onClick","mutate","loading","isPending","disabled","startIcon","FiCheck","FiX"],"mappings":"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"}