{"version":3,"file":"MessagesPage-5551etvH.js","sources":["../../src/features/messages/components/MessageBubble.tsx","../../src/features/messages/components/MessageList.tsx","../../src/features/messages/components/MessageInput.tsx","../../src/features/messages/components/BroadcastPanel.tsx","../../src/features/messages/components/BroadcastHistory.tsx","../../src/features/messages/components/BroadcastAlert.tsx","../../src/features/messages/components/TypingIndicator.tsx","../../src/features/messages/api/typing-api.ts","../../src/features/messages/hooks/useTyping.ts","../../src/features/messages/pages/MessagesPage.tsx"],"sourcesContent":["/**\n * MessageBubble Component\n * \n * Individual message bubble display (Life360/iMessage style)\n */\n\nimport { useState } from 'react';\nimport { FiMoreVertical, FiTrash2, FiCheck } from 'react-icons/fi';\nimport type { Message } from '@/types';\n\ninterface MessageBubbleProps {\n    message: Message;\n    isOwnMessage: boolean;\n    onDelete?: (messageId: string) => void;\n    showAvatar?: boolean;\n}\n\nexport const MessageBubble = ({\n    message,\n    isOwnMessage,\n    onDelete,\n    showAvatar = true,\n}: MessageBubbleProps) => {\n    const [showMenu, setShowMenu] = useState(false);\n\n    // Format timestamp\n    const formatTime = (date: Date) => {\n        const now = new Date();\n        const diff = now.getTime() - date.getTime();\n        const minutes = Math.floor(diff / 60000);\n\n        if (minutes < 1) return 'Just now';\n        if (minutes < 60) return `${minutes}m ago`;\n        if (diff < 86400000) {\n            return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });\n        }\n        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n    };\n\n    // Check if message is read\n    const isRead = message.readBy.length > 1; // More than just sender\n\n    return (\n        <div\n            className={`flex gap-3 ${isOwnMessage ? 'flex-row-reverse' : 'flex-row'} group`}\n        >\n            {/* Avatar */}\n            {showAvatar ? (\n                <div className=\"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white text-sm font-semibold shadow-md ring-2 ring-white\">\n                    {message.senderName.charAt(0).toUpperCase()}\n                </div>\n            ) : (\n                <div className=\"flex-shrink-0 w-10\" />\n            )}\n\n            {/* Message Content */}\n            <div className={`flex flex-col ${isOwnMessage ? 'items-end' : 'items-start'} max-w-[75%] md:max-w-[65%]`}>\n                {/* Sender Name (only for others' messages) */}\n                {!isOwnMessage && showAvatar && (\n                    <span className=\"text-xs font-medium text-gray-600 mb-1.5 px-1\">\n                        {message.senderName}\n                    </span>\n                )}\n\n                {/* Bubble */}\n                <div\n                    className={`relative px-4 py-2.5 rounded-2xl ${\n                        isOwnMessage\n                            ? 'bg-gradient-to-br from-purple-600 to-purple-700 text-white rounded-br-sm shadow-md'\n                            : 'bg-white text-gray-900 rounded-bl-sm shadow-sm border border-gray-200/50'\n                    }`}\n                >\n                    {/* Message Text */}\n                    <p className=\"text-sm whitespace-pre-wrap break-words\">\n                        {message.text}\n                    </p>\n\n                    {/* Media (if any) */}\n                    {message.mediaURL && (\n                        <div className=\"mt-2 rounded-lg overflow-hidden\">\n                            <img\n                                src={message.mediaURL}\n                                alt=\"Message attachment\"\n                                className=\"max-w-full h-auto rounded-lg\"\n                            />\n                        </div>\n                    )}\n\n                    {/* Timestamp & Read Status */}\n                    <div className={`flex items-center gap-1.5 mt-1.5 ${isOwnMessage ? 'justify-end' : 'justify-start'}`}>\n                        <span className={`text-xs ${isOwnMessage ? 'text-purple-100/90' : 'text-gray-500'}`}>\n                            {formatTime(message.timestamp)}\n                        </span>\n                        {isOwnMessage && (\n                            <FiCheck\n                                size={14}\n                                className={isRead ? 'text-blue-200' : 'text-purple-200/70'}\n                            />\n                        )}\n                    </div>\n                </div>\n\n                {/* Menu Button (only for own messages) */}\n                {isOwnMessage && onDelete && (\n                    <div className=\"relative\">\n                        <button\n                            onClick={() => setShowMenu(!showMenu)}\n                            className=\"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-gray-600 transition-opacity\"\n                            aria-label=\"Message options\"\n                        >\n                            <FiMoreVertical size={14} />\n                        </button>\n\n                        {/* Dropdown Menu */}\n                        {showMenu && (\n                            <>\n                                <div\n                                    className=\"fixed inset-0 z-10\"\n                                    onClick={() => setShowMenu(false)}\n                                />\n                                <div className=\"absolute right-0 top-6 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20 min-w-[120px]\">\n                                    <button\n                                        onClick={() => {\n                                            onDelete(message.id);\n                                            setShowMenu(false);\n                                        }}\n                                        className=\"w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors\"\n                                    >\n                                        <FiTrash2 size={14} />\n                                        Delete\n                                    </button>\n                                </div>\n                            </>\n                        )}\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n};\n","/**\n * MessageList Component\n * \n * Scrollable list of messages with auto-scroll to bottom\n */\n\nimport { useEffect, useRef } from 'react';\nimport { MessageBubble } from './MessageBubble';\nimport { MessageBubbleSkeleton } from '@/components/ui/Skeleton';\nimport type { Message } from '@/types';\n\ninterface MessageListProps {\n    messages: Message[];\n    currentUserId: string;\n    isLoading?: boolean;\n    onDeleteMessage?: (messageId: string) => void;\n}\n\nexport const MessageList = ({\n    messages,\n    currentUserId,\n    isLoading = false,\n    onDeleteMessage,\n}: MessageListProps) => {\n    const messagesEndRef = useRef<HTMLDivElement>(null);\n    const listRef = useRef<HTMLDivElement>(null);\n\n    // Auto-scroll to bottom when new messages arrive\n    useEffect(() => {\n        if (messagesEndRef.current) {\n            messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\n        }\n    }, [messages]);\n\n    // Group messages by sender (show avatar only for first message from same sender)\n    const groupedMessages: Array<{ message: Message; showAvatar: boolean }> = [];\n    \n    messages.forEach((message, index) => {\n        const prevMessage = index > 0 ? messages[index - 1] : null;\n        const showAvatar = \n            !prevMessage || \n            prevMessage.senderId !== message.senderId ||\n            (message.timestamp.getTime() - prevMessage.timestamp.getTime()) > 300000; // 5 minutes gap\n\n        groupedMessages.push({ message, showAvatar });\n    });\n\n    if (isLoading && messages.length === 0) {\n        return (\n            <div className=\"flex-1 overflow-y-auto px-4 md:px-6 py-6 space-y-4\">\n                <MessageBubbleSkeleton isOwn={false} />\n                <MessageBubbleSkeleton isOwn={true} />\n                <MessageBubbleSkeleton isOwn={false} />\n                <MessageBubbleSkeleton isOwn={true} />\n                <MessageBubbleSkeleton isOwn={false} />\n            </div>\n        );\n    }\n\n    if (messages.length === 0) {\n        return (\n            <div className=\"flex-1 flex flex-col items-center justify-center text-center px-6 min-h-0\">\n                <div className=\"w-24 h-24 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-full flex items-center justify-center mb-6 shadow-lg\">\n                    <svg\n                        className=\"w-12 h-12 text-purple-600\"\n                        fill=\"none\"\n                        stroke=\"currentColor\"\n                        viewBox=\"0 0 24 24\"\n                    >\n                        <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            strokeWidth={1.5}\n                            d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"\n                        />\n                    </svg>\n                </div>\n                <h3 className=\"text-xl font-bold text-gray-900 mb-2\">\n                    No messages yet\n                </h3>\n                <p className=\"text-sm text-gray-600 max-w-sm\">\n                    Start the conversation by sending a message to your family\n                </p>\n            </div>\n        );\n    }\n\n    return (\n        <div\n            ref={listRef}\n            className=\"flex-1 overflow-y-auto px-4 md:px-6 py-6 space-y-3\"\n        >\n            {groupedMessages.map(({ message, showAvatar }) => (\n                <MessageBubble\n                    key={message.id}\n                    message={message}\n                    isOwnMessage={message.senderId === currentUserId}\n                    onDelete={onDeleteMessage}\n                    showAvatar={showAvatar}\n                />\n            ))}\n            <div ref={messagesEndRef} />\n        </div>\n    );\n};\n","/**\n * MessageInput Component\n * \n * Input field for sending messages (Life360/iMessage style)\n */\n\nimport { useState, useRef, useEffect } from 'react';\nimport { FiSend, FiPaperclip, FiSmile } from 'react-icons/fi';\n\ninterface MessageInputProps {\n    onSend: (text: string) => void;\n    isSending?: boolean;\n    placeholder?: string;\n    disabled?: boolean;\n    onTyping?: () => void;\n    onStopTyping?: () => void;\n}\n\nexport const MessageInput = ({\n    onSend,\n    isSending = false,\n    placeholder = 'Type a message...',\n    disabled = false,\n    onTyping,\n    onStopTyping,\n}: MessageInputProps) => {\n    const [message, setMessage] = useState('');\n    const textareaRef = useRef<HTMLTextAreaElement>(null);\n    const typingTimeoutRef = useRef<NodeJS.Timeout>();\n\n    // Auto-resize textarea\n    useEffect(() => {\n        if (textareaRef.current) {\n            textareaRef.current.style.height = 'auto';\n            textareaRef.current.style.height = `${textareaRef.current.scrollHeight}px`;\n        }\n    }, [message]);\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        \n        const trimmedMessage = message.trim();\n        if (!trimmedMessage || isSending || disabled) return;\n\n        onSend(trimmedMessage);\n        setMessage('');\n        \n        // Clear typing status\n        if (onStopTyping) {\n            onStopTyping();\n        }\n        \n        // Reset textarea height\n        if (textareaRef.current) {\n            textareaRef.current.style.height = 'auto';\n        }\n    };\n\n    const handleMessageChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n        setMessage(e.target.value);\n\n        // Trigger typing indicator\n        if (onTyping && e.target.value.trim()) {\n            onTyping();\n        }\n\n        // Clear existing timeout\n        if (typingTimeoutRef.current) {\n            clearTimeout(typingTimeoutRef.current);\n        }\n\n        // Auto-stop typing after 2 seconds of inactivity\n        if (onStopTyping) {\n            typingTimeoutRef.current = setTimeout(() => {\n                onStopTyping();\n            }, 2000);\n        }\n    };\n\n    // Cleanup on unmount\n    useEffect(() => {\n        return () => {\n            if (typingTimeoutRef.current) {\n                clearTimeout(typingTimeoutRef.current);\n            }\n            if (onStopTyping) {\n                onStopTyping();\n            }\n        };\n    }, [onStopTyping]);\n\n    const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n        // Send on Enter (but allow Shift+Enter for new line)\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            handleSubmit(e);\n        }\n    };\n\n    return (\n        <form\n            onSubmit={handleSubmit}\n            className=\"border-t border-gray-200/50 bg-white/95 backdrop-blur-md p-4 md:px-6 shadow-lg\"\n        >\n            <div className=\"flex items-end gap-3\">\n                {/* Attachment Button */}\n                <button\n                    type=\"button\"\n                    disabled={disabled}\n                    className=\"flex-shrink-0 w-10 h-10 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\n                    aria-label=\"Attach file\"\n                >\n                    <FiPaperclip size={20} />\n                </button>\n\n                {/* Text Input */}\n                <div className=\"flex-1 relative\">\n                    <textarea\n                        ref={textareaRef}\n                        value={message}\n                        onChange={handleMessageChange}\n                        onKeyDown={handleKeyDown}\n                        placeholder={placeholder}\n                        disabled={disabled || isSending}\n                        rows={1}\n                        className=\"w-full px-4 py-3 pr-12 bg-gray-50 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent focus:bg-white resize-none overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm\"\n                        style={{ minHeight: '48px', maxHeight: '120px' }}\n                    />\n                    \n                    {/* Emoji Button (placeholder) */}\n                    <button\n                        type=\"button\"\n                        disabled={disabled}\n                        className=\"absolute right-12 bottom-3 p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-all disabled:opacity-50\"\n                        aria-label=\"Add emoji\"\n                    >\n                        <FiSmile size={18} />\n                    </button>\n                </div>\n\n                {/* Send Button */}\n                <button\n                    type=\"submit\"\n                    disabled={!message.trim() || isSending || disabled}\n                    className={`flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full transition-all shadow-md ${\n                        message.trim() && !isSending && !disabled\n                            ? 'bg-gradient-to-br from-purple-600 to-purple-700 text-white hover:from-purple-700 hover:to-purple-800 active:scale-95 shadow-purple-200'\n                            : 'bg-gray-200 text-gray-400 cursor-not-allowed shadow-none'\n                    }`}\n                    aria-label=\"Send message\"\n                >\n                    {isSending ? (\n                        <div className=\"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                    ) : (\n                        <FiSend size={20} />\n                    )}\n                </button>\n            </div>\n        </form>\n    );\n};\n","import { useState } from 'react';\nimport { FiX, FiAlertTriangle, FiInfo, FiClock } from 'react-icons/fi';\nimport { useCreateBroadcast } from '../hooks/useBroadcasts';\nimport type { BroadcastPriority, BroadcastType } from '../api/broadcast-api';\n\ninterface BroadcastPanelProps {\n    onClose: () => void;\n}\n\nexport const BroadcastPanel = ({ onClose }: BroadcastPanelProps) => {\n    const [title, setTitle] = useState('');\n    const [message, setMessage] = useState('');\n    const [priority, setPriority] = useState<BroadcastPriority>('normal');\n    const [type, setType] = useState<BroadcastType>('announcement');\n    const [hasExpiry, setHasExpiry] = useState(false);\n    const [expiryHours, setExpiryHours] = useState(24);\n\n    const createBroadcast = useCreateBroadcast();\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n\n        if (!title.trim() || !message.trim()) {\n            return;\n        }\n\n        const expiresAt = hasExpiry\n            ? new Date(Date.now() + expiryHours * 60 * 60 * 1000)\n            : undefined;\n\n        createBroadcast.mutate(\n            {\n                title: title.trim(),\n                message: message.trim(),\n                priority,\n                type,\n                expiresAt,\n            },\n            {\n                onSuccess: () => {\n                    onClose();\n                },\n            }\n        );\n    };\n\n    const priorityOptions: { value: BroadcastPriority; label: string; color: string }[] = [\n        { value: 'low', label: 'Low', color: 'text-gray-600' },\n        { value: 'normal', label: 'Normal', color: 'text-blue-600' },\n        { value: 'high', label: 'High', color: 'text-orange-600' },\n        { value: 'urgent', label: 'Urgent', color: 'text-red-600' },\n    ];\n\n    const typeOptions: { value: BroadcastType; label: string; icon: typeof FiInfo }[] = [\n        { value: 'announcement', label: 'Announcement', icon: FiInfo },\n        { value: 'alert', label: 'Alert', icon: FiAlertTriangle },\n        { value: 'reminder', label: 'Reminder', icon: FiClock },\n        { value: 'emergency', label: 'Emergency', icon: FiAlertTriangle },\n    ];\n\n    return (\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n                {/* Header */}\n                <div className=\"sticky top-0 bg-gradient-to-br from-purple-600 to-purple-700 text-white px-6 py-4 rounded-t-3xl flex items-center justify-between\">\n                    <div>\n                        <h2 className=\"text-2xl font-bold\">Send Broadcast Alert</h2>\n                        <p className=\"text-purple-100 text-sm mt-1\">\n                            Send a notification to all family members\n                        </p>\n                    </div>\n                    <button\n                        onClick={onClose}\n                        className=\"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center transition-colors\"\n                        aria-label=\"Close\"\n                    >\n                        <FiX size={20} />\n                    </button>\n                </div>\n\n                {/* Form */}\n                <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\n                    {/* Type Selection */}\n                    <div>\n                        <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\n                            Alert Type\n                        </label>\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\n                            {typeOptions.map((option) => {\n                                const Icon = option.icon;\n                                return (\n                                    <button\n                                        key={option.value}\n                                        type=\"button\"\n                                        onClick={() => setType(option.value)}\n                                        className={`p-3 rounded-xl border-2 transition-all ${\n                                            type === option.value\n                                                ? 'border-purple-600 bg-purple-50 text-purple-700'\n                                                : 'border-gray-200 hover:border-gray-300 text-gray-700'\n                                        }`}\n                                    >\n                                        <Icon size={18} className=\"mx-auto mb-1\" />\n                                        <span className=\"text-xs font-medium block\">\n                                            {option.label}\n                                        </span>\n                                    </button>\n                                );\n                            })}\n                        </div>\n                    </div>\n\n                    {/* Priority Selection */}\n                    <div>\n                        <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\n                            Priority Level\n                        </label>\n                        <div className=\"flex gap-2\">\n                            {priorityOptions.map((option) => (\n                                <button\n                                    key={option.value}\n                                    type=\"button\"\n                                    onClick={() => setPriority(option.value)}\n                                    className={`flex-1 px-4 py-2 rounded-xl border-2 transition-all text-sm font-medium ${\n                                        priority === option.value\n                                            ? 'border-purple-600 bg-purple-50 text-purple-700'\n                                            : `border-gray-200 hover:border-gray-300 ${option.color}`\n                                    }`}\n                                >\n                                    {option.label}\n                                </button>\n                            ))}\n                        </div>\n                    </div>\n\n                    {/* Title Input */}\n                    <div>\n                        <label htmlFor=\"broadcast-title\" className=\"block text-sm font-semibold text-gray-700 mb-2\">\n                            Title\n                        </label>\n                        <input\n                            id=\"broadcast-title\"\n                            type=\"text\"\n                            value={title}\n                            onChange={(e) => setTitle(e.target.value)}\n                            placeholder=\"e.g., Family Meeting Tonight\"\n                            maxLength={100}\n                            required\n                            className=\"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                        />\n                        <p className=\"text-xs text-gray-500 mt-1\">\n                            {title.length}/100 characters\n                        </p>\n                    </div>\n\n                    {/* Message Input */}\n                    <div>\n                        <label htmlFor=\"broadcast-message\" className=\"block text-sm font-semibold text-gray-700 mb-2\">\n                            Message\n                        </label>\n                        <textarea\n                            id=\"broadcast-message\"\n                            value={message}\n                            onChange={(e) => setMessage(e.target.value)}\n                            placeholder=\"Enter your broadcast message...\"\n                            rows={5}\n                            maxLength={500}\n                            required\n                            className=\"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none\"\n                        />\n                        <p className=\"text-xs text-gray-500 mt-1\">\n                            {message.length}/500 characters\n                        </p>\n                    </div>\n\n                    {/* Expiry Option */}\n                    <div className=\"bg-gray-50 rounded-xl p-4\">\n                        <label className=\"flex items-center gap-2 cursor-pointer\">\n                            <input\n                                type=\"checkbox\"\n                                checked={hasExpiry}\n                                onChange={(e) => setHasExpiry(e.target.checked)}\n                                className=\"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500\"\n                            />\n                            <span className=\"text-sm font-medium text-gray-700\">\n                                Set expiration time\n                            </span>\n                        </label>\n\n                        {hasExpiry && (\n                            <div className=\"mt-3\">\n                                <label htmlFor=\"expiry-hours\" className=\"block text-xs text-gray-600 mb-1\">\n                                    Expires after (hours)\n                                </label>\n                                <input\n                                    id=\"expiry-hours\"\n                                    type=\"number\"\n                                    value={expiryHours}\n                                    onChange={(e) => setExpiryHours(Math.max(1, parseInt(e.target.value) || 1))}\n                                    min=\"1\"\n                                    max=\"168\"\n                                    className=\"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                                />\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Actions */}\n                    <div className=\"flex gap-3 pt-4\">\n                        <button\n                            type=\"button\"\n                            onClick={onClose}\n                            className=\"flex-1 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-semibold transition-colors\"\n                        >\n                            Cancel\n                        </button>\n                        <button\n                            type=\"submit\"\n                            disabled={!title.trim() || !message.trim() || createBroadcast.isPending}\n                            className=\"flex-1 px-6 py-3 bg-gradient-to-br from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-xl font-semibold shadow-lg shadow-purple-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all\"\n                        >\n                            {createBroadcast.isPending ? 'Sending...' : 'Send Broadcast'}\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    );\n};\n","import { FiAlertTriangle, FiInfo, FiClock, FiCheck, FiX } from 'react-icons/fi';\nimport { useHubBroadcasts, useAcknowledgeBroadcast } from '../hooks/useBroadcasts';\nimport type { BroadcastAlert } from '../api/broadcast-api';\nimport { useAuthStore } from '@/lib/store/auth-store';\nimport { formatDistanceToNow } from 'date-fns';\n\ninterface BroadcastHistoryProps {\n    onClose: () => void;\n}\n\nexport const BroadcastHistory = ({ onClose }: BroadcastHistoryProps) => {\n    const { data: broadcasts = [], isLoading } = useHubBroadcasts();\n    const acknowledgeBroadcast = useAcknowledgeBroadcast();\n    const { user } = useAuthStore();\n\n    const handleAcknowledge = (broadcastId: string) => {\n        acknowledgeBroadcast.mutate(broadcastId);\n    };\n\n    const getBroadcastIcon = (broadcast: BroadcastAlert) => {\n        switch (broadcast.type) {\n            case 'emergency':\n            case 'alert':\n                return <FiAlertTriangle size={20} />;\n            case 'reminder':\n                return <FiClock size={20} />;\n            default:\n                return <FiInfo size={20} />;\n        }\n    };\n\n    const getPriorityColor = (priority: string) => {\n        switch (priority) {\n            case 'urgent':\n                return 'border-red-500 bg-red-50';\n            case 'high':\n                return 'border-orange-500 bg-orange-50';\n            case 'normal':\n                return 'border-blue-500 bg-blue-50';\n            default:\n                return 'border-gray-500 bg-gray-50';\n        }\n    };\n\n    const getPriorityTextColor = (priority: string) => {\n        switch (priority) {\n            case 'urgent':\n                return 'text-red-700';\n            case 'high':\n                return 'text-orange-700';\n            case 'normal':\n                return 'text-blue-700';\n            default:\n                return 'text-gray-700';\n        }\n    };\n\n    const isAcknowledged = (broadcast: BroadcastAlert) => {\n        return user && broadcast.readBy.includes(user.id);\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\n                {/* Header */}\n                <div className=\"sticky top-0 bg-gradient-to-br from-purple-600 to-purple-700 text-white px-6 py-4 flex items-center justify-between\">\n                    <div>\n                        <h2 className=\"text-2xl font-bold\">Broadcast History</h2>\n                        <p className=\"text-purple-100 text-sm mt-1\">\n                            View all family broadcast alerts\n                        </p>\n                    </div>\n                    <button\n                        onClick={onClose}\n                        className=\"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center transition-colors\"\n                        aria-label=\"Close\"\n                    >\n                        <FiX size={20} />\n                    </button>\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 overflow-y-auto p-6\">\n                    {isLoading ? (\n                        <div className=\"flex items-center justify-center py-12\">\n                            <div className=\"w-8 h-8 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin\" />\n                        </div>\n                    ) : broadcasts.length === 0 ? (\n                        <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n                            <div className=\"w-20 h-20 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-full flex items-center justify-center mb-4\">\n                                <FiInfo size={32} className=\"text-purple-600\" />\n                            </div>\n                            <h3 className=\"text-lg font-bold text-gray-900 mb-2\">\n                                No broadcasts yet\n                            </h3>\n                            <p className=\"text-sm text-gray-600 max-w-sm\">\n                                Broadcast alerts sent by admins will appear here\n                            </p>\n                        </div>\n                    ) : (\n                        <div className=\"space-y-4\">\n                            {broadcasts.map((broadcast: BroadcastAlert) => {\n                                const acknowledged = isAcknowledged(broadcast);\n\n                                return (\n                                    <div\n                                        key={broadcast.id}\n                                        className={`border-l-4 rounded-xl p-4 ${getPriorityColor(\n                                            broadcast.priority\n                                        )} transition-all ${\n                                            !acknowledged ? 'shadow-md' : 'opacity-75'\n                                        }`}\n                                    >\n                                        {/* Header */}\n                                        <div className=\"flex items-start justify-between gap-3 mb-2\">\n                                            <div className=\"flex items-start gap-3 flex-1 min-w-0\">\n                                                <div\n                                                    className={`flex-shrink-0 ${getPriorityTextColor(\n                                                        broadcast.priority\n                                                    )}`}\n                                                >\n                                                    {getBroadcastIcon(broadcast)}\n                                                </div>\n                                                <div className=\"flex-1 min-w-0\">\n                                                    <h3\n                                                        className={`font-bold text-lg ${getPriorityTextColor(\n                                                            broadcast.priority\n                                                        )}`}\n                                                    >\n                                                        {broadcast.title}\n                                                    </h3>\n                                                    <p className=\"text-sm text-gray-600 mt-0.5\">\n                                                        From {broadcast.senderName} â€¢{' '}\n                                                        {formatDistanceToNow(broadcast.timestamp, {\n                                                            addSuffix: true,\n                                                        })}\n                                                    </p>\n                                                </div>\n                                            </div>\n\n                                            {/* Status Badge */}\n                                            {acknowledged ? (\n                                                <div className=\"flex items-center gap-1.5 px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-semibold\">\n                                                    <FiCheck size={14} />\n                                                    Read\n                                                </div>\n                                            ) : (\n                                                <div className=\"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-semibold\">\n                                                    New\n                                                </div>\n                                            )}\n                                        </div>\n\n                                        {/* Message */}\n                                        <p className=\"text-gray-800 text-sm leading-relaxed mb-3 ml-8\">\n                                            {broadcast.message}\n                                        </p>\n\n                                        {/* Footer */}\n                                        <div className=\"flex items-center justify-between ml-8\">\n                                            <div className=\"flex items-center gap-3 text-xs text-gray-500\">\n                                                <span className=\"px-2 py-1 bg-white rounded-full capitalize\">\n                                                    {broadcast.type}\n                                                </span>\n                                                <span className=\"px-2 py-1 bg-white rounded-full capitalize\">\n                                                    {broadcast.priority} priority\n                                                </span>\n                                                {broadcast.expiresAt && (\n                                                    <span className=\"px-2 py-1 bg-white rounded-full flex items-center gap-1\">\n                                                        <FiClock size={12} />\n                                                        Expires{' '}\n                                                        {formatDistanceToNow(broadcast.expiresAt, {\n                                                            addSuffix: true,\n                                                        })}\n                                                    </span>\n                                                )}\n                                            </div>\n\n                                            {!acknowledged && (\n                                                <button\n                                                    onClick={() => handleAcknowledge(broadcast.id)}\n                                                    disabled={acknowledgeBroadcast.isPending}\n                                                    className=\"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm font-semibold transition-colors disabled:opacity-50 shadow-md\"\n                                                >\n                                                    Acknowledge\n                                                </button>\n                                            )}\n                                        </div>\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\n","import { FiAlertTriangle, FiAlertCircle, FiInfo, FiCheck, FiX } from 'react-icons/fi';\nimport { formatDistanceToNow } from 'date-fns';\nimport type { BroadcastAlert as BroadcastAlertType } from '../api/broadcast-api';\nimport { useAcknowledgeBroadcast } from '../hooks/useBroadcasts';\nimport { useAuthStore } from '@/lib/store/auth-store';\n\ninterface BroadcastAlertProps {\n    broadcast: BroadcastAlertType;\n    onDismiss?: () => void;\n}\n\nexport const BroadcastAlert = ({ broadcast, onDismiss }: BroadcastAlertProps) => {\n    const { user } = useAuthStore();\n    const acknowledgeBroadcast = useAcknowledgeBroadcast();\n\n    const handleAcknowledge = () => {\n        acknowledgeBroadcast.mutate(broadcast.id);\n    };\n\n    const isAcknowledged = user ? (broadcast.acknowledgedBy || broadcast.readBy || []).includes(user.id) : false;\n\n    const typeConfig = {\n        emergency: {\n            icon: FiAlertTriangle,\n            bgColor: 'bg-red-50',\n            borderColor: 'border-red-300',\n            textColor: 'text-red-900',\n            iconColor: 'text-red-600',\n            buttonColor: 'bg-red-600 hover:bg-red-700',\n        },\n        urgent: {\n            icon: FiAlertCircle,\n            bgColor: 'bg-orange-50',\n            borderColor: 'border-orange-300',\n            textColor: 'text-orange-900',\n            iconColor: 'text-orange-600',\n            buttonColor: 'bg-orange-600 hover:bg-orange-700',\n        },\n        info: {\n            icon: FiInfo,\n            bgColor: 'bg-blue-50',\n            borderColor: 'border-blue-300',\n            textColor: 'text-blue-900',\n            iconColor: 'text-blue-600',\n            buttonColor: 'bg-blue-600 hover:bg-blue-700',\n        },\n    };\n\n    const config = typeConfig[broadcast.type as keyof typeof typeConfig] || typeConfig.info;\n    const Icon = config.icon;\n\n    return (\n        <div\n            className={`${config.bgColor} ${config.borderColor} ${config.textColor} border-2 rounded-2xl p-4 shadow-lg`}\n        >\n            <div className=\"flex items-start gap-3\">\n                {/* Icon */}\n                <div className={`flex-shrink-0 w-10 h-10 ${config.iconColor} flex items-center justify-center rounded-full bg-white shadow-sm`}>\n                    <Icon size={24} />\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-start justify-between gap-2 mb-2\">\n                        <div>\n                            <h3 className=\"font-bold text-lg leading-tight\">{broadcast.title}</h3>\n                            <p className=\"text-xs opacity-75 mt-0.5\">\n                                {formatDistanceToNow(broadcast.timestamp, { addSuffix: true })} by {broadcast.senderName}\n                            </p>\n                        </div>\n                        {onDismiss && (\n                            <button\n                                onClick={onDismiss}\n                                className=\"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full hover:bg-white/50 transition-colors\"\n                                aria-label=\"Dismiss\"\n                            >\n                                <FiX size={16} />\n                            </button>\n                        )}\n                    </div>\n\n                    <p className=\"text-sm leading-relaxed mb-4\">{broadcast.message}</p>\n\n                    {/* Acknowledgment Status */}\n                    <div className=\"flex items-center gap-3\">\n                        {isAcknowledged ? (\n                            <div className=\"flex items-center gap-2 text-sm font-semibold\">\n                                <div className=\"w-6 h-6 bg-green-600 rounded-full flex items-center justify-center\">\n                                    <FiCheck size={16} className=\"text-white\" />\n                                </div>\n                                <span>Acknowledged</span>\n                            </div>\n                        ) : (\n                            <button\n                                onClick={handleAcknowledge}\n                                disabled={acknowledgeBroadcast.isPending}\n                                className={`px-4 py-2 ${config.buttonColor} text-white font-semibold rounded-lg transition-colors disabled:opacity-50 text-sm shadow-md`}\n                            >\n                                {acknowledgeBroadcast.isPending ? 'Acknowledging...' : 'Acknowledge'}\n                            </button>\n                        )}\n\n                        {/* Acknowledgment Count */}\n                        <div className=\"text-xs opacity-75\">\n                            {(broadcast.acknowledgedBy || broadcast.readBy || []).length} acknowledged\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\n","import type { TypingStatus } from '../api/typing-api';\n\ninterface TypingIndicatorProps {\n    typingUsers: TypingStatus[];\n}\n\nexport const TypingIndicator = ({ typingUsers }: TypingIndicatorProps) => {\n    if (typingUsers.length === 0) return null;\n\n    const getTypingText = () => {\n        if (typingUsers.length === 1) {\n            return `${typingUsers[0].userName} is typing...`;\n        } else if (typingUsers.length === 2) {\n            return `${typingUsers[0].userName} and ${typingUsers[1].userName} are typing...`;\n        } else {\n            return `${typingUsers[0].userName} and ${typingUsers.length - 1} others are typing...`;\n        }\n    };\n\n    return (\n        <div className=\"px-4 md:px-6 py-2 flex items-center gap-2\">\n            <div className=\"flex gap-1\">\n                <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n            </div>\n            <span className=\"text-sm text-gray-600 italic\">{getTypingText()}</span>\n        </div>\n    );\n};\n\n","import { doc, setDoc, deleteDoc, onSnapshot, collection, Timestamp } from 'firebase/firestore';\nimport { db } from '@/config/firebase';\n\nexport interface TypingStatus {\n    userId: string;\n    userName: string;\n    timestamp: Date;\n}\n\n/**\n * Set typing status for a user in a hub\n */\nexport const setTypingStatus = async (hubId: string, userId: string, userName: string): Promise<void> => {\n    try {\n        const typingRef = doc(db, `hubs/${hubId}/typing/${userId}`);\n        await setDoc(typingRef, {\n            userId,\n            userName,\n            timestamp: Timestamp.now(),\n        });\n    } catch (error) {\n        console.error('Set typing status error:', error);\n    }\n};\n\n/**\n * Clear typing status for a user in a hub\n */\nexport const clearTypingStatus = async (hubId: string, userId: string): Promise<void> => {\n    try {\n        const typingRef = doc(db, `hubs/${hubId}/typing/${userId}`);\n        await deleteDoc(typingRef);\n    } catch (error) {\n        console.error('Clear typing status error:', error);\n    }\n};\n\n/**\n * Subscribe to typing status updates\n */\nexport const subscribeToTypingStatus = (\n    hubId: string,\n    callback: (typingUsers: TypingStatus[]) => void\n): (() => void) => {\n    const typingCollectionRef = collection(db, `hubs/${hubId}/typing`);\n    \n    const unsubscribe = onSnapshot(\n        typingCollectionRef,\n        (snapshot) => {\n            const typingUsers: TypingStatus[] = [];\n            \n            snapshot.forEach((doc) => {\n                const data = doc.data();\n                typingUsers.push({\n                    userId: data.userId,\n                    userName: data.userName,\n                    timestamp: data.timestamp?.toDate() || new Date(),\n                });\n            });\n            \n            callback(typingUsers);\n        },\n        (error) => {\n            console.error('Subscribe to typing status error:', error);\n            callback([]);\n        }\n    );\n    \n    return unsubscribe;\n};\n\n","import { useEffect, useRef, useState, useCallback } from 'react';\nimport { setTypingStatus, clearTypingStatus, subscribeToTypingStatus, type TypingStatus } from '../api/typing-api';\nimport { useAuthStore } from '@/lib/store/auth-store';\n\n/**\n * Hook to manage typing indicators\n */\nexport const useTyping = (hubId: string | undefined) => {\n    const { user } = useAuthStore();\n    const [typingUsers, setTypingUsers] = useState<TypingStatus[]>([]);\n    const typingTimeoutRef = useRef<NodeJS.Timeout>();\n\n    // Subscribe to typing status updates\n    useEffect(() => {\n        if (!hubId) return;\n\n        const unsubscribe = subscribeToTypingStatus(hubId, (users) => {\n            // Filter out current user and stale entries (> 5 seconds old)\n            const now = Date.now();\n            const activeTypingUsers = users.filter((u) => {\n                const age = now - u.timestamp.getTime();\n                return u.userId !== user?.id && age < 5000;\n            });\n            setTypingUsers(activeTypingUsers);\n        });\n\n        return unsubscribe;\n    }, [hubId, user?.id]);\n\n    // Set typing status\n    const setTyping = useCallback(async () => {\n        if (!hubId || !user) return;\n\n        // Clear any existing timeout\n        if (typingTimeoutRef.current) {\n            clearTimeout(typingTimeoutRef.current);\n        }\n\n        // Set typing status\n        await setTypingStatus(hubId, user.id, user.displayName || 'Unknown');\n\n        // Auto-clear after 3 seconds\n        typingTimeoutRef.current = setTimeout(async () => {\n            await clearTypingStatus(hubId, user.id);\n        }, 3000);\n    }, [hubId, user]);\n\n    // Clear typing status\n    const clearTyping = useCallback(async () => {\n        if (!hubId || !user) return;\n\n        // Clear timeout\n        if (typingTimeoutRef.current) {\n            clearTimeout(typingTimeoutRef.current);\n        }\n\n        // Clear typing status\n        await clearTypingStatus(hubId, user.id);\n    }, [hubId, user]);\n\n    // Cleanup on unmount\n    useEffect(() => {\n        return () => {\n            if (typingTimeoutRef.current) {\n                clearTimeout(typingTimeoutRef.current);\n            }\n        };\n    }, []);\n\n    return {\n        typingUsers,\n        setTyping,\n        clearTyping,\n    };\n};\n\n","/**\n * MessagesPage Component\n * \n * Real-time messaging interface (Life360/iMessage style)\n */\n\nimport { useEffect, useState } from 'react';\nimport { Helmet } from 'react-helmet-async';\nimport { MessageList } from '../components/MessageList';\nimport { MessageInput } from '../components/MessageInput';\nimport { BroadcastPanel } from '../components/BroadcastPanel';\nimport { BroadcastHistory } from '../components/BroadcastHistory';\nimport { BroadcastAlert } from '../components/BroadcastAlert';\nimport type { BroadcastAlert as BroadcastAlertType } from '../api/broadcast-api';\nimport { TypingIndicator } from '../components/TypingIndicator';\nimport { useHubMessages, useSendMessage, useDeleteMessage, useMarkMessageAsRead } from '../hooks/useMessages';\nimport { useHubBroadcasts } from '../hooks/useBroadcasts';\nimport { useTyping } from '../hooks/useTyping';\nimport { useAuth } from '@/features/auth/hooks/useAuth';\nimport { useHubStore } from '@/lib/store/hub-store';\nimport { FiUsers, FiRadio } from 'react-icons/fi';\nimport toast from 'react-hot-toast';\n\nconst MessagesPage = () => {\n    const { user } = useAuth();\n    const { currentHub } = useHubStore();\n    const { messages, isLoading } = useHubMessages(currentHub?.id);\n    const { data: broadcasts = [] } = useHubBroadcasts();\n    const { typingUsers, setTyping, clearTyping } = useTyping(currentHub?.id);\n    const { sendMessageAsync, isSending, error: sendError } = useSendMessage();\n    const { deleteMessageAsync } = useDeleteMessage();\n    const { markAsReadAsync } = useMarkMessageAsRead();\n    const [showBroadcastPanel, setShowBroadcastPanel] = useState(false);\n    const [showBroadcastHistory, setShowBroadcastHistory] = useState(false);\n    const [dismissedBroadcasts, setDismissedBroadcasts] = useState<string[]>([]);\n\n    // Mark messages as read when viewing\n    useEffect(() => {\n        if (!user || !messages.length) return;\n\n        // Mark unread messages as read\n        messages.forEach(async (message) => {\n            if (message.senderId !== user.id && !message.readBy.includes(user.id)) {\n                try {\n                    await markAsReadAsync(message.id);\n                } catch (error) {\n                    // Silently fail - not critical\n                }\n            }\n        });\n    }, [messages, user, markAsReadAsync]);\n\n    // Handle send error\n    useEffect(() => {\n        if (sendError) {\n            toast.error(sendError.message || 'Failed to send message');\n        }\n    }, [sendError]);\n\n    const handleSend = async (text: string) => {\n        try {\n            await sendMessageAsync(text);\n        } catch (error) {\n            toast.error(error instanceof Error ? error.message : 'Failed to send message');\n        }\n    };\n\n    const handleDelete = async (messageId: string) => {\n        if (window.confirm('Are you sure you want to delete this message?')) {\n            try {\n                await deleteMessageAsync(messageId);\n                toast.success('Message deleted');\n            } catch (error) {\n                toast.error(error instanceof Error ? error.message : 'Failed to delete message');\n            }\n        }\n    };\n\n    if (!currentHub) {\n        return (\n            <>\n                <Helmet>\n                    <title>Messages - Family Safety App</title>\n                </Helmet>\n                <div className=\"flex flex-col items-center justify-center h-full text-center px-6\">\n                    <div className=\"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                        <FiUsers size={36} className=\"text-gray-400\" />\n                    </div>\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                        No hub selected\n                    </h3>\n                    <p className=\"text-sm text-gray-500\">\n                        Please select a hub to start messaging\n                    </p>\n                </div>\n            </>\n        );\n    }\n\n    return (\n        <>\n            <Helmet>\n                <title>Messages - {currentHub.name} - Family Safety App</title>\n                <meta name=\"description\" content=\"Chat with your family\" />\n            </Helmet>\n\n            {/* Full screen container - TopBar is handled by AppLayout */}\n            <div className=\"fixed inset-0 flex flex-col bg-gradient-to-br from-gray-50 to-gray-100 pt-20 z-10\">\n                {/* Hub Info Bar - Below TopBar */}\n                <div className=\"flex-shrink-0 px-4 md:px-6 py-4 border-b border-gray-200/50 bg-white/80 backdrop-blur-md shadow-sm\">\n                    <div className=\"flex items-center justify-between gap-4\">\n                        <div className=\"flex-1 min-w-0\">\n                            <h1 className=\"text-xl md:text-2xl font-bold text-gray-900 truncate\">\n                                {currentHub.name}\n                            </h1>\n                            <p className=\"text-sm text-gray-600 mt-0.5\">\n                                {messages.length} {messages.length === 1 ? 'message' : 'messages'}\n                            </p>\n                        </div>\n                        {/* Action Buttons */}\n                        <div className=\"flex items-center gap-2\">\n                            <button\n                                onClick={() => setShowBroadcastHistory(true)}\n                                className=\"flex-shrink-0 px-4 py-2 bg-white border border-gray-200 text-gray-700 rounded-xl hover:bg-gray-50 transition-all shadow-sm flex items-center gap-2 font-semibold text-sm\"\n                            >\n                                <FiRadio size={18} />\n                                <span className=\"hidden md:inline\">History</span>\n                            </button>\n                            <button\n                                onClick={() => setShowBroadcastPanel(true)}\n                                className=\"flex-shrink-0 px-4 py-2 bg-gradient-to-br from-purple-600 to-purple-700 text-white rounded-xl hover:from-purple-700 hover:to-purple-800 transition-all shadow-md flex items-center gap-2 font-semibold text-sm\"\n                            >\n                                <FiRadio size={18} />\n                                <span className=\"hidden sm:inline\">Broadcast</span>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Active Broadcasts */}\n                {broadcasts.length > 0 && (\n                    <div className=\"flex-shrink-0 px-4 md:px-6 py-3 space-y-3 bg-white/50 border-b border-gray-200/50\">\n                        {broadcasts\n                            .filter((b: BroadcastAlertType) => !dismissedBroadcasts.includes(b.id))\n                            .slice(0, 3)\n                            .map((broadcast: BroadcastAlertType) => (\n                                <BroadcastAlert\n                                    key={broadcast.id}\n                                    broadcast={broadcast}\n                                    onDismiss={() => setDismissedBroadcasts((prev) => [...prev, broadcast.id])}\n                                />\n                            ))}\n                    </div>\n                )}\n\n                {/* Message List */}\n                <div className=\"flex-1 overflow-hidden flex flex-col\">\n                    <MessageList\n                        messages={messages}\n                        currentUserId={user?.id || ''}\n                        isLoading={isLoading}\n                        onDeleteMessage={handleDelete}\n                    />\n                </div>\n\n                {/* Typing Indicator */}\n                <TypingIndicator typingUsers={typingUsers} />\n\n                {/* Message Input */}\n                <div className=\"flex-shrink-0\">\n                    <MessageInput\n                        onSend={handleSend}\n                        isSending={isSending}\n                        placeholder={`Message ${currentHub.name}...`}\n                        disabled={!user}\n                        onTyping={setTyping}\n                        onStopTyping={clearTyping}\n                    />\n                </div>\n            </div>\n\n            {/* Broadcast Panel */}\n            {showBroadcastPanel && (\n                <BroadcastPanel onClose={() => setShowBroadcastPanel(false)} />\n            )}\n\n            {/* Broadcast History */}\n            {showBroadcastHistory && (\n                <BroadcastHistory onClose={() => setShowBroadcastHistory(false)} />\n            )}\n        </>\n    );\n};\n\nexport default MessagesPage;\n"],"names":["MessageBubble","message","isOwnMessage","onDelete","showAvatar","showMenu","setShowMenu","useState","isRead","readBy","length","jsxs","className","children","jsx","senderName","charAt","toUpperCase","text","mediaURL","src","alt","date","diff","Date","getTime","minutes","Math","floor","toLocaleTimeString","hour","minute","toLocaleDateString","month","day","formatTime","timestamp","FiCheck","size","onClick","FiMoreVertical","Fragment","id","FiTrash2","MessageList","messages","currentUserId","isLoading","onDeleteMessage","messagesEndRef","useRef","listRef","useEffect","current","scrollIntoView","behavior","groupedMessages","forEach","index","prevMessage","senderId","push","MessageBubbleSkeleton","isOwn","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","ref","map","MessageInput","onSend","isSending","placeholder","disabled","onTyping","onStopTyping","setMessage","textareaRef","typingTimeoutRef","style","height","scrollHeight","handleSubmit","e","preventDefault","trimmedMessage","trim","clearTimeout","onSubmit","type","FiPaperclip","value","onChange","target","setTimeout","onKeyDown","key","shiftKey","rows","minHeight","maxHeight","FiSmile","FiSend","BroadcastPanel","onClose","title","setTitle","priority","setPriority","setType","hasExpiry","setHasExpiry","expiryHours","setExpiryHours","createBroadcast","useCreateBroadcast","typeOptions","label","icon","FiInfo","FiAlertTriangle","FiClock","FiX","expiresAt","now","mutate","onSuccess","option","Icon","color","htmlFor","maxLength","required","checked","max","parseInt","min","isPending","BroadcastHistory","data","broadcasts","useHubBroadcasts","acknowledgeBroadcast","useAcknowledgeBroadcast","user","useAuthStore","getBroadcastIcon","broadcast","getPriorityColor","getPriorityTextColor","acknowledged","includes","isAcknowledged","formatDistanceToNow","addSuffix","handleAcknowledge","broadcastId","BroadcastAlert","onDismiss","acknowledgedBy","typeConfig","emergency","bgColor","borderColor","textColor","iconColor","buttonColor","urgent","FiAlertCircle","info","config","TypingIndicator","typingUsers","animationDelay","userName","clearTypingStatus","async","hubId","userId","typingRef","doc","db","deleteDoc","error","console","useTyping","setTypingUsers","unsubscribe","callback","typingCollectionRef","collection","onSnapshot","snapshot","toDate","subscribeToTypingStatus","users","activeTypingUsers","filter","u","age","setTyping","useCallback","setDoc","Timestamp","setTypingStatus","displayName","clearTyping","MessagesPage","useAuth","currentHub","useHubStore","useHubMessages","sendMessageAsync","sendError","useSendMessage","deleteMessageAsync","useDeleteMessage","markAsReadAsync","useMarkMessageAsRead","showBroadcastPanel","setShowBroadcastPanel","showBroadcastHistory","setShowBroadcastHistory","dismissedBroadcasts","setDismissedBroadcasts","toast","Helmet","name","content","FiRadio","b","slice","prev","messageId","window","confirm","success","Error","FiUsers"],"mappings":"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"}