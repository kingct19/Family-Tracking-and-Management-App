import{r as e,j as t,w as a,D as s,ap as r,aq as n,ar as i,z as l,as as o,$ as c,a0 as d,ah as u,at as m,a4 as x,au as p,g as h,e as y,f as g,n as f,p as v,X as b,av as j}from"./vendor-Yz3niDpg.js";import{B as w}from"./Button-D6lpmbx7.js";import{T as N}from"./TextField-wgpo0Y90.js";import{V as C}from"./Skeleton-CKTxZ5fm.js";import{f as S,p as A,j as k,s as E,h as I,u as P,A as D,q as z,B as F,r as V}from"./firebase-BB8Fp3FL.js";import{d as K,u as U}from"./index-XwJoYhXH.js";import"./query-C1EzXcVj.js";import"./state-CPa13AEy.js";const T="AES-GCM";async function L(e,t){const a=new TextEncoder,s=await crypto.subtle.importKey("raw",a.encode(e),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t.buffer,iterations:1e5,hash:"SHA-256"},s,{name:T,length:256},!1,["encrypt","decrypt"])}async function q(e,t,a){const s=(new TextEncoder).encode(e),r=a||crypto.getRandomValues(new Uint8Array(16)),n=await L(t,r),i=crypto.getRandomValues(new Uint8Array(12)),l=await crypto.subtle.encrypt({name:T,iv:i,tagLength:128},n,s);return{ciphertext:btoa(String.fromCharCode(...new Uint8Array(l))),salt:btoa(String.fromCharCode(...r)),iv:btoa(String.fromCharCode(...i))}}async function B(e){const t=(new TextEncoder).encode(e),a=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,"0")).join("")}const W="vault_pin_hash",H="vault_session";function M(){return localStorage.getItem(W)}function _(){const e=Date.now()+9e5;localStorage.setItem(H,e.toString())}function G(){const e=localStorage.getItem(H);if(!e)return!1;const t=parseInt(e,10);return!(Date.now()>t)||(O(),!1)}function O(){localStorage.removeItem(H)}function Q(){G()&&_()}const R=({onAuthenticated:o,onSetupComplete:c})=>{const[d,u]=e.useState(""),[m,x]=e.useState(""),[p,h]=e.useState(!1),[y,g]=e.useState(!1),[f,v]=e.useState(!1),[b,j]=e.useState(null),C=null!==M();e.useEffect(()=>{(()=>{const e=localStorage.getItem("vault_session");e&&parseInt(e)>Date.now()&&o()})()},[o]);const S=async()=>{if(j(null),d.length<4)j("PIN must be at least 4 digits");else if(d.length>8)j("PIN must be no more than 8 digits");else if(/^\d+$/.test(d))if(d===m){g(!0);try{!function(e){localStorage.setItem(W,e)}(await B(d)),_(),l.success("Vault PIN set up successfully");const e=d;u(""),x(""),c?.(),o(e)}catch(e){console.error("Failed to set up PIN:",e),j("Failed to set up PIN. Please try again.")}finally{g(!1)}}else j("PINs do not match");else j("PIN must contain only numbers")},A=async()=>{if(j(null),d.length<4)j("Please enter your PIN");else{v(!0);try{const e=await B(d);if(e!==M())return j("Incorrect PIN. Please try again."),void u("");_(),l.success("Vault unlocked");const t=d;u(""),o(t)}catch(e){console.error("Authentication error:",e),j("Authentication failed. Please try again.")}finally{v(!1)}}};return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-indigo-50 to-blue-50 p-4",children:t.jsx("div",{className:"w-full max-w-md",children:t.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-8 md:p-10",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:t.jsx(a,{size:32,className:"text-white"})}),t.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:C?"Unlock Vault":"Set Up Vault"}),t.jsx("p",{className:"text-gray-600",children:C?"Enter your PIN to access your secure vault":"Create a PIN to secure your vault (4-8 digits)"})]}),t.jsxs("div",{className:"mb-6 flex items-center justify-center gap-2 text-sm text-green-700 bg-green-50 rounded-xl px-4 py-2",children:[t.jsx(s,{size:16}),t.jsx("span",{className:"font-medium",children:"AES-256 Encrypted"})]}),b&&t.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm",children:b}),t.jsxs("div",{className:"space-y-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"PIN"}),t.jsx("div",{className:"relative",children:t.jsx(N,{type:p?"text":"password",value:d,onChange:e=>{u(e.target.value),j(null)},placeholder:C?"Enter your PIN":"Enter PIN (4-8 digits)",fullWidth:!0,maxLength:8,inputMode:"numeric",pattern:"[0-9]*",startAdornment:t.jsx(a,{size:20,className:"text-gray-400"}),endAdornment:t.jsx("button",{type:"button",onClick:()=>h(!p),className:"p-2 text-gray-400 hover:text-gray-600","aria-label":p?"Hide PIN":"Show PIN",children:p?t.jsx(r,{size:20}):t.jsx(n,{size:20})}),autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&(C?A():S())}})})]}),!C&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Confirm PIN"}),t.jsx(N,{type:p?"text":"password",value:m,onChange:e=>{x(e.target.value),j(null)},placeholder:"Confirm PIN",fullWidth:!0,maxLength:8,inputMode:"numeric",pattern:"[0-9]*",startAdornment:t.jsx(a,{size:20,className:"text-gray-400"}),onKeyDown:e=>{"Enter"===e.key&&S()}})]})]}),t.jsx("div",{className:"space-y-3",children:C?t.jsxs(t.Fragment,{children:[t.jsx(w,{variant:"filled",size:"large",fullWidth:!0,onClick:A,disabled:f||d.length<4,loading:f,children:"Unlock Vault"}),window.PublicKeyCredential&&t.jsx(w,{variant:"outlined",size:"large",fullWidth:!0,onClick:async()=>{if(window.PublicKeyCredential)try{l("Biometric authentication coming soon",{icon:"üîê"})}catch(e){console.error("Biometric auth error:",e),l.error("Biometric authentication failed")}else l.error("Biometric authentication not available on this device")},startIcon:t.jsx(i,{size:20}),children:"Use Biometric"})]}):t.jsx(w,{variant:"filled",size:"large",fullWidth:!0,onClick:S,disabled:y||d.length<4||d!==m,loading:y,children:"Set Up Vault"})}),t.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:t.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[t.jsxs("p",{className:"flex items-center gap-2",children:[t.jsx(s,{size:12}),"Your PIN is hashed and never stored in plain text"]}),t.jsxs("p",{className:"flex items-center gap-2",children:[t.jsx(a,{size:12}),"All vault data is encrypted with AES-256"]}),t.jsxs("p",{className:"flex items-center gap-2",children:[t.jsx(a,{size:12}),"Session expires after 15 minutes of inactivity"]})]})})]})})})},Y=async(e,t,a,s)=>{try{if(!G())return{success:!1,error:"Vault session expired. Please authenticate again."};const r={updatedAt:E()},n=await(async(e,t)=>{try{if(!G())return{success:!1,error:"Vault session expired. Please authenticate again."};const a=await I(S(K,"vault",e,"items",t));if(!a.exists())return{success:!1,error:"Vault item not found"};const s=a.data(),r={id:a.id,userId:s.userId,type:s.type,title:s.title,ciphertext:s.ciphertext,metadata:{...s.metadata,salt:s.salt,iv:s.iv},createdAt:s.createdAt?.toDate()||new Date,updatedAt:s.updatedAt?.toDate()||new Date,accessedAt:s.accessedAt?.toDate()};return await P(S(K,"vault",e,"items",t),{accessedAt:E()}),Q(),{success:!0,data:r}}catch(a){return console.error("Get vault item error:",a),{success:!1,error:"Failed to fetch vault item"}}})(e,t);if(!n.success||!n.data)return{success:!1,error:"Failed to get vault item for update"};const i=n.data,l=i.metadata;if(void 0!==a.title&&(r.title=a.title),void 0!==a.content){const e=l.salt,{ciphertext:t}=(l.iv,await q(a.content,s,Uint8Array.from(atob(e),e=>e.charCodeAt(0))));r.ciphertext=t}return void 0!==a.metadata&&(r.metadata={...i.metadata,...a.metadata,salt:l.salt,iv:l.iv}),await P(S(K,"vault",e,"items",t),r),Q(),{success:!0}}catch(r){return console.error("Update vault item error:",r),{success:!1,error:"Failed to update vault item"}}},$=async(e,t)=>{const a=e.metadata,s=a.salt,r=a.iv;if(!s||!r)throw new Error("Missing encryption parameters");return async function(e,t,a,s){const r=Uint8Array.from(atob(e),e=>e.charCodeAt(0)),n=Uint8Array.from(atob(a),e=>e.charCodeAt(0)),i=Uint8Array.from(atob(s),e=>e.charCodeAt(0)),l=await L(t,n),o=await crypto.subtle.decrypt({name:T,iv:i,tagLength:128},l,r);return(new TextDecoder).decode(o)}(e.ciphertext,t,s,r)},X={password:"üîê",note:"üìù",card:"üí≥",identity:"üÜî",document:"üìÑ"},J=({item:s,encryptionKey:i,onEdit:x,onDelete:p})=>{const[h,y]=e.useState(null),[g,f]=e.useState(!1),[v,b]=e.useState(!1),[j,w]=e.useState(!1),N=async()=>{if(G())if(h)b(!v);else{f(!0);try{const e=await $(s,i);y(e),b(!0)}catch(e){console.error("Decryption error:",e),l.error("Failed to decrypt item")}finally{f(!1)}}else l.error("Session expired. Please unlock vault again.")};return t.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-all duration-200",children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center text-2xl",children:X[s.type]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"font-bold text-gray-900 flex items-center gap-2",children:[s.title,s.metadata.favorite&&t.jsx(o,{size:16,className:"text-yellow-500 fill-yellow-500"})]}),t.jsx("p",{className:"text-sm text-gray-500 capitalize",children:s.type})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>x(s,h||""),className:"p-2 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors","aria-label":"Edit item",children:t.jsx(c,{size:18})}),t.jsx("button",{onClick:()=>p(s.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors","aria-label":"Delete item",children:t.jsx(d,{size:18})})]})]}),t.jsx("div",{className:"mb-4",children:v&&h?t.jsx("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:t.jsx("p",{className:"text-sm text-gray-700 font-mono break-all",children:h})}):t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200 flex items-center gap-2",children:[t.jsx(a,{size:16,className:"text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-500",children:g?"Decrypting...":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]})}),s.metadata.tags&&s.metadata.tags.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:s.metadata.tags.map(e=>t.jsx("span",{className:"px-2 py-1 bg-purple-50 text-purple-700 rounded-md text-xs font-medium",children:e},e))}),t.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-100",children:[t.jsx("button",{onClick:N,disabled:g,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors text-sm font-medium disabled:opacity-50",children:v?t.jsxs(t.Fragment,{children:[t.jsx(r,{size:16}),"Hide"]}):t.jsxs(t.Fragment,{children:[t.jsx(n,{size:16}),"Reveal"]})}),t.jsx("button",{onClick:async()=>{if(h)try{await navigator.clipboard.writeText(h),w(!0),l.success("Copied to clipboard"),setTimeout(()=>w(!1),2e3)}catch(e){l.error("Failed to copy")}else await N()},className:"flex items-center justify-center gap-2 px-4 py-2 bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium","aria-label":"Copy content",children:j?t.jsx(u,{size:16}):t.jsx(m,{size:16})})]}),t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100 text-xs text-gray-500",children:t.jsxs("p",{children:["Updated ",new Date(s.updatedAt).toLocaleDateString()]})})]})},Z=[{value:"password",label:"Password",icon:"üîê"},{value:"note",label:"Secure Note",icon:"üìù"},{value:"card",label:"Credit Card",icon:"üí≥"},{value:"identity",label:"Identity",icon:"üÜî"},{value:"document",label:"Document",icon:"üìÑ"}],ee=({isOpen:a,onClose:s,onSave:i,item:l,decryptedContent:c,isLoading:d=!1})=>{const[u,m]=e.useState({type:"password",title:"",content:"",favorite:!1,tags:[]}),[h,y]=e.useState(!1),[g,f]=e.useState(""),[v,b]=e.useState({});e.useEffect(()=>{a&&(m(l&&c?{type:l.type,title:l.title,content:c,favorite:l.metadata.favorite,tags:l.metadata.tags||[]}:{type:"password",title:"",content:"",favorite:!1,tags:[]}),b({}),y(!1))},[a,l,c]);const j=(e,t)=>{m(a=>({...a,[e]:t})),v[e]&&b(t=>{const a={...t};return delete a[e],a})},C=()=>{g.trim()&&!u.tags.includes(g.trim())&&(j("tags",[...u.tags,g.trim()]),f(""))},S=async e=>{e.preventDefault();const t={};if(u.title.trim()||(t.title="Title is required"),u.content.trim()||(t.content="Content is required"),Object.keys(t).length>0)b(t);else try{await i({type:u.type,title:u.title.trim(),content:u.content.trim(),metadata:{favorite:u.favorite,tags:u.tags}}),s()}catch(a){}};return a?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:s,children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col animate-slide-up",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:l?"Edit Vault Item":"Create Vault Item"}),t.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:t.jsx(x,{size:24,className:"text-gray-600"})})]}),t.jsx("form",{onSubmit:S,className:"flex-1 overflow-y-auto p-6",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Type"}),t.jsx("div",{className:"grid grid-cols-5 gap-2",children:Z.map(e=>t.jsxs("button",{type:"button",onClick:()=>j("type",e.value),className:"p-3 rounded-xl border-2 transition-all "+(u.type===e.value?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),children:[t.jsx("div",{className:"text-2xl mb-1",children:e.icon}),t.jsx("div",{className:"text-xs font-medium text-gray-700",children:e.label})]},e.value))})]}),t.jsx(N,{label:"Title",value:u.title,onChange:e=>j("title",e.target.value),placeholder:"Enter item title",required:!0,error:v.title,fullWidth:!0}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Content"}),t.jsxs("div",{className:"relative",children:[t.jsx("textarea",{value:u.content,onChange:e=>j("content",e.target.value),placeholder:"password"===u.type?"Enter password":"card"===u.type?"Enter card details":"Enter content",rows:"note"===u.type?8:4,className:`w-full px-4 py-3 pr-12 rounded-xl border-2 transition-colors ${v.content?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-purple-500"} focus:outline-none focus:ring-2 focus:ring-purple-500`}),t.jsx("button",{type:"button",onClick:()=>y(!h),className:"absolute right-3 top-3 p-2 text-gray-400 hover:text-gray-600","aria-label":h?"Hide content":"Show content",children:h?t.jsx(r,{size:20}):t.jsx(n,{size:20})})]}),v.content&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.content}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"This content will be encrypted before storage"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Tags"}),t.jsxs("div",{className:"flex gap-2 mb-2",children:[t.jsx(N,{value:g,onChange:e=>f(e.target.value),placeholder:"Add tag",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),C())},startAdornment:t.jsx(p,{size:16,className:"text-gray-400"}),className:"flex-1"}),t.jsx(w,{type:"button",variant:"outlined",onClick:C,disabled:!g.trim(),children:"Add"})]}),u.tags.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:u.tags.map(e=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm",children:[e,t.jsx("button",{type:"button",onClick:()=>(e=>{j("tags",u.tags.filter(t=>t!==e))})(e),className:"hover:text-purple-900",children:"√ó"})]},e))})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"favorite",checked:u.favorite,onChange:e=>j("favorite",e.target.checked),className:"w-5 h-5 rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),t.jsxs("label",{htmlFor:"favorite",className:"flex items-center gap-2 cursor-pointer",children:[t.jsx(o,{size:16,className:u.favorite?"text-yellow-500 fill-yellow-500":"text-gray-400"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Mark as favorite"})]})]})]})}),t.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50",children:[t.jsx(w,{variant:"outlined",onClick:s,disabled:d,children:"Cancel"}),t.jsx(w,{variant:"filled",onClick:S,disabled:d,loading:d,children:d?"Saving...":l?"Save Changes":"Create Item"})]})]})}):null},te=()=>{const{user:e}=U();return h({queryKey:["vault-items",e?.id],queryFn:async()=>{if(!e)throw new Error("User not authenticated");if(!G())throw new Error("Vault session expired");const t=await(async e=>{try{if(!G())return{success:!1,error:"Vault session expired. Please authenticate again."};const t=z(A(K,"vault",e,"items"),F("updatedAt","desc")),a=await V(t),s=[];return a.forEach(e=>{const t=e.data();s.push({id:e.id,userId:t.userId,type:t.type,title:t.title,ciphertext:t.ciphertext,metadata:{...t.metadata,salt:t.salt,iv:t.iv},createdAt:t.createdAt?.toDate()||new Date,updatedAt:t.updatedAt?.toDate()||new Date,accessedAt:t.accessedAt?.toDate()})}),Q(),{success:!0,data:s}}catch(t){return console.error("Get vault items error:",t),{success:!1,error:"Failed to fetch vault items"}}})(e.id);if(!t.success)throw new Error(t.error);return t.data||[]},enabled:!!e&&G(),staleTime:3e4})},ae=()=>{const t=y(),{user:a}=U(),[s,r]=e.useState(null),n=e.useCallback(e=>{r(e)},[]),i=g({mutationFn:async e=>{if(!a||!s)throw new Error("User or encryption key not available");const t=await(async(e,t,a)=>{try{if(!G())return{success:!1,error:"Vault session expired. Please authenticate again."};const{ciphertext:s,salt:r,iv:n}=await q(t.content,a),i=S(A(K,"vault",e,"items")),l={userId:e,type:t.type,title:t.title,ciphertext:s,metadata:{icon:t.metadata?.icon,category:t.metadata?.category,tags:t.metadata?.tags||[],favorite:t.metadata?.favorite||!1}};await k(i,{...l,salt:r,iv:n,createdAt:E(),updatedAt:E()}),Q();const o=(await I(i)).data();return{success:!0,data:{id:i.id,...l,createdAt:o?.createdAt?.toDate()||new Date,updatedAt:o?.updatedAt?.toDate()||new Date}}}catch(s){return console.error("Create vault item error:",s),{success:!1,error:"Failed to create vault item"}}})(a.id,e,s);if(!t.success)throw new Error(t.error);return t.data},onSuccess:()=>{t.invalidateQueries({queryKey:["vault-items",a?.id]}),l.success("Vault item created")},onError:e=>{l.error(e.message||"Failed to create vault item")}});return{...i,setEncryptionKey:n}},se=()=>{const e=y(),{user:t}=U();return g({mutationFn:async e=>{if(!t)throw new Error("User not authenticated");const a=await(async(e,t)=>{try{return G()?(await D(S(K,"vault",e,"items",t)),Q(),{success:!0}):{success:!1,error:"Vault session expired. Please authenticate again."}}catch(a){return console.error("Delete vault item error:",a),{success:!1,error:"Failed to delete vault item"}}})(t.id,e);if(!a.success)throw new Error(a.error)},onSuccess:()=>{e.invalidateQueries({queryKey:["vault-items",t?.id]}),l.success("Vault item deleted")},onError:e=>{l.error(e.message||"Failed to delete vault item")}})},re=()=>{U(),f();const[r,n]=e.useState(!1),[i,o]=e.useState(null),[c,d]=e.useState(!1),[u,m]=e.useState(null),[x,p]=e.useState(""),[h,S]=e.useState(""),[A,k]=e.useState("all"),{data:E=[],isLoading:I}=te(),P=ae(),D=(()=>{const t=y(),{user:a}=U(),[s,r]=e.useState(null),n=e.useCallback(e=>{r(e)},[]);return{...g({mutationFn:async({itemId:e,updates:t})=>{if(!a||!s)throw new Error("User or encryption key not available");const r=await Y(a.id,e,t,s);if(!r.success)throw new Error(r.error)},onSuccess:()=>{t.invalidateQueries({queryKey:["vault-items",a?.id]}),l.success("Vault item updated")},onError:e=>{l.error(e.message||"Failed to update vault item")}}),setEncryptionKey:n}})(),z=se(),{decrypt:F,setEncryptionKey:V}=(()=>{const[t,a]=e.useState(null),s=e.useCallback(e=>{a(e)},[]);return{decrypt:e.useCallback(async e=>{if(!t)throw new Error("Encryption key not set");return $(e,t)},[t]),setEncryptionKey:s}})();e.useEffect(()=>{G()&&n(!0)},[]),e.useEffect(()=>{r&&i&&(P.setEncryptionKey(i),D.setEncryptionKey(i),V(i))},[r,i,P,D,V]),e.useEffect(()=>{const e=setInterval(()=>{!G()&&r&&(n(!1),o(null),O(),l.error("Vault session expired. Please unlock again."))},6e4);return()=>clearInterval(e)},[r]);const K=e=>{o(e||null),n(!0)},T=()=>{m(null),p(""),d(!0)},L=async(e,t)=>{if(!i)return void l.error("Encryption key not available");let a=t;if(!a)try{a=await F(e)}catch(s){return void l.error("Failed to decrypt item")}m(e),p(a),d(!0)},q=async e=>{if(confirm("Are you sure you want to delete this vault item? This cannot be undone."))try{await z.mutateAsync(e)}catch(t){}},B=E.filter(e=>{const t=""===h||e.title.toLowerCase().includes(h.toLowerCase())||e.metadata.tags?.some(e=>e.toLowerCase().includes(h.toLowerCase())),a="all"===A||e.type===A;return t&&a});return r&&i?t.jsxs(t.Fragment,{children:[t.jsxs(v,{children:[t.jsx("title",{children:"Vault - Family Safety App"}),t.jsx("meta",{name:"description",content:"Securely store sensitive information"})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-6 mb-8",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3 flex-wrap",children:[t.jsx("h1",{className:"text-headline-lg md:text-display-sm font-normal text-on-surface",children:"Digital Vault"}),t.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-50 border border-green-200 rounded-full",children:[t.jsx(s,{size:14,className:"text-green-600"}),t.jsx("span",{className:"text-label-sm font-semibold text-green-700",children:"Encrypted"})]})]}),t.jsx("p",{className:"text-body-lg text-on-variant",children:"Secure storage for passwords and sensitive information"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(w,{variant:"outlined",onClick:()=>{n(!1),o(null),O(),l.success("Vault locked")},startIcon:t.jsx(a,{size:18}),className:"btn-base border-2 border-outline-variant text-on-surface hover:bg-surface-variant",children:"Lock Vault"}),t.jsx(w,{variant:"filled",onClick:T,startIcon:t.jsx(b,{size:18}),className:"btn-base bg-primary text-on-primary hover:bg-primary/90 shadow-elevation-2",children:"Add Item"})]})]}),E.length>0&&t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsx(N,{value:h,onChange:e=>S(e.target.value),placeholder:"Search vault items...",startAdornment:t.jsx(j,{size:18,className:"text-gray-400"}),fullWidth:!0})}),t.jsx("div",{className:"sm:w-48",children:t.jsxs("select",{value:A,onChange:e=>k(e.target.value),className:"input-base",children:[t.jsx("option",{value:"all",children:"All Types"}),t.jsx("option",{value:"password",children:"Passwords"}),t.jsx("option",{value:"note",children:"Notes"}),t.jsx("option",{value:"card",children:"Cards"}),t.jsx("option",{value:"identity",children:"Identity"}),t.jsx("option",{value:"document",children:"Documents"})]})})]}),I?t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((e,a)=>t.jsx(C,{},a))}):0===B.length?t.jsxs("div",{className:"card p-12 text-center",children:[t.jsx("div",{className:"w-20 h-20 bg-primary-container rounded-full flex items-center justify-center mx-auto mb-6 shadow-elevation-2",children:t.jsx(a,{size:32,className:"text-primary"})}),t.jsx("h3",{className:"text-headline-md font-normal text-on-surface mb-3",children:0===E.length?"Your vault is empty":"No items found"}),t.jsx("p",{className:"text-body-lg text-on-variant mb-8 max-w-md mx-auto",children:0===E.length?"Start by adding your first secure item":"Try adjusting your search or filter"}),0===E.length&&t.jsx(w,{variant:"filled",onClick:T,startIcon:t.jsx(b,{size:18}),className:"btn-base bg-primary text-on-primary hover:bg-primary/90 shadow-elevation-2",children:"Add Your First Item"})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:B.map(e=>t.jsx(J,{item:e,encryptionKey:i,onEdit:L,onDelete:q},e.id))}),c&&t.jsx(ee,{isOpen:c,onClose:()=>{d(!1),m(null),p("")},onSave:async e=>{if(i)try{u?await D.mutateAsync({itemId:u.id,updates:e}):await P.mutateAsync(e),d(!1),m(null),p("")}catch(t){}else l.error("Encryption key not available")},item:u,decryptedContent:x,isLoading:P.isPending||D.isPending})]})]}):t.jsx(R,{onAuthenticated:K,onSetupComplete:()=>{}})};export{re as default};
//# sourceMappingURL=VaultPage-CTMMBtFZ.js.map
