import{j as e,ab as s,ac as a,E as t,G as r,$ as l,a0 as i,r as n,a4 as o,ad as d,ae as c,x as m,af as u,ag as x,z as p,e as g,p as h,X as b,s as j,C as f}from"./vendor-Yz3niDpg.js";import{B as v}from"./Button-D6lpmbx7.js";import{T as y}from"./Skeleton-CKTxZ5fm.js";import{C as N,a as w,b as k,c as C}from"./Card-D91uPdLB.js";import{f as T,L as S,b as P,c as D}from"./index-XwJoYhXH.js";import{T as A}from"./TextField-wgpo0Y90.js";import{u as z}from"./useHubMembers-BlHRT3SA.js";import{u as F}from"./storage-service-DKyMHPFN.js";import{s as I}from"./task-api-CifnuJS5.js";import{u as E,a as L,b as M,c as O,d as R}from"./useTasks-CcRx-I0r.js";import"./query-C1EzXcVj.js";import"./firebase-BB8Fp3FL.js";import"./state-CPa13AEy.js";import"./xp-api-Dlw9aMIE.js";const q=({task:n,onComplete:o,onEdit:d,onDelete:c,onViewDetails:m,showActions:u=!0,isAdmin:x=!1})=>{const p="pending"===n.status,g="assigned"===n.status,h="done"===n.status,b=n.deadline&&new Date(n.deadline)<new Date&&!h,j={pending:{label:"Pending",color:"text-outline"},assigned:{label:"Assigned",color:"text-primary"},submitted:{label:"Submitted",color:"text-secondary"},approved:{label:"Approved",color:"text-tertiary"},rejected:{label:"Rejected",color:"text-error"},done:{label:"Done",color:"text-tertiary"}}[n.status];return e.jsxs(N,{elevation:1,interactive:!!m,onClick:m?()=>m(n):void 0,className:T({"border-l-4 border-error":b}),children:[e.jsx(w,{title:n.title,subtitle:j.label+(n.deadline?` â€¢ ${a(new Date(n.deadline),"MMM d, yyyy")}`:""),action:u&&e.jsx("button",{className:"p-2 rounded-full hover:bg-surface-variant","aria-label":"Task options",children:e.jsx(s,{size:20,className:"text-on-variant"})})}),n.description&&e.jsx(k,{children:e.jsx("p",{className:"text-body-sm text-on-variant line-clamp-2",children:n.description})}),e.jsx(k,{className:"pt-0",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-label-sm text-on-variant",children:"XP:"}),e.jsx("span",{className:"text-label-md text-primary",children:n.weight})]}),n.assignedTo&&e.jsxs("div",{className:"flex items-center gap-1 text-on-variant",children:[e.jsx(t,{size:16}),e.jsx("span",{className:"text-label-sm",children:"Assigned"})]})]})}),u&&e.jsxs(C,{children:[g&&o&&!x&&e.jsx(v,{variant:"filled",size:"small",startIcon:e.jsx(r,{size:16}),onClick:e=>{e.stopPropagation(),o(n.id)},children:"Complete"}),x&&d&&e.jsx(v,{variant:"tonal",size:"small",startIcon:e.jsx(l,{size:16}),onClick:e=>{e.stopPropagation(),d(n)},children:"Edit"}),x&&c&&(p||g)&&e.jsx(v,{variant:"outlined",size:"small",startIcon:e.jsx(i,{size:16}),onClick:e=>{e.stopPropagation(),confirm("Are you sure you want to delete this task?")&&c(n.id)},className:"ml-auto",children:"Delete"})]})]})},B=({tasks:s,onComplete:a,onEdit:t,onDelete:r,onViewDetails:l,isAdmin:i=!1,filter:o="all",sortBy:d="deadline"})=>{const c=n.useMemo(()=>"all"===o?s:s.filter(e=>e.status===o),[s,o]),m=n.useMemo(()=>[...c].sort((e,s)=>"deadline"===d?e.deadline?s.deadline?new Date(e.deadline).getTime()-new Date(s.deadline).getTime():-1:1:"weight"===d?s.weight-e.weight:new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime()),[c,d]);return 0===m.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("p",{className:"text-body-lg text-on-variant mb-2",children:"No tasks found"}),e.jsx("p",{className:"text-body-sm text-on-variant",children:"all"===o?"Create a new task to get started":`No ${o} tasks at the moment`})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:m.map(s=>e.jsx(q,{task:s,onComplete:a,onEdit:t,onDelete:r,onViewDetails:l,isAdmin:i},s.id))})},U=({currentFilter:s,onChange:a,counts:t})=>e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{value:"all",label:"All"},{value:"pending",label:"Pending"},{value:"assigned",label:"Assigned"},{value:"submitted",label:"Submitted"},{value:"done",label:"Done"}].map(r=>e.jsxs("button",{onClick:()=>a(r.value),className:T("px-4 py-2 rounded-full text-label-md transition-colors duration-fast","focus:outline-none focus:ring-2 focus:ring-primary",{"bg-secondary-container text-on-secondary-container":s===r.value,"bg-surface-variant text-on-variant hover:bg-outline-variant":s!==r.value}),children:[r.label,t&&t[r.value]>0&&e.jsxs("span",{className:"ml-2 text-label-sm opacity-75",children:["(",t[r.value],")"]})]},r.value))}),W=({currentSort:s,onChange:a})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-label-sm text-on-variant",children:"Sort by:"}),e.jsx("select",{value:s,onChange:e=>a(e.target.value),className:T("px-3 py-1.5 rounded-lg bg-surface-variant text-body-md text-on-surface","border border-outline focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary","cursor-pointer"),children:[{value:"deadline",label:"Due date"},{value:"weight",label:"XP value"},{value:"createdAt",label:"Created date"}].map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),G={title:"",description:"",deadline:"",weight:10,status:"pending"},V=({isOpen:s,onClose:a,onSave:r,task:l,isLoading:i=!1})=>{const[u,x]=n.useState(G),[p,g]=n.useState({}),{data:h=[],isLoading:b}=z();n.useEffect(()=>{s&&(x(l?{title:l.title,description:l.description||"",deadline:l.deadline?new Date(l.deadline).toISOString().split("T")[0]:"",weight:l.weight,assignedTo:l.assignedTo||"",status:l.status}:G),g({}))},[s,l]);const j=(e,s)=>{x(a=>({...a,[e]:s})),p[e]&&g(s=>({...s,[e]:void 0}))},f=async e=>{if(e.preventDefault(),(()=>{const e={};return u.title.trim()||(e.title="Title is required"),(u.weight<1||u.weight>10)&&(e.weight="Weight must be between 1 and 10"),u.deadline&&new Date(u.deadline)<new Date&&(e.deadline="Deadline cannot be in the past"),g(e),0===Object.keys(e).length})())try{await r(u),a()}catch(s){}};return s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:a,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col animate-slide-up",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:l?"Edit Task":"Create New Task"}),e.jsx("button",{onClick:a,className:"p-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:e.jsx(o,{size:24,className:"text-gray-600"})})]}),e.jsx("form",{onSubmit:f,className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{label:"Task Title",value:u.title,onChange:e=>j("title",e.target.value),placeholder:"Enter task title",required:!0,error:p.title,startAdornment:e.jsx(d,{size:20,className:"text-gray-400"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:u.description,onChange:e=>j("description",e.target.value),placeholder:"Enter task description (optional)",rows:4,className:T("w-full px-4 py-3 rounded-xl border-2 transition-colors","focus:outline-none focus:ring-2 focus:ring-purple-500",p.description?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-purple-500")}),p.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.description})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(t,{size:16,className:"inline mr-1"}),"Assign To (Optional)"]}),b?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 rounded-xl border-2 border-gray-200",children:[e.jsx(S,{size:"small"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Loading members..."})]}):e.jsxs("select",{value:u.assignedTo||"",onChange:e=>j("assignedTo",e.target.value),className:T("w-full px-4 py-3 rounded-xl border-2 transition-colors","focus:outline-none focus:ring-2 focus:ring-purple-500",p.assignedTo?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-purple-500"),children:[e.jsx("option",{value:"",children:"Unassigned"}),h.map(s=>e.jsxs("option",{value:s.userId,children:[s.displayName," ","admin"===s.role?"(Admin)":""]},s.userId))]}),p.assignedTo&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.assignedTo}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Leave unassigned to create a general task, or assign to a specific member"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(c,{size:16,className:"inline mr-1"}),"Deadline"]}),e.jsx("input",{type:"date",value:u.deadline,onChange:e=>j("deadline",e.target.value),min:(new Date).toISOString().split("T")[0],className:T("w-full px-4 py-3 rounded-xl border-2 transition-colors","focus:outline-none focus:ring-2 focus:ring-purple-500",p.deadline?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-purple-500")}),p.deadline&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.deadline})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(m,{size:16,className:"inline mr-1"}),"XP Value"]}),e.jsx("input",{type:"number",value:u.weight,onChange:e=>j("weight",parseInt(e.target.value)||0),min:1,max:10,className:T("w-full px-4 py-3 rounded-xl border-2 transition-colors","focus:outline-none focus:ring-2 focus:ring-purple-500",p.weight?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-purple-500")}),p.weight&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.weight}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Points awarded when completed (1-10)"})]})]}),l&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:u.status,onChange:e=>j("status",e.target.value),className:"w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"submitted",children:"Submitted"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"done",children:"Done"})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50",children:[e.jsx(v,{variant:"outlined",onClick:a,disabled:i,children:"Cancel"}),e.jsx(v,{variant:"filled",onClick:f,disabled:i,startIcon:void 0,children:i?"Saving...":l?"Save Changes":"Create Task"})]})]})}):null},X=({onUpload:s,onCancel:a,isLoading:t=!1,existingProof:r})=>{const[l,i]=n.useState(null),[d,c]=n.useState(r||null),[m,g]=n.useState(""),h=n.useRef(null);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photo Proof *"}),d?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:d,alt:"Proof preview",className:"w-full h-64 object-cover rounded-lg border-2 border-gray-200"}),e.jsx("button",{onClick:()=>{i(null),c(null),h.current&&(h.current.value="")},className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors","aria-label":"Remove photo",children:e.jsx(o,{size:18})})]}):e.jsxs("div",{onClick:()=>h.current?.click(),className:"w-full h-64 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-purple-400 hover:bg-purple-50 transition-colors",children:[e.jsx(u,{size:48,className:"text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Click to upload photo"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"JPEG, PNG, or WebP (max 5MB)"})]}),e.jsx("input",{ref:h,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:e=>{const s=e.target.files?.[0];if(!s)return;if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(s.type))return void p.error("Please select a JPEG, PNG, or WebP image");if(s.size>5242880)return void p.error("Image size must be less than 5MB");i(s);const a=new FileReader;a.onloadend=()=>{c(a.result)},a.readAsDataURL(s)},className:"hidden"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-label-md text-on-surface mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:m,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 text-body-md text-on-surface bg-surface border-2 rounded-xl border-outline focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",placeholder:"Add any additional notes about the completion...",rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(v,{variant:"outlined",onClick:a,disabled:t,fullWidth:!0,children:"Cancel"}),e.jsx(v,{variant:"filled",onClick:async()=>{l||r?l?await s(l,m||void 0):await s(new File([],""),m||void 0):p.error("Please select a photo")},loading:t,disabled:t||!l&&!r,startIcon:e.jsx(x,{size:18}),fullWidth:!0,children:r?"Update Proof":"Submit Proof"})]})]})},H=({isOpen:s,onClose:a,task:t,onSuccess:r})=>{const{currentHub:l}=P(),[i,d]=n.useState(!1);return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 sticky top-0 bg-white z-10",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Complete Task"}),e.jsx("button",{onClick:a,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close",children:e.jsx(o,{size:20})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t.title}),t.description&&e.jsx("p",{className:"text-gray-600",children:t.description}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Please upload a photo as proof of completion"})]}),e.jsx(X,{onUpload:async(e,s)=>{if(l){d(!0);try{const i=await F(e,l.id,t.id),n=await I(l.id,t.id,i,s);n.success?(p.success("Proof submitted! Waiting for admin approval."),r(),a()):p.error(n.error||"Failed to submit proof")}catch(i){console.error("Submit proof error:",i),p.error(i.message||"Failed to upload proof")}finally{d(!1)}}else p.error("No hub selected")},onCancel:a,isLoading:i,existingProof:t.proofURL})]})]})}):null},$=()=>{const s=g(),{currentHub:a}=P(),{data:t,isLoading:r,error:l}=E(),i=L(),o=M(),d=O(),c=R(),m=D(),[u,x]=n.useState("all"),[p,N]=n.useState("deadline"),[w,k]=n.useState(!1),[C,T]=n.useState(!1),[S,A]=n.useState(null),[z,F]=n.useState(null),I=n.useMemo(()=>{if(!t)return{};return t.reduce((e,s)=>(e[s.status]=(e[s.status]||0)+1,e.all=(e.all||0)+1,e),{})},[t]),q=e=>{A(e),k(!0)},G=()=>{A(null),k(!0)};return r?e.jsxs(e.Fragment,{children:[e.jsx(h,{children:e.jsx("title",{children:"Tasks - Family Safety App"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-2xl animate-pulse"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-32 bg-gray-200 rounded animate-pulse mb-2"}),e.jsx("div",{className:"h-4 w-48 bg-gray-200 rounded animate-pulse"})]})]}),e.jsx("div",{className:"h-11 w-32 bg-gray-200 rounded-xl animate-pulse"})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:[...Array(5)].map((s,a)=>e.jsx("div",{className:"h-10 w-24 bg-gray-200 rounded-xl animate-pulse"},a))}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[...Array(6)].map((s,a)=>e.jsx(y,{},a))})]})]}):l?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-body-lg text-error",children:"Failed to load tasks"}),e.jsx("p",{className:"text-body-sm text-on-variant mt-2",children:"Please try refreshing the page"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[e.jsx("title",{children:"Tasks - Family Safety App"}),e.jsx("meta",{name:"description",content:"Manage and track your family tasks"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-headline-md text-on-background",children:"Tasks"}),e.jsx("p",{className:"text-body-md text-on-variant mt-1",children:"Manage and track tasks for your team"})]}),m&&e.jsx(v,{variant:"filled",size:"medium",startIcon:e.jsx(b,{size:20}),onClick:G,children:"Create task"})]}),e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsx(U,{currentFilter:u,onChange:x,counts:I}),e.jsx(W,{currentSort:p,onChange:N})]}),t&&t.length>0?e.jsx(B,{tasks:t,filter:u,sortBy:p,onComplete:async e=>{const s=t?.find(s=>s.id===e);if(s)if("assigned"===s.status||"pending"===s.status)F(s),T(!0);else try{await i.mutateAsync({taskId:e,task:s}),f.success("Task completed!")}catch(a){f.error("Failed to complete task")}else f.error("Task not found")},onEdit:q,onDelete:async e=>{try{await o.mutateAsync(e),f.success("Task deleted")}catch(s){f.error("Failed to delete task")}},onViewDetails:e=>{q(e)},isAdmin:m}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-primary-container to-purple-100 rounded-full flex items-center justify-center mb-6 shadow-elevation-2",children:e.jsx(j,{size:48,className:"text-primary"})}),e.jsx("h3",{className:"text-headline-md font-normal text-on-surface mb-3",children:"No tasks yet"}),e.jsx("p",{className:"text-body-lg text-on-variant text-center mb-8 max-w-md",children:m?"Create your first task to get started with task management":"No tasks have been assigned yet. Check back later!"}),m&&e.jsx(v,{variant:"filled",onClick:G,startIcon:e.jsx(b,{size:20}),className:"btn-base bg-primary text-on-primary hover:bg-primary/90 shadow-elevation-2",children:"Create Your First Task"})]})]}),e.jsx(V,{isOpen:w,onClose:()=>{k(!1),A(null)},onSave:async e=>{try{S?(await c.mutateAsync({taskId:S.id,updates:{title:e.title,description:e.description,deadline:e.deadline?new Date(e.deadline):void 0,weight:e.weight,status:e.status,assignedTo:e.assignedTo}}),f.success("Task updated successfully!")):(await d.mutateAsync({title:e.title,description:e.description,deadline:e.deadline?new Date(e.deadline):void 0,weight:e.weight,assignedTo:e.assignedTo,requiresProof:e.requiresProof||!1}),f.success("Task created successfully!")),k(!1),A(null)}catch(s){throw f.error(s instanceof Error?s.message:"Failed to save task"),s}},task:S,isLoading:d.isPending||c.isPending}),z&&e.jsx(H,{isOpen:C,onClose:()=>{T(!1),F(null)},task:z,onSuccess:()=>{s.invalidateQueries({queryKey:["tasks","hub",a?.id]})}})]})};export{$ as default};
//# sourceMappingURL=TasksPage-CTyznkZV.js.map
