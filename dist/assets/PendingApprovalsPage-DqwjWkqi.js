import{e,g as s,f as r,j as a,p as t,ah as i,ai as n,E as o,U as d,a4 as l,z as c}from"./vendor-Yz3niDpg.js";import{B as m}from"./Button-D6lpmbx7.js";import{b as p,u as x,L as u}from"./index-XwJoYhXH.js";import{u as h,g as f}from"./task-api-CifnuJS5.js";import{a as j}from"./xp-api-Dlw9aMIE.js";import"./query-C1EzXcVj.js";import"./firebase-BB8Fp3FL.js";import"./state-CPa13AEy.js";const v=()=>{const{currentHub:v}=p(),{user:b}=x(),g=e(),{data:w,isLoading:y}=s({queryKey:["tasks","hub",v?.id,"pending-proof"],queryFn:async()=>{if(!v)throw new Error("No hub selected");const e=await f(v.id);if(!e.success)throw new Error(e.error);return(e.data||[]).filter(e=>"pending"===e.proofStatus&&e.proofURL)},enabled:!!v}),N=r({mutationFn:async({task:e,userId:s})=>{if(!v)throw new Error("No hub selected");if(!b)throw new Error("User not authenticated");await h(v.id,e.id,{status:"done",proofStatus:"approved",proofReviewedBy:b.id,proofReviewedAt:new Date,completedAt:new Date}),await j({userId:s,userName:`User ${s.slice(0,8)}`,amount:10*e.weight,source:"task_completion",sourceId:e.id,description:`Completed task: ${e.title}`,hubId:v.id})},onSuccess:()=>{g.invalidateQueries({queryKey:["tasks","hub",v?.id]}),g.invalidateQueries({queryKey:["xp","leaderboard"]}),c.success("Task approved and XP awarded!")},onError:e=>{c.error(e.message||"Failed to approve task")}}),k=r({mutationFn:async e=>{if(!v)throw new Error("No hub selected");if(!b)throw new Error("User not authenticated");await h(v.id,e.id,{proofStatus:"rejected",proofReviewedBy:b.id,proofReviewedAt:new Date,status:"assigned"})},onSuccess:()=>{g.invalidateQueries({queryKey:["tasks","hub",v?.id]}),c.success("Task proof rejected")},onError:e=>{c.error(e.message||"Failed to reject proof")}});return y?a.jsxs(a.Fragment,{children:[a.jsx(t,{children:a.jsx("title",{children:"Pending Approvals - Family Safety App"})}),a.jsx("div",{className:"flex items-center justify-center py-16",children:a.jsx(u,{size:"large"})})]}):a.jsxs(a.Fragment,{children:[a.jsxs(t,{children:[a.jsx("title",{children:"Pending Approvals - Family Safety App"}),a.jsx("meta",{name:"description",content:"Review and approve task proof submissions"})]}),a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-headline-lg md:text-display-sm font-normal text-on-surface mb-2",children:"Pending Approvals"}),a.jsx("p",{className:"text-body-lg text-on-variant",children:"Review and approve task completion proof"})]}),w&&0!==w.length?a.jsx("div",{className:"space-y-4",children:w.map(e=>a.jsx("div",{className:"card p-6",children:a.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[a.jsx("div",{className:"flex-shrink-0",children:e.proofURL?a.jsx("img",{src:e.proofURL,alt:`Proof for ${e.title}`,className:"w-full md:w-64 h-48 object-cover rounded-xl border-2 border-outline-variant shadow-elevation-1"}):a.jsx("div",{className:"w-full md:w-64 h-48 bg-surface-variant rounded-xl flex items-center justify-center border-2 border-outline-variant",children:a.jsx(n,{size:48,className:"text-on-variant"})})}),a.jsxs("div",{className:"flex-1 space-y-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-title-lg text-on-surface mb-2",children:e.title}),e.description&&a.jsx("p",{className:"text-body-md text-on-variant",children:e.description})]}),a.jsxs("div",{className:"flex flex-wrap gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-body-sm text-on-variant",children:[a.jsx(o,{size:16}),a.jsxs("span",{children:["Assigned to: User ",e.assignedTo?.slice(0,8)]})]}),e.proofSubmittedAt&&a.jsxs("div",{className:"flex items-center gap-2 text-body-sm text-on-variant",children:[a.jsx(d,{size:16}),a.jsxs("span",{children:["Submitted:"," ",new Date(e.proofSubmittedAt).toLocaleDateString()]})]}),a.jsxs("div",{className:"px-3 py-1.5 bg-primary-container border border-primary/20 text-primary rounded-full text-label-sm font-semibold",children:[10*e.weight," XP"]})]}),a.jsxs("div",{className:"flex gap-3 pt-4 border-t border-outline-variant",children:[a.jsx(m,{variant:"filled",onClick:()=>N.mutate({task:e,userId:e.assignedTo||""}),loading:N.isPending,disabled:N.isPending||k.isPending,startIcon:a.jsx(i,{size:18}),className:"btn-base bg-green-600 text-white hover:bg-green-700 shadow-elevation-2",children:"Approve"}),a.jsx(m,{variant:"outlined",onClick:()=>k.mutate(e),loading:k.isPending,disabled:N.isPending||k.isPending,startIcon:a.jsx(l,{size:18}),className:"btn-base border-2 border-error text-error hover:bg-error-container",children:"Reject"})]})]})]})},e.id))}):a.jsxs("div",{className:"card p-12 text-center",children:[a.jsx("div",{className:"w-20 h-20 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-6 shadow-elevation-2 border border-green-100",children:a.jsx(i,{size:40,className:"text-green-600"})}),a.jsx("h3",{className:"text-headline-md font-normal text-on-surface mb-3",children:"All caught up!"}),a.jsx("p",{className:"text-body-lg text-on-variant max-w-md mx-auto",children:"There are no pending proof submissions to review."})]})]})]})};export{v as default};
//# sourceMappingURL=PendingApprovalsPage-DqwjWkqi.js.map
