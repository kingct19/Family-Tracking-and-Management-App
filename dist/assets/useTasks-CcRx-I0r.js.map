{"version":3,"file":"useTasks-CcRx-I0r.js","sources":["../../src/features/tasks/hooks/useTasks.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useHubStore } from '@/lib/store/hub-store';\nimport { useAuth } from '@/features/auth/hooks/useAuth';\nimport {\n    getHubTasks,\n    getUserTasks,\n    createTask,\n    updateTask,\n    deleteTask,\n    assignTask,\n    completeTask,\n} from '../api/task-api';\nimport { awardXP } from '@/features/xp/api/xp-api';\nimport type { CreateTaskFormData } from '@/lib/validation/task-schemas';\nimport type { Task } from '@/types';\nimport toast from 'react-hot-toast';\n\n/**\n * Hook to fetch all tasks for current hub\n */\nexport const useHubTasks = () => {\n    const { currentHub } = useHubStore();\n\n    return useQuery({\n        queryKey: ['tasks', 'hub', currentHub?.id],\n        queryFn: async () => {\n            if (!currentHub) throw new Error('No hub selected');\n            const response = await getHubTasks(currentHub.id);\n            if (!response.success) throw new Error(response.error);\n            return response.data;\n        },\n        enabled: !!currentHub,\n        staleTime: 30 * 1000, // 30 seconds\n    });\n};\n\n/**\n * Hook to fetch user's assigned tasks\n */\nexport const useUserTasks = () => {\n    const { currentHub } = useHubStore();\n    const { user } = useAuth();\n\n    return useQuery({\n        queryKey: ['tasks', 'user', currentHub?.id, user?.id],\n        queryFn: async () => {\n            if (!currentHub || !user) throw new Error('No hub or user');\n            const response = await getUserTasks(currentHub.id, user.id);\n            if (!response.success) throw new Error(response.error);\n            return response.data;\n        },\n        enabled: !!currentHub && !!user,\n        staleTime: 30 * 1000,\n    });\n};\n\n/**\n * Hook to create a task\n */\nexport const useCreateTask = () => {\n    const queryClient = useQueryClient();\n    const { currentHub } = useHubStore();\n    const { user } = useAuth();\n\n    return useMutation({\n        mutationFn: async (data: CreateTaskFormData) => {\n            if (!currentHub || !user) throw new Error('No hub or user');\n            const response = await createTask(currentHub.id, data, user.id);\n            if (!response.success) throw new Error(response.error);\n            return response.data;\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['tasks', 'hub', currentHub?.id] });\n        },\n    });\n};\n\n/**\n * Hook to update a task\n */\nexport const useUpdateTask = () => {\n    const queryClient = useQueryClient();\n    const { currentHub } = useHubStore();\n\n    return useMutation({\n        mutationFn: async ({ taskId, updates }: { taskId: string; updates: Partial<Task> }) => {\n            if (!currentHub) throw new Error('No hub selected');\n            const response = await updateTask(currentHub.id, taskId, updates);\n            if (!response.success) throw new Error(response.error);\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['tasks', 'hub', currentHub?.id] });\n        },\n    });\n};\n\n/**\n * Hook to delete a task\n */\nexport const useDeleteTask = () => {\n    const queryClient = useQueryClient();\n    const { currentHub } = useHubStore();\n\n    return useMutation({\n        mutationFn: async (taskId: string) => {\n            if (!currentHub) throw new Error('No hub selected');\n            const response = await deleteTask(currentHub.id, taskId);\n            if (!response.success) throw new Error(response.error);\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['tasks', 'hub', currentHub?.id] });\n        },\n    });\n};\n\n/**\n * Hook to assign a task\n */\nexport const useAssignTask = () => {\n    const queryClient = useQueryClient();\n    const { currentHub } = useHubStore();\n\n    return useMutation({\n        mutationFn: async ({ taskId, userId }: { taskId: string; userId: string }) => {\n            if (!currentHub) throw new Error('No hub selected');\n            const response = await assignTask(currentHub.id, taskId, userId);\n            if (!response.success) throw new Error(response.error);\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['tasks', 'hub', currentHub?.id] });\n        },\n    });\n};\n\n/**\n * Hook to complete a task\n */\nexport const useCompleteTask = () => {\n    const queryClient = useQueryClient();\n    const { currentHub } = useHubStore();\n    const { user } = useAuth();\n\n    return useMutation({\n        mutationFn: async (data: { taskId: string; task: Task }) => {\n            if (!currentHub) throw new Error('No hub selected');\n            \n            // Complete the task\n            const response = await completeTask(currentHub.id, data.taskId);\n            if (!response.success) throw new Error(response.error);\n            \n            // Award XP to the user who completed the task\n            if (user && data.task.assignedTo === user.id) {\n                const xpAmount = data.task.weight || 10; // Default to 10 XP if no weight\n                const xpResponse = await awardXP({\n                    userId: user.id,\n                    userName: user.displayName || user.email,\n                    amount: xpAmount,\n                    source: 'task_completion',\n                    sourceId: data.taskId,\n                    description: `Completed task: ${data.task.title}`,\n                    hubId: currentHub.id,\n                });\n                \n                if (xpResponse.success) {\n                    toast.success(`ðŸŽ‰ +${xpAmount} XP for completing the task!`, {\n                        duration: 3000,\n                    });\n                }\n            }\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['tasks', 'hub', currentHub?.id] });\n            queryClient.invalidateQueries({ queryKey: ['xpRecords'] });\n            queryClient.invalidateQueries({ queryKey: ['leaderboard'] });\n        },\n    });\n};\n\n\n\n"],"names":["useHubTasks","currentHub","useHubStore","useQuery","queryKey","id","queryFn","async","Error","response","getHubTasks","success","error","data","enabled","staleTime","useCreateTask","queryClient","useQueryClient","user","useAuth","useMutation","mutationFn","createTask","onSuccess","invalidateQueries","useUpdateTask","taskId","updates","updateTask","useDeleteTask","deleteTask","useCompleteTask","completeTask","task","assignedTo","xpAmount","weight","awardXP","userId","userName","displayName","email","amount","source","sourceId","description","title","hubId","toast","duration"],"mappings":"mNAoBO,MAAMA,EAAc,KACvB,MAAMC,WAAEA,GAAeC,IAEvB,OAAOC,EAAS,CACZC,SAAU,CAAC,QAAS,MAAOH,GAAYI,IACvCC,QAASC,UACL,IAAKN,EAAY,MAAM,IAAIO,MAAM,mBACjC,MAAMC,QAAiBC,EAAYT,EAAWI,IAC9C,IAAKI,EAASE,cAAe,IAAIH,MAAMC,EAASG,OAChD,OAAOH,EAASI,MAEpBC,UAAWb,EACXc,UAAW,OA2BNC,EAAgB,KACzB,MAAMC,EAAcC,KACdjB,WAAEA,GAAeC,KACjBiB,KAAEA,GAASC,IAEjB,OAAOC,EAAY,CACfC,WAAYf,MAAOM,IACf,IAAKZ,IAAekB,EAAM,MAAM,IAAIX,MAAM,kBAC1C,MAAMC,QAAiBc,EAAWtB,EAAWI,GAAIQ,EAAMM,EAAKd,IAC5D,IAAKI,EAASE,cAAe,IAAIH,MAAMC,EAASG,OAChD,OAAOH,EAASI,MAEpBW,UAAW,KACPP,EAAYQ,kBAAkB,CAAErB,SAAU,CAAC,QAAS,MAAOH,GAAYI,UAQtEqB,EAAgB,KACzB,MAAMT,EAAcC,KACdjB,WAAEA,GAAeC,IAEvB,OAAOmB,EAAY,CACfC,WAAYf,OAASoB,SAAQC,cACzB,IAAK3B,EAAY,MAAM,IAAIO,MAAM,mBACjC,MAAMC,QAAiBoB,EAAW5B,EAAWI,GAAIsB,EAAQC,GACzD,IAAKnB,EAASE,cAAe,IAAIH,MAAMC,EAASG,QAEpDY,UAAW,KACPP,EAAYQ,kBAAkB,CAAErB,SAAU,CAAC,QAAS,MAAOH,GAAYI,UAQtEyB,EAAgB,KACzB,MAAMb,EAAcC,KACdjB,WAAEA,GAAeC,IAEvB,OAAOmB,EAAY,CACfC,WAAYf,MAAOoB,IACf,IAAK1B,EAAY,MAAM,IAAIO,MAAM,mBACjC,MAAMC,QAAiBsB,EAAW9B,EAAWI,GAAIsB,GACjD,IAAKlB,EAASE,cAAe,IAAIH,MAAMC,EAASG,QAEpDY,UAAW,KACPP,EAAYQ,kBAAkB,CAAErB,SAAU,CAAC,QAAS,MAAOH,GAAYI,UA2BtE2B,EAAkB,KAC3B,MAAMf,EAAcC,KACdjB,WAAEA,GAAeC,KACjBiB,KAAEA,GAASC,IAEjB,OAAOC,EAAY,CACfC,WAAYf,MAAOM,IACf,IAAKZ,EAAY,MAAM,IAAIO,MAAM,mBAGjC,MAAMC,QAAiBwB,EAAahC,EAAWI,GAAIQ,EAAKc,QACxD,IAAKlB,EAASE,cAAe,IAAIH,MAAMC,EAASG,OAGhD,GAAIO,GAAQN,EAAKqB,KAAKC,aAAehB,EAAKd,GAAI,CAC1C,MAAM+B,EAAWvB,EAAKqB,KAAKG,QAAU,UACZC,EAAQ,CAC7BC,OAAQpB,EAAKd,GACbmC,SAAUrB,EAAKsB,aAAetB,EAAKuB,MACnCC,OAAQP,EACRQ,OAAQ,kBACRC,SAAUhC,EAAKc,OACfmB,YAAa,mBAAmBjC,EAAKqB,KAAKa,QAC1CC,MAAO/C,EAAWI,MAGPM,SACXsC,EAAMtC,QAAQ,OAAOyB,gCAAwC,CACzDc,SAAU,KAGtB,GAEJ1B,UAAW,KACPP,EAAYQ,kBAAkB,CAAErB,SAAU,CAAC,QAAS,MAAOH,GAAYI,MACvEY,EAAYQ,kBAAkB,CAAErB,SAAU,CAAC,eAC3Ca,EAAYQ,kBAAkB,CAAErB,SAAU,CAAC"}